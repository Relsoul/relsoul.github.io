<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Soul的随笔</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Soul的随笔">
<meta property="og:url" content="http://emufan.com/page/15/index.html">
<meta property="og:site_name" content="Soul的随笔">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Soul的随笔">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="Soul的随笔" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="null" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Soul</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="/#" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="/#" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="/#" title="rss">rss</a>
					        
								<a class="zhihu" target="_blank" href="/#" title="zhihu">zhihu</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">奥巴马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">卡卡的美丽传说</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">本泽马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">吉格斯的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">习大大大不同</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">托蒂的博客</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">我是谁，我从哪里来，我到哪里去？我就是我，是颜色不一样的吃货…</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Soul</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="null" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">Soul</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="/#" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="/#" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="/#" title="rss">rss</a>
			        
						<a class="zhihu" target="_blank" href="/#" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-99ver" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/20/99ver/" class="article-date">
  	<time datetime="2015-10-20T14:15:38.450Z" itemprop="datePublished">2015-10-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/20/99ver/">十个JavaScript中易犯的小错误，你中了几枪？</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p></p><p>转自<a href="http://1ke.co/course/136" target="_blank" rel="external">http://1ke.co/course/136</a></p><p></p>
<div class="section"><br><h1>十个JavaScript中易犯的小错误，你中了几枪？</h1><br><p><img src="http://1ke.co/files/course/2015/05-18/10570628d37a433314.png?4.9.3" data-original="http://1ke.co/files/course/2015/05-18/10570628d37a433314.png?4.9.3" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt=""></p><br><p>原文地址：<a href="http://www.toptal.com/javascript/10-most-common-javascript-mistakes" target="_blank" rel="external">http://www.toptal.com/javascript/10-most-common-javascript-mistakes</a></p><br><p>在今天，JavaScript已经成为了网页编辑的核心。但是JS的真实功能却比很多人想象的要更加多样、复杂。JavaScript的许多细节规定会让你的网页出现很多意想不到的bug，搞懂这些bug，对于成为一位有经验的JS开发者很重要。</p><br></div><br><div class="section"><br><h2>序言</h2><br><p>在今天，JavaScript已经成为了网页编辑的核心。尤其是过去的几年，互联网见证了在SPA开发、图形处理、交互等方面大量JS库的出现。</p><br><p>如果初次打交道，很多人会觉得js很简单。确实，对于很多有经验的工程师，或者甚至是初学者而言，实现基本的js功能几乎毫无障碍。但是JS的真实功能却比很多人想象的要更加多样、复杂。JavaScript的许多细节规定会让你的网页出现很多意想不到的bug，搞懂这些bug，对于成为一位有经验的JS开发者很重要。</p><br></div><br><div class="section"><br><h2>常见错误一：对于this关键词的不正确引用</h2><br><p>我曾经听一位喜剧演员说过：</p><br><p><em>“我从未在这里，因为我不清楚这里是哪里，是除了那里之外的地方吗？”</em></p><br><p>这句话或多或少地暗喻了在js开发中开发者对于this关键字的使用误区。This指代的是什么？它和日常英语口语中的this是一个意思吗？</p><br><p>随着近些年js编程不断地复杂化，功能多样化，对于一个程序结构的内部指引、引用也逐渐变多起来</p><br><p>下面让我们一起来看这一段代码：</p><br><pre><code class="language-javascript hljs">Game.prototype.restart = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{   <span class="hljs-keyword">this</span>.clearLocalStorage();<br><br>    <span class="hljs-keyword">this</span>.timer = setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{     <span class="hljs-keyword">this</span>.clearBoard();        }, <span class="hljs-number">0</span>);<br><br> };</code></pre><br><p>运行上面的代码将会出现如下错误：</p><br><pre><code class="language-javascript hljs">Uncaught <span class="hljs-built_in">TypeError</span>: <span class="hljs-literal">undefined</span> is not a <span class="hljs-function"><span class="hljs-keyword">function</span></span></code></pre><br><p>这是为什么？this的调用和它所在的环境密切相关。之所以会出现上面的错误，是因为当你在调用 setTimeout()函数的时候, 你实际调用的是window.setTimeout(). 因此，在 setTimeout() 定义的函数其实是在window背景下定义的，而window中并没有 clearBoard() 这个函数方法。</p><br><p>下面提供两种解决方案。第一种比较简单直接的方法便是，把this存储到一个变量当中，这样他就可以在不同的环境背景中被继承下来：</p><br><pre><code class="language-javascript hljs">Game.prototype.restart = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{   <span class="hljs-keyword">this</span>.clearLocalStorage();<br><br>    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;<br><br>    <span class="hljs-keyword">this</span>.timer = setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{     self.clearBoard();}, <span class="hljs-number">0</span>); };</code></pre><br><p>第二种方法便是用bind()的方法，不过这个相比上一种要复杂一些，对于不熟悉bind()的同学可以在微软官方查看它的使用方法：<a href="https://msdn.microsoft.com/zh-cn/library/ff841995" target="_blank" rel="external">https://msdn.microsoft.com/zh-cn/library/ff841995</a></p><br><pre><code class="language-javascript hljs">Game.prototype.restart = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{   <span class="hljs-keyword">this</span>.clearLocalStorage();<br><br>    <span class="hljs-keyword">this</span>.timer = setTimeout(<span class="hljs-keyword">this</span>.reset.bind(<span class="hljs-keyword">this</span>), <span class="hljs-number">0</span>); };<br><br>Game.prototype.reset = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{     <span class="hljs-keyword">this</span>.clearBoard();};</code></pre><br><p>上面的例子中，两个this均指代的是Game.prototype。</p><br><p>&nbsp;</p><br></div><br><div class="section"><br><h2>常见错误二：传统编程语言的生命周期误区</h2><br><p>另一种易犯的错误，便是带着其他编程语言的思维，认为在JS中，也存在生命周期这么一说。请看下面的代码：</p><br><pre><code class="language-javascript hljs"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {   <span class="hljs-comment">/<em> … </em>/</span> } <span class="hljs-built_in">console</span>.log(i);</code></pre><br><p>如果你认为在运行console.log() 时肯定会报出 undefined 错误，那么你就大错特错了。我会告诉你其实它会返回 10吗。</p><br><p>当然，在许多其他语言当中，遇到这样的代码，肯定会报错。因为i明显已经超越了它的生命周期。在for中定义的变量在循环结束后，它的生命也就结束了。但是在js中，i的生命还会继续。这种现象叫做 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/var#var_hoisting" target="_blank" rel="external">variable hoisting</a>。</p><br><p>而如果我们想要实现和其他语言一样的在特定逻辑模块中具有生命周期的变量，可以用let关键字。</p><br></div><br><div class="section"><br><h2>常见错误三：内存泄露</h2><br><p>内存泄露在js变成中几乎是一个无法避免的问题。如果不是特别细心的话，在最后的检查过程中，肯定会出现各种内存泄露问题。下面我们就来举例说明一下：</p><br><pre><code class="language-javascript hljs"><span class="hljs-keyword">var</span> theThing = <span class="hljs-literal">null</span>;<br><br><span class="hljs-keyword">var</span> replaceThing = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{<br><br>        <span class="hljs-keyword">var</span> priorThing = theThing;<br><br>        <span class="hljs-keyword">var</span> unused = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{<br><br>                  <span class="hljs-keyword">if</span> (priorThing) {       <span class="hljs-built_in">console</span>.log(<span class="hljs-string">“hi”</span>);     }<br><br>       };<br><br>       theThing = {     longStr: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(<span class="hljs-number">1000000</span>).join(<span class="hljs-string">‘*’</span>),  <span class="hljs-comment">// </span><br><br>                  someMethod: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{       <span class="hljs-built_in">console</span>.log(someMessage);     }<br>       };<br>};<br>setInterval(replaceThing, <span class="hljs-number">1000</span>); </code></pre><br><p>如果运行上面的代码，你会发现你已经造成了大量的内存泄露，每秒泄露1M的内存，显然光靠GC（垃圾回收器）是无法帮助你的了。由上面的代码来看，似乎是longstr在每次replaceThing调用的时候都没有得到回收。这是为什么呢？</p><br><p>每一个theThing结构都含有一个longstr结构列表。每一秒当我们调用 replaceThing, 它就会把当前的指向传递给 priorThing. 但是到这里我们也会看到并没有什么问题，因为 priorThing 每回也是先解开上次函数的指向才会接受新的赋值。并且所有的这一切都是发生在 replaceThing 函数体当中，按常理来说当函数体结束之后，函数中的本地变量也将会被GC回收，也就不会出现内存泄露的问题了，但是为什么会出现上面的错误呢？</p><br><p>这是因为longstr的定义是在一个闭包中进行的，而它又被其他的闭包所引用，js规定，在闭包中引入闭包外部的变量时，当闭包结束时此对象无法被垃圾回收（GC）。关于在JS中的内存泄露问题可以查看<a href="http://javascript.info/tutorial/memory-leaks#memory-management-in-javascript" target="_blank" rel="external">http://javascript.info/tutorial/memory-leaks#memory-management-in-javascript</a></p><br></div><br><div class="section"><br><h2>常见错误四:比较运算符</h2><br><p>JavaScript中一个比较便捷的地方，便是它可以给每一个在比较运算的结果变量强行转化成布尔类型。但是从另一方面来考虑，有时候它也会为我们带来很多不便，下面的这些例子便是一些一直困扰很多程序员的代码实例：</p><br><pre><code class="language-javascript hljs"><span class="hljs-built_in">console</span>.log(<span class="hljs-literal">false</span> == <span class="hljs-string">‘0’</span>);<br><br><span class="hljs-built_in">console</span>.log(<span class="hljs-literal">null</span> == <span class="hljs-literal">undefined</span>);<br><br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">“ \t\r\n”</span> == <span class="hljs-number">0</span>);<br><br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">‘’</span> == <span class="hljs-number">0</span>);  <span class="hljs-comment">// And these do too! </span><br><br><span class="hljs-keyword">if</span> ({}) <span class="hljs-comment">// … </span><br><br><span class="hljs-keyword">if</span> ([]) <span class="hljs-comment">// … </span></code></pre><br><p>最后两行的代码虽然条件判断为空（经常会被人误认为转化为false），但是其实不管是{ }还是[ ]都是一个实体类，而任何的类其实都会转化为true。就像这些例子所展示的那样，其实有些类型强制转化非常模糊。因此很多时候我们更愿意用 === 和 !== 来替代== 和 !=， 以此来避免发生强制类型转化。. ===和!== 的用法和之前的== 和 != 一样，只不过他们不会发生类型强制转换。另外需要注意的一点是，当任何值与 NaN 比较的时候，甚至包括他自己，结果都是false。因此我们不能用简单的比较字符来决定一个值是否为<em> NaN</em> <em>。我</em><em>们</em><em>可以用内置的</em> isNaN() 函数来辨别:</p><br><pre><code class="language-javascript hljs"><span class="hljs-built_in">console</span>.log(<span class="hljs-literal">NaN</span> == <span class="hljs-literal">NaN</span>);    <span class="hljs-comment">// false </span><br><br><span class="hljs-built_in">console</span>.log(<span class="hljs-literal">NaN</span> === <span class="hljs-literal">NaN</span>);   <span class="hljs-comment">// false </span><br><br><span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">isNaN</span>(<span class="hljs-literal">NaN</span>));    <span class="hljs-comment">// true </span></code></pre><br><p>&nbsp;</p><br></div><br><div class="section"><br><h2>常见错误五：低效的DOM操作</h2><br><p>js中的DOM基本操作非常简单，但是如何能有效地进行这些操作一直是一个难题。这其中最典型的问题便是批量增加DOM元素。增加一个DOM元素是一步花费很大的操作。而批量增加对系统的花销更是不菲。一个比较好的批量增加的办法便是使用 <a href="https://developer.mozilla.org/en-US/docs/Web/API/DocumentFragment" target="_blank" rel="external">document fragments</a> ：</p><br><pre><code class="language-javascript hljs"><span class="hljs-keyword">var</span> div = <span class="hljs-built_in">document</span>.getElementsByTagName(<span class="hljs-string">“my_div”</span>);<br><br><span class="hljs-keyword">var</span> fragment = <span class="hljs-built_in">document</span>.createDocumentFragment();<br><br> <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> e = <span class="hljs-number">0</span>; e &lt; elems.length; e++) { fragment.appendChild(elems[e]); } div.appendChild(fragment.cloneNode(<span class="hljs-literal">true</span>)); </code></pre><br><p>直接添加DOM元素是一个非常昂贵的操作。但是如果是先把要添加的元素全部创建出来，再把它们全部添加上去就会高效很多。</p><br></div><br><div class="section"><br><h2>常见错误6:在for循环中的不正确函数调用</h2><br><p>请大家看以下代码：</p><br><pre><code class="language-javascript hljs"><span class="hljs-keyword">var</span> elements = <span class="hljs-built_in">document</span>.getElementsByTagName(<span class="hljs-string">‘input’</span>);<br><br><span class="hljs-keyword">var</span> n = elements.length;<br><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) {<br><br>elements[i].onclick = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{<br><br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">“This is element #”</span> + i);     }; } </code></pre><br><p>运行以上代码，如果页面上有10个按钮的话，点击每一个按钮都会弹出 “This is element #10”! 。这和我们原先预期的并不一样。这是因为当点击事件被触发的时候，for循环早已执行完毕，i的值也已经从0变成了。</p><br><p>我们可以通过下面这段代码来实现真正正确的效果：</p><br><pre><code class="language-javascript hljs"><span class="hljs-keyword">var</span> elements = <span class="hljs-built_in">document</span>.getElementsByTagName(<span class="hljs-string">‘input’</span>);<br><br><span class="hljs-keyword">var</span> n = elements.length;<br><br><span class="hljs-keyword">var</span> makeHandler = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(num)</span> </span>{  <span class="hljs-comment">// outer function</span><br><br>      <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{<br><br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">“This is element #”</span> + num);      }; };<br><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br><br>{     elements[i].onclick = makeHandler(i+<span class="hljs-number">1</span>); } </code></pre><br><p>在这个版本的代码中， makeHandler 在每回循环的时候都会被立即执行，把i＋1传递给变量num。外面的函数返回里面的函数，而点击事件函数便被设置为里面的函数。这样每个触发函数就都能够是用正确的i值了。</p><br></div><br><div class="section"><br><h2>常见错误7:原型继承问题</h2><br><p>很大一部分的js开发者都不能完全掌握原型的继承问题。下面具一个例子来说明：</p><br><pre><code class="language-javascript hljs">BaseObject = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name)</span> </span>{<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> name !== <span class="hljs-string">“undefined”</span>)<br><br>{         <span class="hljs-keyword">this</span>.name = name;     }<br><br><span class="hljs-keyword">else</span><br><br>{         <span class="hljs-keyword">this</span>.name = <span class="hljs-string">‘default’</span>     } }; </code></pre><br><p>这段代码看起来很简单。如果你有name值，则使用它。如果没有，则使用 ‘default’:</p><br><pre><code class="language-javascript hljs"><span class="hljs-keyword">var</span> firstObj = <span class="hljs-keyword">new</span> BaseObject();<br><br><span class="hljs-keyword">var</span> secondObj = <span class="hljs-keyword">new</span> BaseObject(<span class="hljs-string">‘unique’</span>);<br><br><span class="hljs-built_in">console</span>.log(firstObj.name);  <span class="hljs-comment">// -&gt; 结果是’default’ </span><br><br><span class="hljs-built_in">console</span>.log(secondObj.name); <span class="hljs-comment">// -&gt; 结果是 ‘unique’ </span></code></pre><br><p>但是如果我们执行delete语句呢:</p><br><pre><code class="language-javascript hljs"><span class="hljs-keyword">delete</span> secondObj.name; </code></pre><br><p>我们会得到:</p><br><pre><code class="language-javascript hljs"><span class="hljs-built_in">console</span>.log(secondObj.name); <span class="hljs-comment">// -&gt; 结果是 ‘undefined’ </span></code></pre><br><p>但是如果能够重新回到 ‘default’状态不是更好么? 其实要想达到这样的效果很简单，如果我们能够使用原型继承的话:</p><br><pre><code class="language-javascript hljs">BaseObject = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name)</span><br><br></span>{     <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> name !== <span class="hljs-string">“undefined”</span>)<br><br>{         <span class="hljs-keyword">this</span>.name = name;     } };<br><br>BaseObject.prototype.name = <span class="hljs-string">‘default’</span>; </code></pre><br><p>在这个版本中, BaseObject 继承了原型中的name 属性, 被设置为了 ‘default’.。这时，如果构造函数被调用时没有参数，则会自动设置为 default。相同地，如果name 属性被从BaseObject移出，系统将会自动寻找原型链，并且获得 ‘default’值：</p><br><pre><code class="language-javascript hljs"> <span class="hljs-keyword">var</span> thirdObj = <span class="hljs-keyword">new</span> BaseObject(<span class="hljs-string">‘unique’</span>);<br><br> <span class="hljs-built_in">console</span>.log(thirdObj.name);<br><br> <span class="hljs-keyword">delete</span> thirdObj.name;<br><br> <span class="hljs-built_in">console</span>.log(thirdObj.name);  <span class="hljs-comment">// -&gt; 结果是 ‘default’ </span></code></pre><br><p>&nbsp;</p><br></div><br><div class="section"><br><h2>常见错误8:为实例方法创建错误的指引</h2><br><p>我们来看下面一段代码:</p><br><pre><code class="language-javascript hljs"><span class="hljs-keyword">var</span> MyObject = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{}<br><br> MyObject.prototype.whoAmI = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{<br><br><span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span> === <span class="hljs-built_in">window</span> ? <span class="hljs-string">“window”</span> : <span class="hljs-string">“MyObj”</span>); };<br><br> <span class="hljs-keyword">var</span> obj = <span class="hljs-keyword">new</span> MyObject(); </code></pre><br><p>现在为了方便起见，我们新建一个变量来指引 whoAmI 方法, 因此我们可以直接用 whoAmI() 而不是更长的obj.whoAmI():</p><br><pre><code class="language-javascript hljs"><span class="hljs-keyword">var</span> whoAmI = obj.whoAmI; </code></pre><br><p>接下来为了确保一切都如我们所预测的进行，我们可以将 whoAmI 打印出来:</p><br><pre>console.log(whoAmI);</pre><br><p>结果是：</p><br><pre><code class="language-javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{     <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span> === <span class="hljs-built_in">window</span> ? <span class="hljs-string">“window”</span> : <span class="hljs-string">“MyObj”</span>); } </code></pre><br><p>没有错误！</p><br><p>但是现在我们来查看一下两种引用的方法：</p><br><pre><code class="language-javascript hljs">obj.whoAmI();  <span class="hljs-comment">// 输出 “MyObj” (as expected) </span><br><br>whoAmI();      <span class="hljs-comment">// 输出 “window” (uh-oh!) </span></code></pre><br><p>哪里出错了呢？</p><br><p>原理其实和上面的第二个常见错误一样，当我们执行 var whoAmI = obj.whoAmI;的时候，新的变量 whoAmI 是在全局环境下定义的。因此它的this 是指window, <em>而不是</em>obj！</p><br><p>正确的编码方式应该是：</p><br><pre><code class="language-javascript hljs"><span class="hljs-keyword">var</span> MyObject = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{}<br><br>MyObject.prototype.whoAmI = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{<br><br>      <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span> === <span class="hljs-built_in">window</span> ? <span class="hljs-string">“window”</span> : <span class="hljs-string">“MyObj”</span>); };<br><br><span class="hljs-keyword">var</span> obj = <span class="hljs-keyword">new</span> MyObject();<br><br>obj.w = obj.whoAmI;   <span class="hljs-comment">// still in the obj namespace  obj.whoAmI();  // 输出 “MyObj” (as expected) </span><br><br>obj.w();       <span class="hljs-comment">// 输出 “MyObj” (as expected) </span></code></pre><br><p>&nbsp;</p><br></div><br><div class="section"><br><h2>常见错误9:用字符串作为setTimeout 或者 setInterval的第一个参数</h2><br><p>首先我们要声明，用字符串作为这两个函数的第一个参数并没有什么语法上的错误。但是其实这是一个非常低效的做法。因为从系统的角度来说，当你用字符串的时候，它会被传进构造函数，并且重新调用另一个函数。这样会拖慢程序的进度。</p><br><pre><code class="language-javascript hljs">setInterval(<span class="hljs-string">“logTime()”</span>, <span class="hljs-number">1000</span>);<br><br>setTimeout(<span class="hljs-string">“logMessage(‘“</span> + msgValue + <span class="hljs-string">“‘)”</span>, <span class="hljs-number">1000</span>); </code></pre><br><p>另一种方法是直接将函数作为参数传递进去：</p><br><pre><code class="language-javascript hljs">setInterval(logTime, <span class="hljs-number">1000</span>);<br><br>setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{<br><br>logMessage(msgValue); }, <span class="hljs-number">1000</span>); </code></pre><br><p>&nbsp;</p><br></div><br><div class="section"><br><h2>常见错误10:忽略 “strict mode”的作用</h2><br><p>“strict mode” 是一种更加严格的代码检查机制，并且会让你的代码更加安全。当然，不选择这个模式并不意味着是一个错误，但是使用这个模式可以确保你的代码更加准确无误。</p><br><p>下面我们总结几条“strict mode”的优势：</p><br><p>1.    让Debug更加容易：在正常模式下很多错误都会被忽视掉，“strict mode”模式会让Debug极致更加严谨。</p><br><p>2.    防止默认的全局变量：在正常模式下，给一个为经过声明的变量命名将会将这个变量自动设置为全局变量。在strict模式下，我们取消了这个默认机制。</p><br><p>3.    取消this的默认转换：在正常模式下，给this关键字指引到null或者undefined会让它自动转换为全局。在strict模式下，我们取消了这个默认机制。</p><br><p>4.    防止重复的变量声明和参数声明：在strict模式下进行重复的变量声明会被抱错，如(e.g., var object = {foo: “bar”, foo: “baz”};) 同时，在函数声明中重复使用同一个参数名称也会报错，如 (e.g., function foo(val1, val2, val1){}),</p><br><p>5.    让eval()函数更加安全。</p><br><p>6.    当遇到无效的delete指令的事后报错：delete指令不能对类中未有的属性执行，在正常情况下这种情况只是默默地忽视掉，而在strict模式是会报错的。</p><br></div><br><div class="section"><br><h2>结语</h2><br><p>正如和其他的技术语言一样，你对JavaScript了解的的越深，知道它是如何运作，为什么这样运作，你才会熟练地掌握并且运用这门语言。相反地，如果你缺少对JS模式的认知的话，你就会碰上很多的问题。了解JS的一些细节上的语法或者功能将会有助于你提高编程的效率，减少变成中遇到的问题。</p><br></div>





      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-95ver" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/20/95ver/" class="article-date">
  	<time datetime="2015-10-20T14:15:38.450Z" itemprop="datePublished">2015-10-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/20/95ver/">php自学笔记之语言结构</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote><br><h1 style="text-align: center;"><strong><span style="color: #993366;">语言结构</span></strong></h1><br><p id="J_CodeLang" class="code-head" data-lang="PHP"><span style="color: #993366;"><strong>1,顺序结构</strong></span></p><br><div id="J_CodeDescr" class="code-description"><br><div class="code-desc co"><br><p align="left">顺序结构就像一条直线，按着顺序一直往下执行。我们编写的代码默认都是按照顺序结构执行的。</p><br></div><br></div><br><p>&nbsp;</p><br><p>&lt;?php<br><br>$shoesPrice = 49; //鞋子单价<br><br>$shoesNum = 1; //鞋子数量<br><br>$shoesMoney=$shoesPrice<em>$shoesNum;</em></p><br><p>$shirtPrice = 99; //衬衣单价<br><br>$shirtNum = 2; //衬衣数量<br><br>$shirtMoney = $shirtPrice  $shirtNum;</p><br><p>$orderMoney = $shoesMoney + $shirtMoney;</p><br><p>echo $orderMoney ;<br><br>?&gt;</p><br><hr><br><p id="J_CodeLang" class="code-head" data-lang="PHP"><span style="color: #993366;"><strong>2,条件结构之if…else…</strong></span></p><br><div id="J_CodeDescr" class="code-description"><br><div class="code-desc co"><br><p align="left">条件结构就像一个岔路口，可以向左走，也可以向右走。比如上洗手间，我们知道我们的性别，这时候我们需要根据洗手间提供的条件，左边男洗手间，右边女洗手间，或者正好相反，其中性别就是这个条件结构的条件。再比如，现在的分数都流行使用A、B、C来分级，假设考试成绩是93分，可以将其设置为等级A，考试成绩是87，可以将其设置为等级B，这里分数区间即为条件结构中的条件。</p><br><p align="left">PHP中的“if…else…”语法，如下：</p><br><pre class="code">&lt;?php<br>if(条件){<br>     //分配服务器干的任务A<br>}else{<br>     //分配服务器干的任务B<br>}<br>?&gt;</pre><br><p align="left">通过条件判断，若返回值为布尔值TRUE，则执行任务A，若返回值为FALSE，则执行任务B。</p><br></div><br></div><br><p>&nbsp;</p><br><p>&lt;?php<br><br>date_default_timezone_set(‘Asia/ShangHai’);<br><br>$today = date(‘m-d’,time());//获取当天日期<br><br>$birthday = “02-14”;//生日<br><br>$money = 238;//消费金额<br><br>$discount = 0.8;//八折优惠<br><br>if($today==$birthday){<br><br>$money = $money <em> $discount;<br><br>}else{<br><br>$money = $money </em> 1;</p><br><p>}<br><br>echo $money;</p><br><p>?&gt;</p><br><p>&nbsp;</p><br><hr><br><p id="J_CodeLang" class="code-head" data-lang="PHP"><span style="color: #993366;"><strong>3,条件结构之if…else if…</strong></span></p><br><div id="J_CodeDescr" class="code-description"><br><div class="code-desc co"><br><p>PHP中的“if…else if…”语法，如下：</p><br><pre class="code">&lt;?php<br>if(条件一){<br>     //分配服务器干的任务A<br>}else if(条件二){<br>     //分配服务器干的任务B<br>}<br>?&gt;</pre><br><p align="left">通过<strong>条件一</strong>判断，若返回值为布尔值为TRUE，则执行任务A，若返回值为FALSE，则判断条件二，若返回值为布尔值TRUE，则执行任务B，否则既不执行任务A，也不执行任务B。服务器会继续往下执行其他任务。</p><br></div><br></div><br><p>&lt;?php<br><br>$totalMoney = 0;//总工资<br><br>$basicMoney = 2000;//基本工资<br><br>$sex = “男”;</p><br><p>if($sex==”男”){<br><br>$totalMoney = $basicMoney + 0;}// 男的没奖金<br><br>else if($sex==”女”){<br><br>$totalMoney = $basicMoney + 300;// 女的有奖金300元<br><br>}<br><br>echo $totalMoney;<br><br>?&gt;</p><br><p>&nbsp;</p><br><hr><br><p id="J_CodeLang" class="code-head" data-lang="PHP"><span style="color: #993366;"><strong>4,条件结构之switch…case…</strong></span></p><br><div id="J_CodeDescr" class="code-description"><br><div class="code-desc co"><br><p>PHP中的“switch…case…”语法，如下：</p><br><pre class="code">&lt;?php<br>switch (条件)<br>{<br>case 条件值一:<br>  //任务一<br>  break;<br>case 条件值二:<br>  //任务二<br>  break;<br>default:<br>  //默认任务<br>}<br>?&gt;</pre><br><p align="left">首先判断条件，若条件的返回值为条件值一，则执行任务一，若条件返回的值为条件值二，则执行任务二，若条件的返回值既不是条件值一也不是条件值二，则执行默认任务。break的作用是结束switch（后面会有专门举例说明），使用 switch 语句可以避免冗长的 “if..else if..else”代码块。</p><br></div><br></div><br><p>&lt;?php<br><br>$num = rand(1,50);//获取1至50的随机数<br><br>$info = “”;//提示信息<br><br>switch($num){<br><br>case 1:<br><br>$info = “恭喜你！中了一等奖！”;<br><br>break;<br><br>case 2:<br><br>$info = “恭喜你！中了二等奖！”;<br><br>break;<br><br>case 3:<br><br>$info = “恭喜你！中了三等奖！”;<br><br>break;<br><br>default:<br><br>$info = “很遗憾！你没有中奖！”;<br><br>}<br><br>echo $info; //输出是否中奖<br><br>?&gt;</p><br><h2 id="J_CodeLang" class="code-head" data-lang="PHP">条件结构之switch…case…中的break</h2><br><div id="J_CodeDescr" class="code-description"><br><div class="code-desc co"><br><p align="left">break的作用是阻止代码进入下一个case 中继续执行。</p><br><p align="left">&lt;?php<br><br>//A例子 输出为20 因为用了break<br><br>$num = 2;<br><br>$sum = 10;<br><br>switch($num){<br><br>case 1:<br><br>$sum = $sum + 10;<br><br>break;<br><br>case 2:<br><br>$sum = $sum + 10;<br><br>break;<br><br>case 3:<br><br>$sum = $sum + 10;<br><br>break;<br><br>default:<br><br>$sum = $sum + 10;<br><br>}<br><br>echo “A例子的值是：”.$sum.”&lt;br /&gt;”;<br><br>//B例子 输出为40 因为没用用break<br><br>$num = 2;<br><br>$sum = 10;<br><br>switch($num){<br><br>case 1:<br><br>$sum = $sum + 10;<br><br>case 2:<br><br>$sum = $sum + 10;<br><br>case 3:<br><br>$sum = $sum + 10;<br><br>default:<br><br>$sum = $sum + 10;<br><br>}<br><br>echo “B例子的值是：”.$sum.”&lt;br /&gt;”;<br><br>?&gt;</p><br></div><br></div><br><hr><br><p><span style="color: #993366;"><strong> 5，PHP中循环结构之while循环语句</strong></span></p><br><div id="J_CodeDescr" class="code-description"><br><div class="code-desc co"><br><p align="left">循环结构就像一圈圈地跑足球场，跑完一圈再跑一圈。也就是说，在符合的条件下，重复执行某项任务。像400米一圈的跑道，跑800米的话就跑2圈，当跑完第一圈接着跑第二圈，第二圈结束已经达到800米，终止跑步。</p><br><p align="left">在PHP中，while循环语句如下：</p><br><pre class="code">&lt;?php<br>while(条件){<br>     //执行任务<br>}<br>?&gt;</pre><br><p align="left">首先判断某个条件是否符合（条件返回值是否为TRUE），若符合则执行任务，执行完毕任务，再判断条件是否满足要求，符合则重复执行此任务，否则结束任务。</p><br></div><br></div><br><p>&lt;?php<br><br>$sum = 12;//小宠物当前的饥饿程度<br><br>echo “我饿啦:-(“;<br><br>echo “&lt;br /&gt;”;<br><br>while($sum&lt;100){//小宠物的饥饿程度到100，表示小宠物吃饱啦,不用继续喂了，没吃饱继续喂食<br><br>$num = rand(1,20);//随机数，模拟喂食小宠物的小面包<br><br>$sum = $sum + $num; //小宠物吃小面包<br><br>echo “我还没吃饱呢！”;<br><br>echo “&lt;br /&gt;”;<br><br>}<br><br>echo “终于吃饱啦^_^”;<br><br>?&gt;</p><br><h2 id="J_CodeLang" class="code-head" data-lang="PHP">PHP中循环结构之do while循环语句</h2><br><div id="J_CodeDescr" class="code-description"><br><div class="code-desc co"><br><p align="left">在PHP中循环语句还有另一种：do…while循环语句语法如下：</p><br><pre class="code">&lt;?php<br>do{<br>     //执行任务<br>}while(条件)<br>?&gt;</pre><br><p align="left">首先执行任务（上一节的while语句是先判断条件是否成立，再执行任务），执行任务完毕，判断某个条件是否符合（条件返回值是否为TRUE），若符合则再次执行任务，执行完毕任务，继续判定条件。</p><br><p align="left">&lt;?php<br><br>$i = 1 ; //从第1圈开始跑<br><br>do{ //跑10圈<br><br>echo “在跑第”.$i.”圈。”;<br><br>$i++;<br><br>}while($i&lt;=10)<br><br>?&gt;</p><br><h2 id="J_CodeLang" class="code-head" data-lang="PHP">PHP中循环结构之while与do…while语句的区别</h2><br><div id="J_CodeDescr" class="code-description"><br><div class="code-desc co"><br><p align="left">while与do…while循环语句的区别是，while先判断条件是否成立，后执行循环，do…while先执行一次任务，再判断是否继续执行循环，也就是说do…while至少会执行一次任务。当条件为FALSE时，while中的任务会一次也不执行，do…while中的任务会执行1次。</p><br><p>&lt;?php<br><br>//A例子<br><br>$num = 2;<br><br>$sum = 10;<br><br>while($num&gt;3){</p><br><p>$sum = $sum + 10;<br><br>}<br><br>echo “A例子的结果：”.$sum.”&lt;br /&gt;”;<br><br>//B例子<br><br>$num = 2;<br><br>$sum = 10;<br><br>do{<br><br>$sum = $sum + 10;<br><br>}while($num&gt;3);<br><br>echo “B例子的结果：”.$sum.”&lt;br /&gt;”;<br><br>?&gt;</p><br></div><br></div><br></div><br></div><br><hr><br><p><span style="color: #993366;"><strong> 6,PHP中循环结构之for循环语句</strong></span></p><br><div id="J_CodeDescr" class="code-description"><br><div class="code-desc co"><br><p align="left">在PHP中还有一种循环语句，for循环语句结构如下：</p><br><pre class="code">&lt;?php<br>for(初始化;循环条件;递增项){<br>      //执行任务<br>}<br>?&gt;</pre><br><p>for 语句中，“初始化”在循环开始前无条件求值一次，“循环条件”在每次循环开始前求值。如果值为 TRUE，则继续循环，执行循环体语句（执行任务）。如果值为 FALSE，则终止循环。“递增项”在每次循环之后被求值（执行）。其常用于循环执行代码块指定的次数。</p><br></div><br></div><br><p>&nbsp;</p><br><p>&lt;?php<br><br>//for语句写法</p><br><p>for($i=1,$sum=0;$i&lt;=100;$i++){<br><br>$sum = $sum + $i; // 累加求和<br><br>}<br><br>echo “for语句的运行结果：”.$sum.”&lt;br /&gt;” ;</p><br><p>//while语句写法<br><br>$i = 1 ; // 从1开始累加<br><br>$sum = 0; //初始化和为0<br><br>while($i&lt;=100){ //判断是否小于100<br><br>$sum = $sum + $i; // 累加求和<br><br>$i++; //递增1<br><br>}<br><br>echo “while语句的运行结果：”.$sum.”&lt;br /&gt;” ;<br><br>?&gt;</p><br><hr><br><p id="J_CodeLang" class="code-head" data-lang="PHP"><span style="color: #993366;"><strong>7,PHP中循环结构之foreach循环语句(任务一)</strong></span></p><br><div id="J_CodeDescr" class="code-description"><br><div class="code-desc co"><br><p>在PHP中foreach循环语句，常用于遍历数组，一般有两种使用方式:不取下标、取下标。</p><br><p>（1）只取值，不取下标</p><br><pre class="code">&lt;?php<br> foreach (数组 as 值){<br>//执行的任务<br>}<br>?&gt;</pre><br><p>&nbsp;</p><br></div><br></div><br><p>&nbsp;</p><br><p>&lt;?php<br><br>$students = array(<br><br>‘2010’=&gt;’令狐冲’,<br><br>‘2011’=&gt;’林平之’,<br><br>‘2012’=&gt;’曲洋’,<br><br>‘2013’=&gt;’任盈盈’,<br><br>‘2014’=&gt;’向问天’,<br><br>‘2015’=&gt;’任我行’,<br><br>‘2016’=&gt;’冲虚’,<br><br>‘2017’=&gt;’方正’,<br><br>‘2018’=&gt;’岳不群’,<br><br>‘2019’=&gt;’宁中则’,<br><br>);//10个学生的学号和姓名，用数组存储</p><br><p>//使用循环结构遍历数组,获取学号和姓名</p><br><p>foreach($students as $v){<br><br>echo $v;//输出（打印）姓名<br><br>echo “&lt;br /&gt;”;<br><br>}<br><br>?&gt;</p><br><p><strong>（2）同时取下标和值</strong></p><br><pre class="code">&lt;?php<br>foreach (数组 as 下标 =&gt; 值){<br> //执行的任务<br>}<br>?&gt;</pre><br><p>foreach($students as $key=&gt;$v){<br><br>echo $key.”:”.$v;//输出（打印）学号：姓名<br><br>echo “&lt;br /&gt;”;<br><br>}<br><br>?&gt;</p><br><hr><br><p>&nbsp;</p><br><p id="J_CodeLang" class="code-head" data-lang="PHP"><span style="color: #993366;"><strong>8,PHP中结构嵌套之条件嵌套</strong></span></p><br><pre class="lang:default decode:true ">&lt;?php<br>    $totalMoney = 0;//总工资<br>    $basicMoney =  300;//基本工资<br>    $sex = “男”;<br>    $noHouse = TRUE; //是否有房<br>    $houseMoney =  150;//住房补贴<br>    $isPregnancy = TRUE; //是否怀孕<br>    $pregnancyMoney =  100;//怀孕补贴<br>    if($sex==”男”)<br>    {<br>        $totalMoney = $basicMoney  + 0;// 男的没奖金<br>        if($noHouse)<br>        {<br>            $totalMoney = $totalMoney  + $houseMoney;<br>        }<br>    }<br><br>    elseif($sex==”女”){<br>        $totalMoney = $basicMoney  + 300;// 女的有奖金300元<br>        if($isPregnancy)<br>        {<br>            $totalMoney = $totalMoney  + $pregnancyMoney;<br>        }<br>    }<br>    echo $totalMoney;<br>?&gt;</pre><br><p>&nbsp;</p><br><hr><br><p id="J_CodeLang" class="code-head" data-lang="PHP"><span style="color: #993366;"><strong>9,PHP中结构嵌套之循环嵌套</strong></span></p><br><div id="J_CodeDescr" class="code-description"><br><div class="code-desc co"><br><p>循环结构嵌套，就是类似于跑多个足球场，例如假设有两个足球场，一个大足球场，一个小足球场，在大足球场跑一圈后，再到小足球场跑几圈，跑完几圈后，再到大足球场中继续跑。在遍历二维数组中很常用。</p><br></div><br><div class="code-tips"><br><h3 class="code-tips-title">任务</h3><br><div class="co"><br><p align="left">通过二维数组，保存了学号、姓名和成绩，可以通过两个循环嵌套，遍历出学号和姓名。在右边编辑器中输入两条指令：</p><br><p align="left">1、第15行输入<code class="marker">foreach($students as $key=&gt;$val)</code></p><br><p align="left">2、第20行输入<code class="marker">foreach($val as $v)</code></p><br></div><br></div><br></div><br><p>&nbsp;</p><br><pre class="lang:default decode:true ">&lt;?php<br> $students = array(<br>‘2010’=&gt;array(‘令狐冲’,”59”),<br>‘2011’=&gt;array(‘林平之’,”44”),<br>‘2012’=&gt;array(‘曲洋’,”89”),<br>‘2013’=&gt;array(‘任盈盈’,”92”),<br>‘2014’=&gt;array(‘向问天’,”93”),<br>‘2015’=&gt;array(‘任我行’,”87”),<br>‘2016’=&gt;array(‘冲虚’,”58”),<br>‘2017’=&gt;array(‘方正’,”74”),<br>‘2018’=&gt;array(‘岳不群’,”91”),<br>‘2019’=&gt;array(‘宁中则’,”90”),<br>);//10个学生的学号、姓名、分数，用数组存储<br><br><br>foreach($students as $key=&gt;$val){ //使用循环结构遍历数组,获取学号<br>     echo $key; //输出学号<br>     echo “:”;<br>     //循环输出姓名和分数<br><br>    foreach($val as $k=&gt; $v){<br>        echo $v;<br>        echo “&lt;br&gt;”;<br>        echo $k;<br>     }<br>     echo “&lt;br /&gt;”;<br>}<br>?&gt;<br></pre><br><p>&nbsp;</p><br><hr><br><p id="J_CodeLang" class="code-head" data-lang="PHP"><span style="color: #993366;"><strong>10,PHP中结构嵌套之循环结构与条件结构嵌套</strong></span></p><br><div id="J_CodeDescr" class="code-description"><br><div class="code-desc co"><br><p align="left">有时候在执行任务时，对于一些特殊的任务还需要进行额外处理，这个时候就会将循环结构与条件结构嵌套使用。</p><br></div><br><div class="code-tips"><br><h3 class="code-tips-title">任务</h3><br><div class="co"><br><p align="left">有个学生数组存储了学号和姓名，我们需要查找学号为“2014”的学生姓名，这时候我们就需要遍历该数组，并判定学号是否为“2014”。在右边编辑器中，输入两条指令：</p><br><p align="left">1、第16行输入<code class="marker">foreach($students as $key =&gt;$v)</code></p><br><p align="left">2、第19行输入<code class="marker">if($key == $query)</code></p><br><pre class="lang:default decode:true ">&lt;?php<br> $students = array(<br>‘2010’=&gt;’令狐冲’,<br>‘2011’=&gt;’林平之’,<br>‘2012’=&gt;’曲洋’,<br>‘2013’=&gt;’任盈盈’,<br>‘2014’=&gt;’向问天’,<br>‘2015’=&gt;’任我行’,<br>‘2016’=&gt;’冲虚’,<br>‘2017’=&gt;’方正’,<br>‘2018’=&gt;’岳不群’,<br>‘2019’=&gt;’宁中则’,<br>);//10个学生的学号和姓名，用数组存储<br>$query = ‘2014’;<br>//使用循环结构遍历数组,获取学号和姓名<br><br>foreach($students as $key=&gt;$v){<br>    //使用条件结构，判断是否为该学号<br>    if($key==$query)<br>    {<br>        echo $v;//输出（打印）姓名<br>        break;//结束循环（跳出循环）<br>    }<br>}<br>?&gt;<br></pre><br><p>&nbsp;</p><br></div><br></div><br></div><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p></blockquote>





      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-107ver" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/20/107ver/" class="article-date">
  	<time datetime="2015-10-20T14:15:38.450Z" itemprop="datePublished">2015-10-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/20/107ver/">干货！一步步实现自己的表单验证器</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p></p><p>转自<a href="http://www.gbtags.com/gb/share/5017.htm" target="_blank" rel="external">http://www.gbtags.com/gb/share/5017.htm</a></p><p></p>
<p></p><p>表单验证的需求简直太常见了。“<strong>所有用户的输入都是不可信的</strong>”这个思想指导我们在设计表单的时候，一定要进行用户输入的验证。对于用户体验而言，越早的反馈则越佳，所以表单验证的工作应该尽可能地在前端就进行（当然，前端对于后端而言也是输入端，所以后端仍然需要进行检验）。简单的表单验证完全可以给input绑定几个change事件来进行。但表单一复杂，或者相似验证规则一多，这种编码的方式就很难管理事件了。这时候，我们通常需要使用一些库来帮助我们处理表单验证的工作。前端表单验证的库太多了，随便一搜：<a href="http://www.zhouhua.info/jump/z000" target="_blank">表单验证-百度搜索</a>。</p><p></p>
<p></p><p>那……为什么还要自己实现一个呢？因为去年工作中遇到了比较复杂的验证逻辑，选一个别人的库一是要学习api，二是维护起来困难，要符合自己的页面风格也不是那么轻松；再加上表单验证器并不复杂，于是就打算自己写一个。所以这个表单验证器并不算那么地通用，不过我觉得传播思路和方法更重要，要想修修改改变成一个通用的库也很容易，只是没那么重要罢了（其实是懒……）。</p><p></p>
<p></p><h2>依赖</h2><p></p>
<p></p><p>jquery + bootstrap。jquery看来是缺不了，bootstrap没那么重要，对代码稍做修改就可以取消依赖。</p><p></p>
<p></p><h2>能做什么</h2><p></p>
<p></p><p>我期望这个表单验证器直接在html代码中指定好需要采用什么样的规则，不需要用javascript进行多余的配置；允许暂时跳过验证；允许扩展验证规则；提供验证难过、验证失败、警告三种验证结果；允许手动触发验证等等。</p><p></p>
<p></p><p>一个典型的bootstrap风格的表单项应该长这个样子：</p><p></p>
<p><div class="jspContainer"></div></p>
<p><div class="jspPane"></div></p>
<p><ol class="linenums"></ol></p>
<p><li class="L0"><span class="tag">&lt;div</span> <span class="atn">class</span><span class="pun">=</span><span class="atv">“form-group”</span><span class="tag">&gt;</span></li></p>
<p><li class="L1"><span class="tag">&lt;label</span> <span class="atn">class</span><span class="pun">=</span><span class="atv">“col-xs-2 control-label”</span><span class="tag">&gt;</span><span class="pln">手机号码</span></li></p>
<p><li class="L2"><span class="tag">&lt;span</span> <span class="atn">class</span><span class="pun">=</span><span class="atv">“request”</span><span class="tag">&gt;</span><span class="pln">*</span><span class="tag">&lt;/span&gt;</span><span class="pln">：</span><span class="tag">&lt;/label&gt;</span></li></p>
<p><li class="L3"><span class="tag">&lt;div</span> <span class="atn">class</span><span class="pun">=</span><span class="atv">“col-xs-6”</span><span class="tag">&gt;</span></li></p>
<p><li class="L4"><span class="tag">&lt;input</span> <span class="atn">class</span><span class="pun">=</span><span class="atv">“form-control”</span> <span class="atn">name</span><span class="pun">=</span><span class="atv">“mobile”</span> <span class="atn">type</span><span class="pun">=</span><span class="atv">“text”</span> <span class="atn">data-validate-disable</span><span class="pun">=</span><span class="atv">“true”</span> <span class="atn">data-validate</span><span class="pun">=</span><span class="atv">“request:notrim mobile”</span> <span class="tag">/&gt;</span></li></p>
<p><li class="L5"><span class="tag">&lt;p</span> <span class="atn">class</span><span class="pun">=</span><span class="atv">“text-info”</span><span class="tag">&gt;</span><span class="pln">请输入真实手机号码。</span><span class="tag">&lt;/p&gt;</span></li></p>
<p><li class="L6"><span class="tag">&lt;/div&gt;</span></li></p>
<p><li class="L7"><span class="tag">&lt;div</span> <span class="atn">class</span><span class="pun">=</span><span class="atv">“help-block col-xs-4”</span><span class="tag">&gt;</span><span class="pln">&amp;nbsp;</span><span class="tag">&lt;/div&gt;</span></li></p>
<p><li class="L8"><span class="tag">&lt;/div&gt;</span></li><br><br></p>
<p><div class="jspVerticalBar"></div></p>
<p><div class="jspHorizontalBar"></div><br></p>
<p></p><p>&nbsp;</p><p></p>
<p></p><p>重点看第5行，对于一个普通的input组件，我加了两个属性， data-validate-disable 有值表示表单验证时，会跳过这个input组件； data-validate 则存放如果要验证的话，将采用什么样的验证规则。这个例子中表示要验证这个input组件是否为空、是否为手机号码这两个规则。注意，在request 的后面我还加了一点内容，这是我想传递给验证规则的参数，比如这里我期望告诉验证器，如果input值只有空格，也认为是有值的。相似的，我们可以定义一个规则 min 来处理最少几个字符，并在html中把这个设定值传递进来，就像这样： data-validate=”min:10” 。我也期望一个验证规则允许多个参数传递，参数与参数之间用逗号隔开。</p><p></p>
<p></p><p>看起来很有意思，那就开始动手吧。</p><p></p>
<p></p><h2>先写个jquery插件吧</h2><p></p>
<p><div class="jspContainer"></div></p>
<p><div class="jspPane"></div></p>
<p><ol class="linenums"></ol></p>
<p><li class="L0"><span class="pun">(</span><span class="kwd">function</span> <span class="pun">(</span><span class="pln">$</span><span class="pun">)</span> <span class="pun">{</span></li></p>
<p><li class="L1"><span class="pln"> $</span><span class="pun">.</span><span class="pln">fn</span><span class="pun">.</span><span class="pln">validation </span><span class="pun">=</span> <span class="kwd">function</span> <span class="pun">()</span> <span class="pun">{</span></li></p>
<p><li class="L2"><span class="kwd">return</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">each</span><span class="pun">(</span><span class="kwd">function</span> <span class="pun">()</span> <span class="pun">{</span></li></p>
<p><li class="L3"><span class="kwd">var</span><span class="pln"> $this </span><span class="pun">=</span><span class="pln"> $</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></li></p>
<p><li class="L4"><span class="kwd">if</span> <span class="pun">(!</span><span class="pln">$this</span><span class="pun">.</span><span class="kwd">is</span><span class="pun">(</span><span class="str">‘:input’</span><span class="pun">))</span> <span class="pun">{</span></li></p>
<p><li class="L5"><span class="pln"> $this </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="str">‘:input’</span><span class="pun">);</span></li></p>
<p><li class="L6"><span class="pun">}</span></li></p>
<p><li class="L7"><span class="pln"> $this</span><span class="pun">.</span><span class="pln">off</span><span class="pun">(</span><span class="str">‘blur.zh select.zh focus.zh’</span><span class="pun">)</span></li></p>
<p><li class="L8"><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">‘blur.zh select.zh’</span><span class="pun">,</span><span class="pln"> validate</span><span class="pun">)</span></li></p>
<p><li class="L9"><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">‘focus.zh’</span><span class="pun">,</span><span class="pln"> clear</span><span class="pun">);</span></li></p>
<p><li class="L0"><span class="pun">});</span></li></p>
<p><li class="L1"><span class="pun">};</span></li></p>
<p><li class="L2"><span class="pun">}(</span><span class="pln">jQuery</span><span class="pun">));</span></li><br><br></p>
<p><div class="jspVerticalBar"></div><br></p>
<p></p><p>给jquery对象添加一个 validation 方法，用法很简单： $(Selector).validation() 。支持链式调用。<em>Selector</em>比较自由，如果是 :input 元素，则直接给这些元素初始化验证器；否则找出它们所有的 :input 子元素，给这些子元素初始化验证器。什么意思呢？就以上面的html片断为例，你可以任性地使用如下任意一种方式初始化验证器：</p><p></p>
<p><ul></ul></p>
<p><li>$(‘[name=mobile]’).validation(); // 选择:input</li></p>
<p><li>$(‘.form-group’).validation(); // 选择普通节点，对所有:input子元素生效</li></p>
<p><li>$(‘body’).validation(); // 对页面中所有的:input元素生效</li><br></p>
<p></p><p>再说说所谓的初始化，其实就是绑定事件。那么要绑定什么事件呢？主观上，对于一个输入框，当我们输入好了，焦点离开时，应该就进行输入内容的验证，并给出验证结果。如果验证失败，会有提示信息，但这些提示信息应该在重新获得焦点时清除，否则当用户在修正输入的时候还一直提示上次的错误信息，会让用户无所适从。那么针对以上的情况，我们需要在失去焦点（<em>blur</em>）和获得焦点（<em>focus</em>）时分别绑定验证的方法（<em>validate</em>）和清除错误信息的方法（<em>clear</em>）。另外针对checkbox、radiobox、select等控件，最好也给select事件绑定验证方法。</p><p></p>
<blockquote><p>为什么不使用更通用change事件来绑定验证方法呢？原因有二：</p><br><ol><br><li>我觉得有些场景需要用javascript载入默认值或历史输入。这些内容应该延后验证（不是不验证），不然刚打开页面就是表单验证错误让人很难受。所以change事件不合适。</li><br><li>由于获得焦点会清空错误消息，如果没有修改内容，直接失去焦点，这时不会触发change事件，导致不会再验证，表现为错误信息丢失。</li><br></ol><br></blockquote><br><p>那下面就来具体看看<em>validate</em>和<em>clear</em>两个方法。</p><br><h2>清除错误消息及验证状态设置</h2><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="kwd">function</span><span class="pln"> clear</span><span class="pun">()</span> <span class="pun">{</span></li><br><li class="L1"><span class="kwd">var</span><span class="pln"> $this </span><span class="pun">=</span><span class="pln"> $</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></li><br><li class="L2"><span class="kwd">var</span><span class="pln"> $parent </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">.</span><span class="pln">closest</span><span class="pun">(</span><span class="str">‘.form-group’</span><span class="pun">);</span></li><br><li class="L3"><span class="kwd">if</span> <span class="pun">(!</span><span class="pln">$parent</span><span class="pun">.</span><span class="pln">attr</span><span class="pun">(</span><span class="str">‘data-for’</span><span class="pun">)</span> <span class="pun">||</span></li><br><li class="L4"><span class="pln"> $parent</span><span class="pun">.</span><span class="pln">attr</span><span class="pun">(</span><span class="str">‘data-for’</span><span class="pun">)</span> <span class="pun">===</span><span class="pln"> $this</span><span class="pun">.</span><span class="pln">prop</span><span class="pun">(</span><span class="str">‘name’</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L5"><span class="pln"> $parent</span><span class="pun">.</span><span class="pln">attr</span><span class="pun">(</span><span class="str">‘data-for’</span><span class="pun">,</span> <span class="kwd">null</span><span class="pun">).</span><span class="pln">removeClass</span><span class="pun">(</span><span class="str">‘has-error waiting has-warning’</span><span class="pun">)</span></li><br><li class="L6"><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="str">‘.help-block’</span><span class="pun">).</span><span class="pln">text</span><span class="pun">(</span><span class="str">‘’</span><span class="pun">);</span></li><br><li class="L7"><span class="pun">}</span></li><br><li class="L8"><span class="pun">}</span></li><br><li class="L9"></li><br><li class="L0"><span class="kwd">function</span><span class="pln"> successHandler</span><span class="pun">()</span> <span class="pun">{</span></li><br><li class="L1"><span class="kwd">var</span><span class="pln"> $parent </span><span class="pun">=</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">closest</span><span class="pun">(</span><span class="str">‘.form-group’</span><span class="pun">);</span></li><br><li class="L2"><span class="kwd">if</span> <span class="pun">(!</span><span class="pln">$parent</span><span class="pun">.</span><span class="kwd">is</span><span class="pun">(</span><span class="str">‘.has-warning’</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L3"><span class="pln"> clear</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></li><br><li class="L4"><span class="pun">}</span></li><br><li class="L5"><span class="pun">}</span></li><br><li class="L6"></li><br><li class="L7"><span class="kwd">function</span><span class="pln"> failHandler</span><span class="pun">(</span><span class="pln">msg</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L8"><span class="kwd">var</span><span class="pln"> $parent </span><span class="pun">=</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">closest</span><span class="pun">(</span><span class="str">‘.form-group’</span><span class="pun">);</span></li><br><li class="L9"><span class="pln"> $parent</span><span class="pun">.</span><span class="pln">removeClass</span><span class="pun">(</span><span class="str">‘has-warning waiting’</span><span class="pun">).</span><span class="pln">addClass</span><span class="pun">(</span><span class="str">‘has-error’</span><span class="pun">).</span></li><br><li class="L0"><span class="pln"> attr</span><span class="pun">(</span><span class="str">‘data-for’</span><span class="pun">,</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">prop</span><span class="pun">(</span><span class="str">‘name’</span><span class="pun">)).</span><span class="pln">find</span><span class="pun">(</span><span class="str">‘.help-block’</span><span class="pun">).</span><span class="pln">text</span><span class="pun">(</span><span class="pln">msg</span><span class="pun">);</span></li><br><li class="L1"><span class="pun">}</span></li><br><li class="L2"></li><br><li class="L3"><span class="kwd">function</span><span class="pln"> warningHandler</span><span class="pun">(</span><span class="pln">msg</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L4"><span class="kwd">var</span><span class="pln"> $parent </span><span class="pun">=</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">closest</span><span class="pun">(</span><span class="str">‘.form-group’</span><span class="pun">);</span></li><br><li class="L5"><span class="pln"> $parent</span><span class="pun">.</span><span class="pln">removeClass</span><span class="pun">(</span><span class="str">‘waiting’</span><span class="pun">).</span><span class="pln">addClass</span><span class="pun">(</span><span class="str">‘has-warning’</span><span class="pun">).</span></li><br><li class="L6"><span class="pln"> attr</span><span class="pun">(</span><span class="str">‘data-for’</span><span class="pun">,</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">prop</span><span class="pun">(</span><span class="str">‘name’</span><span class="pun">)).</span><span class="pln">find</span><span class="pun">(</span><span class="str">‘.help-block’</span><span class="pun">).</span><span class="pln">text</span><span class="pun">(</span><span class="pln">msg</span><span class="pun">);</span></li><br><li class="L7"><span class="pun">}</span></li><br></ol><br></div><br><div class="jspVerticalBar"></div><br></div><br><p>&nbsp;</p><br><h2> 这一段一起说，因为这部分内容是dom操作相关的，与bootstrap强相关，如果你不用bootstrap，那就尽情地替换掉吧（估计改几个类名就行了）。这几个函数的用途从名字上就可以看出。clear上面已经提到过，清空验证信息；另外三个分别处理验证通过、验证失败和警告时的信息展示。简单是简单，但这里有两个问题需要额外考虑一下。</h2><br><p>第一个是验证信息优先级的问题：</p><br><p>一个输入项可能同时有多个验证规则要匹配，可能有些验证规则通过，有些失败，有些警告。在具体处理时，我觉得比较合理的流程是：如果出现验证失败，则立刻停止后续验证，直接提示错误信息；如果警告，则提示警告信息，并继续后续规则验证；如果验证成功，理论上不需要做任何处理，直接进行下一步验证，但谨慎起见，还是做一下清空错误信息的工作，但要注意不可以清空掉警告信息（错误信息不用管，因为一产生错误信息，验证也就停止了，不会再触发验证成功了）。</p><br><p>另一个问题是同一个表单单元中有多个输入控件的问题，就像这样：</p><br><p><img src="http://zhouhua.qiniudn.com//wp-content/uploads/2015/04/QQ20150415121912.png" data-original="http://zhouhua.qiniudn.com//wp-content/uploads/2015/04/QQ20150415121912.png" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt="QQ20150415121912" width="586" height="96"></p><br><p>几个控件共用了一个错误信息展示文本，我觉得如果某一个控件输入内容有误，必须再次修改这个控件内容才能清空错误信息，修改别的控件时，这个错误信息应该保留。所以在清除错误信息时，我们额外需要知道这个错误信息是由哪个控件引起的。在上面的示例中，我们在处理验证错误和警告时，把引起问题的控件的<em>name</em>记录到表单单元的<em>data-for</em>属性中了。到需要清空的时候再比对一下<em>data-for</em>和当前控件的<em>name</em>是不是一致，不一致就不清空错误信息。</p><br><h2>处理验证流程</h2><br><p>我们给输入控件的<em>blur</em>和<em>select</em>事件绑定了<em>validate</em>方法，那么这个validate方法如何实现呢？</p><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="kwd">function</span><span class="pln"> validate</span><span class="pun">()</span> <span class="pun">{</span></li><br><li class="L1"><span class="kwd">var</span><span class="pln"> $this </span><span class="pun">=</span><span class="pln"> $</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></li><br><li class="L2"><span class="kwd">var</span><span class="pln"> success </span><span class="pun">=</span> <span class="kwd">new</span><span class="pln"> $</span><span class="pun">.</span><span class="typ">Callbacks</span><span class="pun">();</span></li><br><li class="L3"><span class="kwd">var</span><span class="pln"> fail </span><span class="pun">=</span> <span class="kwd">new</span><span class="pln"> $</span><span class="pun">.</span><span class="typ">Callbacks</span><span class="pun">();</span></li><br><li class="L4"><span class="kwd">var</span><span class="pln"> warning </span><span class="pun">=</span> <span class="kwd">new</span><span class="pln"> $</span><span class="pun">.</span><span class="typ">Callbacks</span><span class="pun">();</span></li><br><li class="L5"><span class="kwd">var</span><span class="pln"> $parent </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">.</span><span class="pln">closest</span><span class="pun">(</span><span class="str">‘.form-group’</span><span class="pun">);</span></li><br><li class="L6"><span class="pln"> success</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="kwd">function</span> <span class="pun">(</span><span class="pln">value</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L7"><span class="pln"> successHandler</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">);</span></li><br><li class="L8"><span class="pun">});</span></li><br><li class="L9"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="kwd">function</span> <span class="pun">(</span><span class="pln">value</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L0"><span class="pln"> failHandler</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">);</span></li><br><li class="L1"><span class="pun">});</span></li><br><li class="L2"><span class="pln"> warning</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="kwd">function</span> <span class="pun">(</span><span class="pln">value</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L3"><span class="pln"> warningHandler</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">);</span></li><br><li class="L4"><span class="pun">});</span></li><br><li class="L5"><span class="pln"> clear</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">);</span></li><br><li class="L6"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">$this</span><span class="pun">.</span><span class="kwd">is</span><span class="pun">(</span><span class="str">‘:disabled’</span><span class="pun">)</span> <span class="pun">||</span><span class="pln"> $this</span><span class="pun">.</span><span class="kwd">is</span><span class="pun">(</span><span class="str">‘[data-validate-disable]’</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L7"><span class="kwd">return</span><span class="pun">;</span></li><br><li class="L8"><span class="pun">}</span></li><br><li class="L9"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">$this</span><span class="pun">.</span><span class="pln">attr</span><span class="pun">(</span><span class="str">‘data-validate’</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L0"><span class="kwd">var</span><span class="pln"> conditions </span><span class="pun">=</span> <span class="pun">(</span><span class="pln">$this</span><span class="pun">.</span><span class="pln">attr</span><span class="pun">(</span><span class="str">‘data-validate’</span><span class="pun">)</span> <span class="pun">||</span> <span class="str">‘’</span><span class="pun">).</span><span class="pln">split</span><span class="pun">(</span><span class="str">/\s+/</span><span class="pln">g</span><span class="pun">);</span></li><br><li class="L1"><span class="kwd">for</span> <span class="pun">(</span><span class="kwd">var</span><span class="pln"> i </span><span class="kwd">in</span></li><br><li class="L2"><span class="pln"> conditions</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L3"><span class="kwd">var</span><span class="pln"> condition </span><span class="pun">=</span><span class="pln"> conditions</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span></li><br><li class="L4"><span class="pln"> $parent</span><span class="pun">.</span><span class="pln">addClass</span><span class="pun">(</span><span class="str">‘waiting’</span><span class="pun">);</span></li><br><li class="L5"><span class="kwd">if</span> <span class="pun">(!</span><span class="pln">pickStrategy</span><span class="pun">(</span><span class="pln">condition</span><span class="pun">.</span><span class="pln">split</span><span class="pun">(</span><span class="str">/[:,]/</span><span class="pln">g</span><span class="pun">),</span><span class="pln"> $this</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">,</span><span class="pln"> warning</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L6"><span class="kwd">break</span><span class="pun">;</span></li><br><li class="L7"><span class="pun">}</span></li><br><li class="L8"><span class="pun">}</span></li><br><li class="L9"><span class="pun">}</span></li><br><li class="L0"><span class="pun">}</span></li><br></ol><br></div><br><div class="jspVerticalBar"></div><br></div><br><p>&nbsp;</p><br><p>先看这段代码的前一部分，我定义了三个$.Callbacks对象，分别用以处理不同验证结果的响应。从效果上，不用$.Callbacks对象，直接传递函数引用也是可行的，我是想把dom操作和验证逻辑分离开，用类似事件触发的异步形式来处理验证逻辑。</p><br><p>再看第17行，它规定了两种情形不执行验证，一种是控件被禁用，另一种是控件中存在<em>data-validate-disable</em>属性。这个不用多解释了。</p><br><p>重点看20~30行，这段是关键。第21行中，我们把<em>data-validate</em>中的内容按空白（空格、tab、换行）切割到一个数组<em>conditions</em>中，<em>conditions</em>中的每一项都是一条需要验证的规则。那么很自然地，遍历这个数组。再看第26行，引入了一个新的方法<em>pickStrategy</em>，很明显它是对这条规则进行验证。先别管它的实现，看看它接收的参数。还记得前面我们说要允许用 rule:param1,param2 的形式给验证规则传入参数吗？<em>pickStrategy</em>拿到的第一个参数就是 [rule, param1, param2] ，通过condition.spit(/[:,]/g) 解析出。第二个参数是当前处理的控件的jquery对象，后面三个分别是验证成功、失败、警告三种情形的回调对象。如果验证失败，<em>pickStrategy</em>应该返回 false ，同时中止验证，否则验证下一条规则。</p><br><h2>策略模式</h2><br><p>下面就要来说<em>pickStrategy</em>方法了，不过先要补充一点背景知识——策略模式。策略模式是一种设计模式。</p><br><p>设计模式是搞软件工程的人常常挂在嘴边的词汇，表示对设计的复用。当然前端开发在工程化的进程上每家公司情况各异，我估计绝大多数公司的前端开发并不考虑工程上的问题，只考虑完成需求。因而对于没有OO编程开发背景的前端开发而言，设计模式可能是陌生的，甚至程序设计（别紧张，没有在说程序编写）本身就是陌生的。由于工程化的忽略和javascript语言本身的优点（很多模式没必要实现）和缺点（很多模式无法实现），前端开发中很少提设计模式。那么前端开发者怎么理解设计模式呢？设计模式就是一系统问题（场景）的通用解决思路。比如有人觉得jquery的链式调用很好用，能很大程度降低工作量，于是在别的地方也用函数 return this; 的方式构造支持链式调用的函数，这就可以认为是一个模式（谈不上设计模式）。</p><br><p>那策略模式是为了解决什么问题，或应对什么场景的呢？如果干一件事、完成一个任务可以有不同的策略，不同的算法来完成，这些策略、算法应该具有相同的输入和输出，但可以使用不同的资源（即不care中间实现差异）。具体要采用什么策略和方法则在程序运行时依据条件选择。举个例子？</p><br><p><img src="http://zhouhua.qiniudn.com//wp-content/uploads/2015/04/QQ20150415155218.png" data-original="http://zhouhua.qiniudn.com//wp-content/uploads/2015/04/QQ20150415155218.png" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt="QQ20150415155218" width="470" height="403"></p><br><p>压缩文件，你可以选择不同的算法，但它们拥有相同的输入和输出。</p><br><p>那么我们做表单验证跟策略模式有什么关系呢？我们完全可以把每个验证规则看作是一个策略，我们支持的所有的策略放在一起，取个高大上的名字叫“策略池”。当我们想验证一个规则的时候，只需要去策略池中取出这个策略跑一下，不需要在一个很大的函数里面跑一堆if…else，或者switch…case。另外如果有新的规则加进来，只要把它塞到策略池中，无需更改已有的代码，<strong>实现验证规则和验证流程解耦</strong>。</p><br><p>先实现一个策略池吧：</p><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">strategy </span><span class="pun">=</span> <span class="pun">{};</span></li><br></ol><br></div><br></div><br><p>&nbsp;</p><br><p>太棒了，一句代码就完事了，爱死javascript了！</p><br><p>再回到<em>pickStrategy</em>方法，看看怎么从这个策略池中拿到我们需要的验证规则：</p><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="kwd">function</span><span class="pln"> pickStrategy</span><span class="pun">(</span><span class="pln">tokens</span><span class="pun">,</span><span class="pln"> scope</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">,</span><span class="pln"> warning</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L1"><span class="kwd">var</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> tokens</span><span class="pun">.</span><span class="pln">shift</span><span class="pun">();</span></li><br><li class="L2"><span class="kwd">var</span><span class="pln"> strategy </span><span class="pun">=</span><span class="pln"> $</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">strategy</span><span class="pun">[</span><span class="pln">name</span><span class="pun">];</span></li><br><li class="L3"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">strategy</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L4"><span class="kwd">return</span><span class="pln"> strategy</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="pln">scope</span><span class="pun">,</span><span class="pln"> tokens</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">,</span><span class="pln"> warning</span><span class="pun">);</span></li><br><li class="L5"><span class="pun">}</span></li><br><li class="L6"><span class="kwd">else</span> <span class="pun">{</span></li><br><li class="L7"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L8"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L9"><span class="pun">}</span></li><br><li class="L0"><span class="pun">}</span></li><br></ol><br></div><br><div class="jspVerticalBar"></div><br></div><br><p>&nbsp;</p><br><p>先说这个<em>token</em>，还记得它是什么吗？如果要验证的规则是“min:5”，那么<em>token</em>就是 [‘min’,’5’] 这个数组。第2行取出这个数组的第一项 ‘min’ ，再从策略池中取出这个验证规则。如果没有这个规则，则跳过这次验证，认为此次通过；如果有这个规则，则执行这个规则（见第5行），需要注意一下第5行的<em>token</em>已经发生变化了，除去规则名称，只剩下参数了，延续前面的例子，这里<em>token</em>应该是 [‘5’] 。</p><br><p>现在我们的策略池是空的，那可不行，先试着写一个验证“min”规则的方法吧：</p><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">strategy</span><span class="pun">.</span><span class="pln">min </span><span class="pun">=</span> <span class="kwd">function</span> <span class="pun">(</span><span class="pln">condition</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L1"><span class="kwd">if</span> <span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">()</span> <span class="pun">===</span> <span class="str">‘’</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L2"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L3"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L4"><span class="pun">}</span></li><br><li class="L5"><span class="kwd">var</span><span class="pln"> length </span><span class="pun">=</span> <span class="pun">+(</span><span class="pln">condition </span><span class="pun">&amp;&amp;</span><span class="pln"> condition</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]);</span></li><br><li class="L6"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">length</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L7"><span class="kwd">if</span> <span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">().</span><span class="pln">length </span><span class="pun">&gt;=</span><span class="pln"> length</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L8"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L9"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L0"><span class="pun">}</span></li><br><li class="L1"><span class="kwd">else</span> <span class="pun">{</span></li><br><li class="L2"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘请至少输入’</span> <span class="pun">+</span><span class="pln"> length </span><span class="pun">+</span> <span class="str">‘个字！’</span><span class="pun">);</span></li><br><li class="L3"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L4"><span class="pun">}</span></li><br><li class="L5"><span class="pun">}</span></li><br><li class="L6"><span class="kwd">else</span> <span class="pun">{</span></li><br><li class="L7"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L8"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L9"><span class="pun">}</span></li><br><li class="L0"><span class="pun">}</span></li><br></ol><br></div><br><div class="jspVerticalBar"></div><br></div><br><p>&nbsp;</p><br><p>这个方法内，<em>this</em>指向当前验证的控件的jquery对象，第1个参数是额外带给验证规则的参数；第2个参数是验证成功的回调，使用时需要配合 return true; （见9、10行）；第3个参数是验证失败的回调，使用是需要配合 return false; （见13、14行）；第4个参数是警告的回调，需要配合return true; ，这个验证中没用到。</p><br><p>起始的几个验证方法也可以直接写在策略池中，我写了几个，供大家参考：</p><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constants </span><span class="pun">=</span> <span class="pun">{</span></li><br><li class="L1"><span class="str">‘request’</span><span class="pun">:</span> <span class="str">/./</span><span class="pun">,</span></li><br><li class="L2"><span class="str">‘trimLeft’</span><span class="pun">:</span> <span class="str">/^\s+/</span><span class="pun">,</span></li><br><li class="L3"><span class="str">‘trimRight’</span><span class="pun">:</span> <span class="str">/\s+$/</span><span class="pun">,</span></li><br><li class="L4"><span class="str">‘trim’</span><span class="pun">:</span> <span class="str">/(^\s+)|(\s+$)/</span><span class="pln">g</span><span class="pun">,</span></li><br><li class="L5"><span class="str">‘number’</span><span class="pun">:</span> <span class="str">/^-?\d+(,\d{3,4})<em>(.\d+)?$/</em></span><span class="pun">,</span></li><br><li class="L6"><span class="str">‘purenumber’</span><span class="pun">:</span> <span class="str">/^\d+$/</span><span class="pun">,</span></li><br><li class="L7"><span class="str">‘shenfenzheng’</span><span class="pun">:</span> <span class="str">/^\d{17}[\dx]$/</span><span class="pln">i</span><span class="pun">,</span></li><br><li class="L8"><span class="str">‘taibaozheng’</span><span class="pun">:</span> <span class="str">/^\d{8}(\d{2})?$/</span><span class="pun">,</span></li><br><li class="L9"><span class="str">‘zhizhao’</span><span class="pun">:</span> <span class="str">/^\d{15}$/</span><span class="pun">,</span></li><br><li class="L0"><span class="str">‘mobile’</span><span class="pun">:</span> <span class="str">/^1[345789]\d{9}$/</span><span class="pun">,</span></li><br><li class="L1"><span class="str">‘telephone’</span><span class="pun">:</span> <span class="str">/^\d{7,8}([ +-]\d+)?$/</span><span class="pun">,</span></li><br><li class="L2"><span class="str">‘email’</span><span class="pun">:</span> <span class="str">/^[a-z0-9.-<em>+]+@[a-z0-9-</em>]+(.[a-z0-9-<em>]+)+$/</em></span><span class="pln">i</span><span class="pun">,</span></li><br><li class="L3"><span class="str">‘url’</span><span class="pun">:</span> <span class="str">/^(https?:\/\/)?(([\d]{1,3}.){3}[\d]{1,3}|([\d\w!~\‘()-]+.)<em>([\d\w][\d\w-]{0,61})?[\d\w].[\w]{2,6})(:[\d]{1,4})?((\/?)|(\/[\d\w_!~</em>\‘().;?:@&amp;=+$,%#-]+)+\/?)$/</span></li><br><li class="L4"><span class="pun">};</span></li><br><li class="L5"><span class="pln"> </span></li><br><li class="L6"><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">strategy </span><span class="pun">=</span> <span class="pun">{</span></li><br><li class="L7"><span class="str">‘request’</span><span class="pun">:</span> <span class="kwd">function</span> <span class="pun">(</span><span class="pln">condition</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L8"><span class="kwd">if</span> <span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">is</span><span class="pun">(</span><span class="str">“[type=checkbox]”</span><span class="pun">)</span> <span class="pun">||</span> <span class="kwd">this</span><span class="pun">.</span><span class="kwd">is</span><span class="pun">(</span><span class="str">“[type=radio]”</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L9"><span class="kwd">var</span><span class="pln"> name </span><span class="pun">=</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">attr</span><span class="pun">(</span><span class="str">“name”</span><span class="pun">);</span></li><br><li class="L0"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">name</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L1"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">$</span><span class="pun">(</span><span class="str">“[name=”</span> <span class="pun">+</span><span class="pln"> name </span><span class="pun">+</span> <span class="str">“]:checked”</span><span class="pun">).</span><span class="pln">length</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L2"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L3"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L4"><span class="pun">}</span></li><br><li class="L5"><span class="kwd">else</span> <span class="pun">{</span></li><br><li class="L6"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘不能为空！’</span><span class="pun">);</span></li><br><li class="L7"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L8"><span class="pun">}</span></li><br><li class="L9"><span class="pun">}</span></li><br><li class="L0"><span class="kwd">else</span> <span class="pun">{</span></li><br><li class="L1"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L2"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L3"><span class="pun">}</span></li><br><li class="L4"><span class="pun">}</span></li><br><li class="L5"><span class="kwd">else</span> <span class="pun">{</span></li><br><li class="L6"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">condition </span><span class="pun">&amp;&amp;</span><span class="pln"> condition</span><span class="pun">[</span><span class="lit">0</span><span class="pun">])</span> <span class="pun">{</span></li><br><li class="L7"><span class="kwd">switch</span> <span class="pun">(</span><span class="pln">condition</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">toLowerCase</span><span class="pun">())</span> <span class="pun">{</span></li><br><li class="L8"><span class="kwd">case</span> <span class="str">‘notrim’</span><span class="pun">:</span></li><br><li class="L9"><span class="kwd">break</span><span class="pun">;</span></li><br><li class="L0"><span class="kwd">case</span> <span class="str">‘trimleft’</span><span class="pun">:</span></li><br><li class="L1"><span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">().</span><span class="pln">replace</span><span class="pun">(</span><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="pln">trimLeft</span><span class="pun">,</span> <span class="str">‘’</span><span class="pun">));</span></li><br><li class="L2"><span class="kwd">break</span><span class="pun">;</span></li><br><li class="L3"><span class="kwd">case</span> <span class="str">‘trimright’</span><span class="pun">:</span></li><br><li class="L4"><span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">().</span><span class="pln">replace</span><span class="pun">(</span><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="pln">trimRight</span><span class="pun">,</span> <span class="str">‘’</span><span class="pun">));</span></li><br><li class="L5"><span class="kwd">break</span><span class="pun">;</span></li><br><li class="L6"><span class="kwd">default</span><span class="pun">:</span></li><br><li class="L7"><span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">().</span><span class="pln">replace</span><span class="pun">(</span><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="pln">trim</span><span class="pun">,</span> <span class="str">‘’</span><span class="pun">));</span></li><br><li class="L8"><span class="kwd">break</span><span class="pun">;</span></li><br><li class="L9"><span class="pun">}</span></li><br><li class="L0"><span class="pun">}</span></li><br><li class="L1"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="pln">request</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">()))</span> <span class="pun">{</span></li><br><li class="L2"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L3"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L4"><span class="pun">}</span></li><br><li class="L5"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘不能为空！’</span><span class="pun">);</span></li><br><li class="L6"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L7"><span class="pun">}</span></li><br><li class="L8"><span class="pun">},</span></li><br><li class="L9"><span class="str">‘min’</span><span class="pun">:</span> <span class="kwd">function</span> <span class="pun">(</span><span class="pln">condition</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L0"><span class="kwd">if</span> <span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">()</span> <span class="pun">===</span> <span class="str">‘’</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L1"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L2"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L3"><span class="pun">}</span></li><br><li class="L4"><span class="kwd">var</span><span class="pln"> length </span><span class="pun">=</span> <span class="pun">+(</span><span class="pln">condition </span><span class="pun">&amp;&amp;</span><span class="pln"> condition</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]);</span></li><br><li class="L5"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">length</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L6"><span class="kwd">if</span> <span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">().</span><span class="pln">length </span><span class="pun">&gt;=</span><span class="pln"> length</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L7"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L8"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L9"><span class="pun">}</span></li><br><li class="L0"><span class="kwd">else</span> <span class="pun">{</span></li><br><li class="L1"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘请至少输入’</span> <span class="pun">+</span><span class="pln"> length </span><span class="pun">+</span> <span class="str">‘个字！’</span><span class="pun">);</span></li><br><li class="L2"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L3"><span class="pun">}</span></li><br><li class="L4"><span class="pun">}</span></li><br><li class="L5"><span class="kwd">else</span> <span class="pun">{</span></li><br><li class="L6"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L7"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L8"><span class="pun">}</span></li><br><li class="L9"><span class="pun">},</span></li><br><li class="L0"><span class="str">‘max’</span><span class="pun">:</span> <span class="kwd">function</span> <span class="pun">(</span><span class="pln">condition</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L1"><span class="kwd">var</span><span class="pln"> length </span><span class="pun">=</span> <span class="pun">+(</span><span class="pln">condition </span><span class="pun">&amp;&amp;</span><span class="pln"> condition</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]);</span></li><br><li class="L2"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">length</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L3"><span class="kwd">if</span> <span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">().</span><span class="pln">length </span><span class="pun">&lt;=</span><span class="pln"> length</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L4"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L5"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L6"><span class="pun">}</span></li><br><li class="L7"><span class="kwd">else</span> <span class="pun">{</span></li><br><li class="L8"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘不能超过’</span> <span class="pun">+</span><span class="pln"> length </span><span class="pun">+</span> <span class="str">‘个字！’</span><span class="pun">);</span></li><br><li class="L9"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L0"><span class="pun">}</span></li><br><li class="L1"><span class="pun">}</span></li><br><li class="L2"><span class="kwd">else</span> <span class="pun">{</span></li><br><li class="L3"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L4"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L5"><span class="pun">}</span></li><br><li class="L6"><span class="pun">},</span></li><br><li class="L7"><span class="str">‘number’</span><span class="pun">:</span> <span class="kwd">function</span> <span class="pun">(</span><span class="pln">condition</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L8"><span class="kwd">var</span><span class="pln"> value </span><span class="pun">=</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">();</span></li><br><li class="L9"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">value </span><span class="pun">===</span> <span class="str">‘’</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L0"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L1"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L2"><span class="pun">}</span></li><br><li class="L3"><span class="pln"> condition </span><span class="pun">=</span><span class="pln"> condition </span><span class="pun">||</span> <span class="pun">[];</span></li><br><li class="L4"><span class="kwd">if</span> <span class="pun">(!</span><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="pln">number</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">value</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L5"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘请输入数字！’</span><span class="pun">);</span></li><br><li class="L6"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L7"><span class="pun">}</span></li><br><li class="L8"><span class="kwd">for</span> <span class="pun">(</span><span class="kwd">var</span><span class="pln"> i </span><span class="kwd">in</span></li><br><li class="L9"><span class="pln"> condition</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L0"><span class="kwd">var</span><span class="pln"> c </span><span class="pun">=</span><span class="pln"> condition</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">toLowerCase</span><span class="pun">();</span></li><br><li class="L1"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">c </span><span class="pun">===</span> <span class="str">‘pure’</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L2"><span class="kwd">if</span> <span class="pun">(!</span><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="pln">purenumber</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">value</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L3"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘请输入0~9组成的数字！’</span><span class="pun">);</span></li><br><li class="L4"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L5"><span class="pun">}</span></li><br><li class="L6"><span class="pun">}</span></li><br><li class="L7"><span class="kwd">else</span> <span class="kwd">if</span> <span class="pun">(</span><span class="str">/^\d+[~-]\d+$/</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">c</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L8"><span class="kwd">var</span><span class="pln"> match </span><span class="pun">=</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">match</span><span class="pun">(</span><span class="str">/\d+/</span><span class="pln">g</span><span class="pun">);</span></li><br><li class="L9"><span class="kwd">var</span><span class="pln"> length </span><span class="pun">=</span><span class="pln"> value</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></li><br><li class="L0"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">length </span><span class="pun">&lt;</span> <span class="pun">+</span><span class="pln">match</span><span class="pun">[</span><span class="lit">0</span><span class="pun">])</span> <span class="pun">{</span></li><br><li class="L1"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘请至少输入’</span> <span class="pun">+</span><span class="pln"> match</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span> <span class="pun">+</span> <span class="str">‘位数字！’</span><span class="pun">);</span></li><br><li class="L2"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L3"><span class="pun">}</span></li><br><li class="L4"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">length </span><span class="pun">&gt;</span> <span class="pun">+</span><span class="pln">match</span><span class="pun">[</span><span class="lit">1</span><span class="pun">])</span> <span class="pun">{</span></li><br><li class="L5"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘最多只能输入’</span> <span class="pun">+</span><span class="pln"> match</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span> <span class="pun">+</span> <span class="str">‘位数字！’</span><span class="pun">);</span></li><br><li class="L6"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L7"><span class="pun">}</span></li><br><li class="L8"><span class="pun">}</span></li><br><li class="L9"><span class="kwd">else</span> <span class="kwd">if</span> <span class="pun">(</span><span class="str">/^\d+$/</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">c</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L0"><span class="kwd">if</span> <span class="pun">(+</span><span class="pln">c </span><span class="pun">!==</span><span class="pln"> value</span><span class="pun">.</span><span class="pln">length</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L1"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘请输入’</span> <span class="pun">+</span><span class="pln"> c </span><span class="pun">+</span> <span class="str">‘位数字！’</span><span class="pun">);</span></li><br><li class="L2"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L3"><span class="pun">}</span></li><br><li class="L4"><span class="pun">}</span></li><br><li class="L5"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L6"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L7"><span class="pun">}</span></li><br><li class="L8"><span class="pun">},</span></li><br><li class="L9"><span class="str">‘mobile’</span><span class="pun">:</span> <span class="kwd">function</span> <span class="pun">(</span><span class="pln">condition</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L0"><span class="kwd">var</span><span class="pln"> value </span><span class="pun">=</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">();</span></li><br><li class="L1"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">value </span><span class="pun">===</span> <span class="str">‘’</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L2"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L3"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L4"><span class="pun">}</span></li><br><li class="L5"><span class="kwd">if</span> <span class="pun">(!</span><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="pln">mobile</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">value</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L6"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘手机号码输入有误，请检查后重新输入！’</span><span class="pun">);</span></li><br><li class="L7"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L8"><span class="pun">}</span></li><br><li class="L9"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L0"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L1"><span class="pun">},</span></li><br><li class="L2"><span class="str">‘url’</span><span class="pun">:</span> <span class="kwd">function</span> <span class="pun">(</span><span class="pln">condition</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L3"><span class="kwd">var</span><span class="pln"> value </span><span class="pun">=</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">();</span></li><br><li class="L4"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">value </span><span class="pun">===</span> <span class="str">‘’</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L5"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L6"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L7"><span class="pun">}</span></li><br><li class="L8"><span class="kwd">if</span> <span class="pun">(!</span><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="pln">url</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">value</span><span class="pun">.</span><span class="pln">toLowerCase</span><span class="pun">()))</span> <span class="pun">{</span></li><br><li class="L9"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘请输入正确的网址！如<a href="http://www.baidu.com" target="_blank" rel="external">http://www.baidu.com</a>‘</span><span class="pun">);</span></li><br><li class="L0"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L1"><span class="pun">}</span></li><br><li class="L2"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L3"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L4"><span class="pun">},</span></li><br><li class="L5"><span class="str">‘email’</span><span class="pun">:</span> <span class="kwd">function</span> <span class="pun">(</span><span class="pln">condition</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L6"><span class="kwd">var</span><span class="pln"> value </span><span class="pun">=</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">();</span></li><br><li class="L7"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">value </span><span class="pun">===</span> <span class="str">‘’</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L8"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L9"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L0"><span class="pun">}</span></li><br><li class="L1"><span class="kwd">if</span> <span class="pun">(!</span><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="pln">email</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">value</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L2"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘电子邮箱格式错误，请检查后重新输入！’</span><span class="pun">);</span></li><br><li class="L3"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L4"><span class="pun">}</span></li><br><li class="L5"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L6"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L7"><span class="pun">},</span></li><br><li class="L8"><span class="str">‘telephone’</span><span class="pun">:</span> <span class="kwd">function</span> <span class="pun">(</span><span class="pln">condition</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L9"><span class="kwd">var</span><span class="pln"> value </span><span class="pun">=</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">();</span></li><br><li class="L0"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">value </span><span class="pun">===</span> <span class="str">‘’</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L1"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L2"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L3"><span class="pun">}</span></li><br><li class="L4"><span class="kwd">if</span> <span class="pun">(!</span><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="pln">telephone</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">value</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L5"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘电话号码输入有误，请检查后重新输入！！’</span><span class="pun">);</span></li><br><li class="L6"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L7"><span class="pun">}</span></li><br><li class="L8"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L9"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L0"><span class="pun">},</span></li><br><li class="L1"><span class="str">‘shenfenzheng’</span><span class="pun">:</span> <span class="kwd">function</span> <span class="pun">(</span><span class="pln">condition</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L2"><span class="kwd">var</span><span class="pln"> value </span><span class="pun">=</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">();</span></li><br><li class="L3"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">value </span><span class="pun">===</span> <span class="str">‘’</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L4"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L5"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L6"><span class="pun">}</span></li><br><li class="L7"><span class="pln"> value </span><span class="pun">=</span><span class="pln"> value</span><span class="pun">.</span><span class="pln">toLowerCase</span><span class="pun">();</span></li><br><li class="L8"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="pln">shenfenzheng</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">value</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L9"><span class="kwd">var</span><span class="pln"> numbers </span><span class="pun">=</span><span class="pln"> value</span><span class="pun">.</span><span class="pln">toLowerCase</span><span class="pun">().</span><span class="pln">split</span><span class="pun">(</span><span class="str">‘’</span><span class="pun">);</span></li><br><li class="L0"><span class="com">// 验证地区</span></li><br><li class="L1"><span class="kwd">var</span><span class="pln"> aCity </span><span class="pun">=</span> <span class="pun">{</span></li><br><li class="L2"><span class="lit">11</span><span class="pun">:</span> <span class="str">‘北京’</span><span class="pun">,</span></li><br><li class="L3"><span class="lit">12</span><span class="pun">:</span> <span class="str">‘天津’</span><span class="pun">,</span></li><br><li class="L4"><span class="lit">13</span><span class="pun">:</span> <span class="str">‘河北’</span><span class="pun">,</span></li><br><li class="L5"><span class="lit">14</span><span class="pun">:</span> <span class="str">‘山西’</span><span class="pun">,</span></li><br><li class="L6"><span class="lit">15</span><span class="pun">:</span> <span class="str">‘内蒙古’</span><span class="pun">,</span></li><br><li class="L7"><span class="lit">21</span><span class="pun">:</span> <span class="str">‘辽宁’</span><span class="pun">,</span></li><br><li class="L8"><span class="lit">22</span><span class="pun">:</span> <span class="str">‘吉林’</span><span class="pun">,</span></li><br><li class="L9"><span class="lit">23</span><span class="pun">:</span> <span class="str">‘黑龙江’</span><span class="pun">,</span></li><br><li class="L0"><span class="lit">31</span><span class="pun">:</span> <span class="str">‘上海’</span><span class="pun">,</span></li><br><li class="L1"><span class="lit">32</span><span class="pun">:</span> <span class="str">‘江苏’</span><span class="pun">,</span></li><br><li class="L2"><span class="lit">33</span><span class="pun">:</span> <span class="str">‘浙江’</span><span class="pun">,</span></li><br><li class="L3"><span class="lit">34</span><span class="pun">:</span> <span class="str">‘安徽’</span><span class="pun">,</span></li><br><li class="L4"><span class="lit">35</span><span class="pun">:</span> <span class="str">‘福建’</span><span class="pun">,</span></li><br><li class="L5"><span class="lit">36</span><span class="pun">:</span> <span class="str">‘江西’</span><span class="pun">,</span></li><br><li class="L6"><span class="lit">37</span><span class="pun">:</span> <span class="str">‘山东’</span><span class="pun">,</span></li><br><li class="L7"><span class="lit">41</span><span class="pun">:</span> <span class="str">‘河南’</span><span class="pun">,</span></li><br><li class="L8"><span class="lit">42</span><span class="pun">:</span> <span class="str">‘湖北’</span><span class="pun">,</span></li><br><li class="L9"><span class="lit">43</span><span class="pun">:</span> <span class="str">‘湖南’</span><span class="pun">,</span></li><br><li class="L0"><span class="lit">44</span><span class="pun">:</span> <span class="str">‘广东’</span><span class="pun">,</span></li><br><li class="L1"><span class="lit">45</span><span class="pun">:</span> <span class="str">‘广西’</span><span class="pun">,</span></li><br><li class="L2"><span class="lit">46</span><span class="pun">:</span> <span class="str">‘海南’</span><span class="pun">,</span></li><br><li class="L3"><span class="lit">50</span><span class="pun">:</span> <span class="str">‘重庆’</span><span class="pun">,</span></li><br><li class="L4"><span class="lit">51</span><span class="pun">:</span> <span class="str">‘四川’</span><span class="pun">,</span></li><br><li class="L5"><span class="lit">52</span><span class="pun">:</span> <span class="str">‘贵州’</span><span class="pun">,</span></li><br><li class="L6"><span class="lit">53</span><span class="pun">:</span> <span class="str">‘云南’</span><span class="pun">,</span></li><br><li class="L7"><span class="lit">54</span><span class="pun">:</span> <span class="str">‘西藏’</span><span class="pun">,</span></li><br><li class="L8"><span class="lit">61</span><span class="pun">:</span> <span class="str">‘陕西’</span><span class="pun">,</span></li><br><li class="L9"><span class="lit">62</span><span class="pun">:</span> <span class="str">‘甘肃’</span><span class="pun">,</span></li><br><li class="L0"><span class="lit">63</span><span class="pun">:</span> <span class="str">‘青海’</span><span class="pun">,</span></li><br><li class="L1"><span class="lit">64</span><span class="pun">:</span> <span class="str">‘宁夏’</span><span class="pun">,</span></li><br><li class="L2"><span class="lit">65</span><span class="pun">:</span> <span class="str">‘新疆’</span><span class="pun">,</span></li><br><li class="L3"><span class="lit">71</span><span class="pun">:</span> <span class="str">‘台湾’</span><span class="pun">,</span></li><br><li class="L4"><span class="lit">81</span><span class="pun">:</span> <span class="str">‘香港’</span><span class="pun">,</span></li><br><li class="L5"><span class="lit">82</span><span class="pun">:</span> <span class="str">‘澳门’</span><span class="pun">,</span></li><br><li class="L6"><span class="lit">91</span><span class="pun">:</span> <span class="str">‘国外’</span></li><br><li class="L7"><span class="pun">};</span></li><br><li class="L8"><span class="kwd">if</span> <span class="pun">(!</span><span class="pln">aCity</span><span class="pun">[</span><span class="pln">numbers</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span> <span class="pun">+</span><span class="pln"> numbers</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]])</span> <span class="pun">{</span></li><br><li class="L9"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘身份证格式有误，请检查后重新输入！’</span><span class="pun">);</span></li><br><li class="L0"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L1"><span class="pun">}</span></li><br><li class="L2"><span class="kwd">var</span><span class="pln"> wi </span><span class="pun">=</span> <span class="pun">[</span><span class="lit">7</span><span class="pun">,</span> <span class="lit">9</span><span class="pun">,</span> <span class="lit">10</span><span class="pun">,</span> <span class="lit">5</span><span class="pun">,</span> <span class="lit">8</span><span class="pun">,</span> <span class="lit">4</span><span class="pun">,</span> <span class="lit">2</span><span class="pun">,</span> <span class="lit">1</span><span class="pun">,</span> <span class="lit">6</span><span class="pun">,</span> <span class="lit">3</span><span class="pun">,</span> <span class="lit">7</span><span class="pun">,</span> <span class="lit">9</span><span class="pun">,</span> <span class="lit">10</span><span class="pun">,</span> <span class="lit">5</span><span class="pun">,</span> <span class="lit">8</span><span class="pun">,</span> <span class="lit">4</span><span class="pun">,</span> <span class="lit">2</span><span class="pun">];</span></li><br><li class="L3"><span class="kwd">var</span><span class="pln"> check </span><span class="pun">=</span> <span class="pun">[</span><span class="str">‘1’</span><span class="pun">,</span> <span class="str">‘0’</span><span class="pun">,</span> <span class="str">‘x’</span><span class="pun">,</span> <span class="str">‘9’</span><span class="pun">,</span> <span class="str">‘8’</span><span class="pun">,</span> <span class="str">‘7’</span><span class="pun">,</span> <span class="str">‘6’</span><span class="pun">,</span> <span class="str">‘5’</span><span class="pun">,</span> <span class="str">‘4’</span><span class="pun">,</span> <span class="str">‘3’</span><span class="pun">,</span> <span class="str">‘2’</span><span class="pun">];</span></li><br><li class="L4"><span class="kwd">var</span><span class="pln"> _sum </span><span class="pun">=</span> <span class="lit">0</span><span class="pun">;</span></li><br><li class="L5"><span class="kwd">for</span> <span class="pun">(</span><span class="kwd">var</span><span class="pln"> i </span><span class="pun">=</span> <span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span> <span class="lit">17</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span> <span class="pun">{</span></li><br><li class="L6"><span class="pln"> _sum </span><span class="pun">+=</span> <span class="pun">+</span><span class="pln">numbers</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span> <span class="pun"><em></em></span> <span class="pun">+</span><span class="pln">wi</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span></li><br><li class="L7"><span class="pun">}</span></li><br><li class="L8"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">numbers</span><span class="pun">[</span><span class="lit">17</span><span class="pun">]</span> <span class="pun">!=</span><span class="pln"> check</span><span class="pun">[</span><span class="pln">_sum </span><span class="pun">%</span> <span class="lit">11</span><span class="pun">])</span> <span class="pun">{</span></li><br><li class="L9"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘身份证格式有误，请检查后重新输入！’</span><span class="pun">);</span></li><br><li class="L0"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L1"><span class="pun">}</span></li><br><li class="L2"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L3"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L4"><span class="pun">}</span></li><br><li class="L5"><span class="kwd">else</span> <span class="pun">{</span></li><br><li class="L6"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘请输入18位身份证！’</span><span class="pun">);</span></li><br><li class="L7"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L8"><span class="pun">}</span></li><br><li class="L9"><span class="pun">},</span></li><br><li class="L0"><span class="str">‘taibaozheng’</span><span class="pun">:</span> <span class="kwd">function</span> <span class="pun">(</span><span class="pln">condition</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L1"><span class="kwd">var</span><span class="pln"> value </span><span class="pun">=</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">();</span></li><br><li class="L2"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">value </span><span class="pun">===</span> <span class="str">‘’</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L3"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L4"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L5"><span class="pun">}</span></li><br><li class="L6"><span class="kwd">if</span> <span class="pun">(!</span><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="pln">taibaozheng</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">value</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L7"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘台胞证格式有误，请检查后重新输入！’</span><span class="pun">);</span></li><br><li class="L8"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L9"><span class="pun">}</span></li><br><li class="L0"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L1"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L2"><span class="pun">},</span></li><br><li class="L3"><span class="str">‘zhizhao’</span><span class="pun">:</span> <span class="kwd">function</span> <span class="pun">(</span><span class="pln">condition</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L4"><span class="kwd">var</span><span class="pln"> value </span><span class="pun">=</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">();</span></li><br><li class="L5"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">value </span><span class="pun">===</span> <span class="str">‘’</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L6"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L7"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L8"><span class="pun">}</span></li><br><li class="L9"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="pln">zhizhao</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">value</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L0"><span class="kwd">var</span><span class="pln"> p </span><span class="pun">=</span> <span class="lit">10</span><span class="pun">;</span></li><br><li class="L1"><span class="kwd">var</span><span class="pln"> s</span><span class="pun">;</span></li><br><li class="L2"><span class="kwd">var</span><span class="pln"> a</span><span class="pun">;</span></li><br><li class="L3"><span class="kwd">var</span><span class="pln"> numbers </span><span class="pun">=</span><span class="pln"> value</span><span class="pun">.</span><span class="pln">split</span><span class="pun">(</span><span class="str">‘’</span><span class="pun">);</span></li><br><li class="L4"><span class="kwd">for</span> <span class="pun">(</span><span class="kwd">var</span><span class="pln"> i </span><span class="pun">=</span> <span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span> <span class="lit">15</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span> <span class="pun">{</span></li><br><li class="L5"><span class="pln"> a </span><span class="pun">=</span> <span class="pun">+</span><span class="pln">numbers</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span></li><br><li class="L6"><span class="pln"> s </span><span class="pun">=</span> <span class="pun">(</span><span class="pln">p </span><span class="pun">%</span> <span class="lit">11</span><span class="pun">)</span> <span class="pun">+</span><span class="pln"> a</span><span class="pun">;</span></li><br><li class="L7"><span class="pln"> p </span><span class="pun">=</span> <span class="pun">(</span><span class="pln">s </span><span class="pun">%</span> <span class="lit">10</span><span class="pun">)</span> <span class="pun"></span> <span class="lit">2</span><span class="pun">;</span></li><br><li class="L8"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">p </span><span class="pun">===</span> <span class="lit">0</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L9"><span class="pln"> p </span><span class="pun">=</span> <span class="lit">20</span><span class="pun">;</span></li><br><li class="L0"><span class="pun">}</span></li><br><li class="L1"><span class="pun">}</span></li><br><li class="L2"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">s </span><span class="pun">%</span> <span class="lit">10</span> <span class="pun">!==</span> <span class="lit">1</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L3"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘工商营业执照输入有误，请检查后重新输入！’</span><span class="pun">);</span></li><br><li class="L4"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L5"><span class="pun">}</span></li><br><li class="L6"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L7"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L8"><span class="pun">}</span></li><br><li class="L9"><span class="kwd">else</span> <span class="pun">{</span></li><br><li class="L0"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘请输入15位工商营业执照！’</span><span class="pun">);</span></li><br><li class="L1"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L2"><span class="pun">}</span></li><br><li class="L3"><span class="pun">}</span></li><br><li class="L4"><span class="pun">};</span></li><br></ol><br></div><br><div class="jspVerticalBar"></div><br><div class="jspHorizontalBar"></div><br></div><br><p>&nbsp;</p><br><p>&nbsp;</p><br><h2>添加验证规则</h2><br><p>说好的支持自定义验证规则呢？放心，不会少的，而且超简单：</p><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="pln">$</span><span class="pun">.</span><span class="pln">validation </span><span class="pun">=</span> <span class="kwd">function</span> <span class="pun">(</span><span class="pln">condition</span><span class="pun">,</span><span class="pln"> process</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L1"><span class="pln"> $</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">strategy</span><span class="pun">[</span><span class="pln">condition</span><span class="pun">]</span> <span class="pun">=</span><span class="pln"> process</span><span class="pun">;</span></li><br><li class="L2"><span class="pun">};</span></li><br></ol><br></div><br></div><br><p>&nbsp;</p><br><p>加个静态方法搞定。</p><br><h2>手动发起验证</h2><br><p>有些场景下需要手动check一下表单内容才放心吧：</p><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="pln">$</span><span class="pun">.</span><span class="pln">fn</span><span class="pun">.</span><span class="kwd">exec</span> <span class="pun">=</span> <span class="kwd">function</span> <span class="pun">()</span> <span class="pun">{</span></li><br><li class="L1"><span class="kwd">return</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">each</span><span class="pun">(</span><span class="kwd">function</span> <span class="pun">()</span> <span class="pun">{</span></li><br><li class="L2"><span class="kwd">var</span><span class="pln"> $this </span><span class="pun">=</span><span class="pln"> $</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></li><br><li class="L3"><span class="kwd">if</span> <span class="pun">(!</span><span class="pln">$this</span><span class="pun">.</span><span class="kwd">is</span><span class="pun">(</span><span class="str">‘:input’</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L4"><span class="pln"> $this </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="str">‘:input’</span><span class="pun">);</span></li><br><li class="L5"><span class="pun">}</span></li><br><li class="L6"><span class="pln"> $this</span><span class="pun">.</span><span class="pln">blur</span><span class="pun">();</span></li><br><li class="L7"><span class="pun">});</span></li><br><li class="L8"><span class="pun">};</span></li><br></ol><br></div><br></div><br><p>&nbsp;</p><br><p>原理很简单，对:input子元素触发一次blur事件。</p><br><h2>还有一些是我没有做的</h2><br><p>都不是很复杂，因为我的业务场景不关注这些，所以就懒过去了。</p><br><ol><br><li>没做通用的ajax验证<br><br>现在对于ajax的验证，可以这样做：<p></p><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">(</span><span class="str">‘ajax_xx’</span><span class="pun">,</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">c</span><span class="pun">,</span><span class="pln"> s</span><span class="pun">,</span><span class="pln"> f</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L1"><span class="pln"> $</span><span class="pun">.</span><span class="pln">post</span><span class="pun">(</span><span class="str">‘some_url’</span><span class="pun">,</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">data</span><span class="pun">){</span></li><br><li class="L2"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">data</span><span class="pun">.</span><span class="pln">success</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L3"><span class="pln"> s</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L4"><span class="pun">}</span><span class="kwd">else</span><span class="pun">{</span></li><br><li class="L5"><span class="pln"> f</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘xxxxxxxx’</span><span class="pun">);</span></li><br><li class="L6"><span class="pun">}</span></li><br><li class="L7"><span class="pun">});</span></li><br><li class="L8"><span class="pun">});</span></li><br></ol><br></div><br></div><br><p>&nbsp;</p><br><p>表单提交前，除了检查有没有.has-error的元素找到填写出错项，还要检查有没有.wait元素，如果有的话都不能立刻提交。<br><br>如果要有一个通用的ajax验证机制，可以自行扩展<em>$.validation</em>方法</p></li><br><li>没做验证失败时表单提交阻断<br><br>正如上一条中说的，表单提交前，需要检查.has-error和.wait元素，可以自行扩展<em>$.fn.validation</em>方法，添加form的submit事件绑定。</li><br><li>没有为handle验证状态的dom操作提供接口<br><br>不想做，bootstrap挺好的。</li><br><li>没有测试用例<br><br>不打算给这些代码添加逻辑了，不想写测试用例。</li><br></ol><br><h2>下载</h2><br><p><a href="http://zhouhua.qiniudn.com//wp-content/uploads/2015/04/validation.js" target="_blank">validation.js</a></p><br><blockquote><p>博客地址：<a href="http://www.zhouhua.info/2015/04/15/validation/" target="_blank">http://www.zhouhua.info/2015/04/15/validation/</a></p></blockquote>





      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-106ver" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/20/106ver/" class="article-date">
  	<time datetime="2015-10-20T14:15:38.450Z" itemprop="datePublished">2015-10-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/20/106ver/">深入理解Javascript之this关键字</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>转自<a href="http://www.laruence.com/2009/09/08/1076.html" target="_blank" rel="external">http://www.laruence.com/2009/09/08/1076.html</a></p><br><h1>08 Sep 09 <a title="Permanent Link to 深入理解Javascript之this关键字" href="http://www.laruence.com/2009/09/08/1076.html" rel="external" target="_blank">深入理解Javascript之this关键字</a></h1><br><div class="copyright"><br><ul><br><li>作者: <a href="http://www.laruence.com/" target="_blank" rel="external">Laruence</a>(<a title="Twitter" href="http://www.twitter.com/laruence" target="meme"><img src="http://www.laruence.com/images/ico-twitter.png" data-original="http://www.laruence.com/images/ico-twitter.png" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt=""></a> <a title="新浪微博" href="http://t.sina.com/laruence" target="meme"><img src="http://www.laruence.com/images/ico-sina.png" data-original="http://www.laruence.com/images/ico-sina.png" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt=""></a> <a title="Google阅读器" href="http://fusion.google.com/add?feedurl=http://www.laruence.com/feed" target="meme"><img src="http://www.laruence.com/images/ico-google.png" data-original="http://www.laruence.com/images/ico-google.png" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt=""></a> <a title="邮件" href="mailto:laruence@yahoo.com.cn" target="meme"><img src="http://www.laruence.com/images/ico-mail.png" data-original="http://www.laruence.com/images/ico-mail.png" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt=""></a>)</li><br><li>本文地址: <a title="Permanet Link to 深入理解Javascript之this关键字" href="http://www.laruence.com/2009/09/08/1076.html" target="_blank" rel="external">http://www.laruence.com/2009/09/08/1076.html</a></li><br><li>转载请注明出处</li><br></ul><br></div><br><p>Javascript是一种很灵活的语言, 而This关键字又是灵活中的灵活, 但是因为它的灵活, 也注定了它的难用.</p><br><p>以前我用this的时候, 都会觉得不踏实, 老是担心它不知道怎么地就会指到另外的什么地方.</p><br><p>其实, 这都是因为, 我们对它的不了解.</p><br><p>刚好最近再给百度学院做《Javascript高级-作用域/原型链》的ppt, 而swit1983网友也刚好提这个问题, 索性就把这部分内容独立总结出来, 与大家分享.</p><br><p>首先, 我先抛出一个定论:”在Javascript中,This关键字永远都指向函数(方法)的所有者”.</p><br><h3>函数</h3><br><p>首先,让我们看看”函数”:</p><br><ol><br><li><span class="sh_keyword">function</span> <span class="sh_function">introduce</span><span class="sh_symbol">()</span> <span class="sh_cbracket">{</span></li><br><li>     <span class="sh_function">alert</span><span class="sh_symbol">(</span><span class="sh_string">“Hello, I am Laruence</span><span class="sh_specialchar">\r\n</span><span class="sh_string">“</span><span class="sh_symbol">);</span></li><br><li><span class="sh_cbracket">}</span></li><br></ol><br><p>对于,这个函数, this关键字指向谁呢?</p><br><p>如我之前的文章所述(<a href="http://www.laruence.com/2009/05/28/863.html" target="_blank">Javascript作用域</a>), 定义在全局的函数, 函数的所有者就是当前页面, 也就是window对象.</p><br><p>这也就是为什么, 我把函数用引号引起来. 因为定义在全局的函数, 其实也就是window对象的一个方法.</p><br><p>所以,我们即可用通过函数名直接调用, 也可用通过window.方法名来调用, 这个时候, 方法中的this关键字指向它的所有者:window对象.</p><br><p>如果, 我们查看window的introduce属性, 就会得到:</p><br><ol><br><li><span class="sh_keyword">var</span> name <span class="sh_symbol">=</span> <span class="sh_string">“I am Laruence”</span><span class="sh_symbol">;</span></li><br><li><span class="sh_keyword">function</span> <span class="sh_function">introduce</span><span class="sh_symbol">()</span> <span class="sh_cbracket">{</span></li><br><li>     <span class="sh_function">alert</span><span class="sh_symbol">(</span><span class="sh_keyword">this</span><span class="sh_symbol">.</span>name<span class="sh_symbol">);</span></li><br><li><span class="sh_cbracket">}</span></li><br><li><span class="sh_function">alert</span><span class="sh_symbol">(</span>window<span class="sh_symbol">.</span>introduce<span class="sh_symbol">);</span></li><br><li><span class="sh_comment">/<strong></strong></span></li><br><li><span class="sh_comment"><em> output:</em></span></li><br><li><span class="sh_comment"> function introduce() {</span></li><br><li><span class="sh_comment"><em> alert(this.name);</em></span></li><br><li><span class="sh_comment"> }</span></li><br><li><span class="sh_comment">*/</span></li><br></ol><br><p>看了上面的代码, 也许你就会想到既然, 全局函数是window对象的方法, 全局变量是window对象的属性(Javasript作用域中已有述及), 那么,在全局函数中就可用通过this关键字来访问全局变量吧?</p><br><p>答案是肯定的, 如果调用introduce函数, 你就会认识我是Laruence.</p><br><h3>事件处理函数</h3><br><p>也许, 对于this关键字的迷惑, 绝大部分原因是来自把函数(方法)用在事件处理的时候.</p><br><ol><br><li><span class="sh_keyword">&lt;input</span> <span class="sh_type">id</span><span class="sh_symbol">=</span><span class="sh_string">“name”</span> <span class="sh_type">type</span><span class="sh_symbol">=</span><span class="sh_string">“text”</span> <span class="sh_type">name</span><span class="sh_symbol">=</span><span class="sh_string">“name”</span> <span class="sh_type">value</span><span class="sh_symbol">=</span><span class="sh_string">“Laruence”</span> <span class="sh_keyword">/&gt;</span></li><br></ol><br><p>比如, 我们现在需要在点击”name”输入框的时候, 显示出name输入框的value. 那么, 可用写下如下代码:</p><br><ol><br><li><span class="sh_keyword">function</span> <span class="sh_function">showValue</span><span class="sh_symbol">()</span> <span class="sh_cbracket">{</span></li><br><li>     <span class="sh_function">alert</span><span class="sh_symbol">(</span><span class="sh_keyword">this</span><span class="sh_symbol">.</span>value<span class="sh_symbol">);</span></li><br><li><span class="sh_cbracket">}</span></li><br><li>document<span class="sh_symbol">.</span><span class="sh_function">getElementById</span><span class="sh_symbol">(</span><span class="sh_string">‘name’</span><span class="sh_symbol">).</span>onclick <span class="sh_symbol">=</span> showValue<span class="sh_symbol">;</span></li><br></ol><br><p>上面的代码, 运行正常, 但是why? 不是说函数的this指针永远指向函数所有者么? 不是说全局变量的所有者是window对象么?</p><br><p>呵呵, 如果你能想到这个问题, 那说明你在认真的看我的文章, 否则,,我建议你从头看起, 否则看完了,你还是迷糊~</p><br><p>恩, 对, 对于上面的代码, showValue是定义在了全局对象, 那么看来问题只能发生在onclick事件绑定的时候了.</p><br><p>我们知道, 在Js中一切都是对象, 函数和方法也都是对象的属性, 只不过函数有可执行的内部属性. 所以, 对于上面的代码, 在对onclick绑定处理器的时候, 其实是对id为name的输入框Dom对象的onclick属性赋值.</p><br><p>也就是说, 我们把函数showValue Copy 给了name输入框对象的onclick属性. 如果我们查看此时的onclick:</p><br><ol><br><li><span class="sh_keyword">function</span> <span class="sh_function">showValue</span><span class="sh_symbol">()</span> <span class="sh_cbracket">{</span></li><br><li>     <span class="sh_function">alert</span><span class="sh_symbol">(</span><span class="sh_keyword">this</span><span class="sh_symbol">.</span>value<span class="sh_symbol">);</span></li><br><li><span class="sh_cbracket">}</span></li><br><li>document<span class="sh_symbol">.</span><span class="sh_function">getElementById</span><span class="sh_symbol">(</span><span class="sh_string">‘name’</span><span class="sh_symbol">).</span>onclick <span class="sh_symbol">=</span> showValue<span class="sh_symbol">;</span></li><br><li><span class="sh_function">alert</span><span class="sh_symbol">(</span>document<span class="sh_symbol">.</span><span class="sh_function">getElementById</span><span class="sh_symbol">(</span><span class="sh_string">‘name’</span><span class="sh_symbol">).</span>onclick<span class="sh_symbol">);</span></li><br><li><span class="sh_comment">/</span></li><br><li><span class="sh_comment"><em> output</em></span></li><br><li><span class="sh_comment"> function showValue() {</span></li><br><li><span class="sh_comment"><em> alert(this.value);</em></span></li><br><li><span class="sh_comment"> }</span></li><br><li><span class="sh_comment"><em>/</em></span></li><br></ol><br><p>所以, 当事件触发的时候, 就会去调用name输入框的onclick方法, 这个时候,this关键字自然就指向的是name输入框了.</p><br><p>但是, 迷惑的事情就来了, 比如下面这种写法:</p><br><ol><br><li><span class="sh_keyword">function</span> <span class="sh_function">showValue</span><span class="sh_symbol">()</span> <span class="sh_cbracket">{</span></li><br><li>     <span class="sh_function">alert</span><span class="sh_symbol">(</span><span class="sh_keyword">this</span><span class="sh_symbol">.</span>value<span class="sh_symbol">);</span></li><br><li><span class="sh_cbracket">}</span></li><br><li><span class="sh_symbol">&lt;</span>input id<span class="sh_symbol">=</span><span class="sh_string">“name”</span> type<span class="sh_symbol">=</span><span class="sh_string">“text”</span> name<span class="sh_symbol">=</span><span class="sh_string">“name”</span> value<span class="sh_symbol">=</span><span class="sh_string">“Laruence”</span> onclick<span class="sh_symbol">=</span><span class="sh_string">“showValue()”</span><span class="sh_symbol">/&gt;</span></li><br></ol><br><p>就无法正常运行, 这又是为什么呢?</p><br><p>恩, 因为这个时候, 并不是赋值, 而是引用.</p><br><p>如果我们注意俩种onclick的写法, 你会发现, 对于之前的方法, 我们使用的是:</p><br><ol><br><li>dom<span class="sh_symbol">.</span>onclick <span class="sh_symbol">=</span> showvalue<span class="sh_symbol">;</span> <span class="sh_comment">//没有调用符</span></li><br></ol><br><p>而对于刚才的方法:</p><br><ol><br><li>onclick <span class="sh_symbol">=</span> <span class="sh_string">“showvalue()”</span> <span class="sh_comment">//有调用符</span></li><br></ol><br><p>这个也能侧面的反映出俩者的区别:对于前者,是赋值, 而对于后者是引用. 如果我们这个时候查看输入框的onclick属性,我们得到:</p><br><ol><br><li><span class="sh_function">alert</span><span class="sh_symbol">(</span>dom<span class="sh_symbol">.</span>onclick<span class="sh_symbol">);</span></li><br><li><span class="sh_comment">/**</span></li><br><li><span class="sh_comment"> output:</span></li><br><li><span class="sh_comment"><em> function onclick() {</em></span></li><br><li><span class="sh_comment"> showValue();</span></li><br><li><span class="sh_comment"><em> }</em></span></li><br><li><span class="sh_comment">/</span></li><br></ol><br><p>看到区别了么? 也就懂得为什么了吧?</p><br><p>讲到这里, 有一个很有趣的例子 ,大家可以在IE下试试:</p><br><ol><br><li><span class="sh_symbol">&lt;</span>img src<span class="sh_symbol">=</span><span class="sh_string">“xxx”</span> onerror<span class="sh_symbol">=</span><span class="sh_string">“alert(1);} function hi() { alert(2); “</span> <span class="sh_symbol">/&gt;</span></li><br></ol><br><h3>改变this的指向</h3><br><p>那, 既然我们已经知道为什么了, 那怎么才能让this指向我们想要指的地方呢?</p><br><p>对于上面的事件处理函数来说, 我们可以有如下几种写法:</p><br><ol><br><li>dom<span class="sh_symbol">.</span>onclick <span class="sh_symbol">=</span> <span class="sh_function">showValue</span><span class="sh_symbol">();</span></li><br><li>dom<span class="sh_symbol">.</span>onclick <span class="sh_symbol">=</span> <span class="sh_keyword">function</span><span class="sh_symbol">()</span> <span class="sh_cbracket">{</span> <span class="sh_function">alert</span><span class="sh_symbol">(</span><span class="sh_keyword">this</span><span class="sh_symbol">.</span>value<span class="sh_symbol">)</span> <span class="sh_symbol">;</span><span class="sh_cbracket">}</span></li><br><li><span class="sh_symbol">&lt;</span>input onclick<span class="sh_symbol">=</span><span class="sh_string">“alert(this.value);”</span> <span class="sh_regexp">/&gt; /</span><span class="sh_symbol">/</span>想想刚才我们的引用<span class="sh_symbol">,</span>是如何把这句嵌入的<span class="sh_symbol">.</span></li><br><li>dom<span class="sh_symbol">.</span><span class="sh_function">addEventListener</span><span class="sh_symbol">(</span>dom<span class="sh_symbol">,</span> showValue<span class="sh_symbol">,</span> <span class="sh_keyword">false</span><span class="sh_symbol">);</span> <span class="sh_comment">//ff only</span></li><br></ol><br><p>而对于不是事件处理函数的场合, 我们可以使用apply, 或者call, 来改变this关键字的指向.</p><br><p>比如:</p><br><ol><br><li><span class="sh_keyword">var</span> laruence <span class="sh_symbol">=</span> <span class="sh_cbracket">{</span></li><br><li>     name <span class="sh_symbol">:</span> <span class="sh_string">‘laruence’</span><span class="sh_symbol">,</span></li><br><li>     age <span class="sh_symbol">:</span> <span class="sh_number">26</span><span class="sh_symbol">,</span></li><br><li>     position <span class="sh_symbol">:</span> <span class="sh_string">‘Senior PHP Engineer’</span><span class="sh_symbol">,</span></li><br><li>     company <span class="sh_symbol">:</span> <span class="sh_string">‘Baidu.inc’</span></li><br><li><span class="sh_cbracket">}</span><span class="sh_symbol">;</span></li><br><li></li><br><li><span class="sh_keyword">function</span> <span class="sh_function">introduce</span><span class="sh_symbol">()</span> <span class="sh_cbracket">{</span></li><br><li>     <span class="sh_function">alert</span><span class="sh_symbol">(</span><span class="sh_keyword">this</span><span class="sh_symbol">.</span>name<span class="sh_symbol">);</span></li><br><li><span class="sh_cbracket">}</span></li><br><li></li><br><li>introduce<span class="sh_symbol">.</span><span class="sh_function">call</span><span class="sh_symbol">(</span>laruence<span class="sh_symbol">);</span></li><br></ol><br><p>&nbsp;</p><br><p>&nbsp;</p>





      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-94ver" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/20/94ver/" class="article-date">
  	<time datetime="2015-10-20T14:15:38.450Z" itemprop="datePublished">2015-10-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/20/94ver/">第一次收到极客标签的奖品~好高兴</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p></p><h2>感谢极客标签提供的奖品~现在来进行拆包;</h2><p></p>
<p><ul></ul></p>
<p><li></li></p>
<p></p><h1>先来喜闻乐见的拆包</h1><br><br><p></p>
<p><a class="uploadimggrp" href="http://www.gbtags.com/gb/networks/uploadimg/fb4537d4-d11c-4845-80ff-106d5aa7a7fe.JPG" target="_blank"><img src="http://www.gbtags.com/gb/networks/uploadimgthumb/fb4537d4-d11c-4845-80ff-106d5aa7a7fe.JPG" data-original="http://www.gbtags.com/gb/networks/uploadimgthumb/fb4537d4-d11c-4845-80ff-106d5aa7a7fe.JPG" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt=""></a></p><br><p>使用了SF快递~并且是腾讯总部发出的~好期待是什么物品</p><br><p>&nbsp;</p><br><ul><br><li><br><h1><strong>解包</strong></h1><br></li><br></ul><br><p><img src="http://www.gbtags.com/gb/networks/uploadimgthumb/6e9366b5-e1b9-4867-b8df-07dd606635c7.JPG" data-original="http://www.gbtags.com/gb/networks/uploadimgthumb/6e9366b5-e1b9-4867-b8df-07dd606635c7.JPG" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt="" width="500" height="281"></p><br><p><img src="http://www.gbtags.com/gb/networks/uploadimgthumb/3f3c8a6e-5b54-4a97-aab6-1e312548a0f1.JPG" data-original="http://www.gbtags.com/gb/networks/uploadimgthumb/3f3c8a6e-5b54-4a97-aab6-1e312548a0f1.JPG" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt="" width="500" height="281"></p><br><p>咦？竟然是大剑灵的盒子~估计里面应该也是跟剑灵相关的吧</p><br><ul><br><li><br><h1>背面</h1><br></li><br></ul><br><p><img src="http://www.gbtags.com/gb/networks/uploadimgthumb/ac3dbb0e-8558-45e4-9af6-563a86a90a3d.JPG" data-original="http://www.gbtags.com/gb/networks/uploadimgthumb/ac3dbb0e-8558-45e4-9af6-563a86a90a3d.JPG" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt="" width="500" height="281"></p><br><p>果然是剑灵游戏礼盒~不过包装还是高大上的</p><br><div></div><br><ul><br><li><br><h1>拆盒</h1><br></li><br></ul><br><p><img src="http://www.gbtags.com/gb/networks/uploadimgthumb/5386f1ad-da06-4e7d-84b7-06f90cd41e35.JPG" data-original="http://www.gbtags.com/gb/networks/uploadimgthumb/5386f1ad-da06-4e7d-84b7-06f90cd41e35.JPG" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt="" width="500" height="281"></p><br><p>哎？给我提供了一枚剑灵的一周年勋章~虽然不玩剑灵好多年了~</p><br><p>&nbsp;</p><br><ul><br><li><br><h1>礼包卡,U盘</h1><br></li><br></ul><br><p><img src="http://www.gbtags.com/gb/networks/uploadimgthumb/6db4efa6-da48-429e-8165-b20abfae8259.JPG" data-original="http://www.gbtags.com/gb/networks/uploadimgthumb/6db4efa6-da48-429e-8165-b20abfae8259.JPG" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt="" width="500" height="281"></p><br><p>一个礼包卡<br><br><img src="http://www.gbtags.com/gb/networks/uploadimgthumb/74139eae-fa51-4ead-8225-6af8bcc7abea.JPG" data-original="http://www.gbtags.com/gb/networks/uploadimgthumb/74139eae-fa51-4ead-8225-6af8bcc7abea.JPG" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt="" width="500" height="281"></p><br><p>以上就是礼包的全部内容~</p><br><p>顺带一提，剑灵的妹纸还是挺好看的</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><h2>.身为一名学习了前端没多久的孩纸,虽然只是一份小小的礼物。但当我收到礼物的那一刻,心里面还是受到了很大的冲击,我想这并不是一份小小的礼物，更是对我前端之路的支持与鼓励，也是一种自己对自己的认可，我相信我能以这份礼物为基石，不断的在前端之路上探索与追寻自己内心深处的梦想.</h2><br><p>&nbsp;</p><br><p>&nbsp;</p>





      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-110ver" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/20/110ver/" class="article-date">
  	<time datetime="2015-10-20T14:15:38.450Z" itemprop="datePublished">2015-10-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/20/110ver/">JavaScript另一种创建实例的方式:返回原型方法</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&nbsp;</p><br><p>最近在看jquery源码分析..初看了一下发现果然是大神级别的框架,尔等渣渣完全看不懂.</p><br><p>不过根据视频结合来看还是能够学到一点什么的.</p><br><p>至少学到了今天的主题”JavaScript另一种创建实例的方式:返回原型方法”</p><br><p>&nbsp;</p><br><blockquote><br><h2><span style="color: #333333;"><strong>代码</strong></span></h2><br><pre class="lang:default decode:true">function Map(){<br>        return new Map.prototype.init()<br>    }<br><br>    var soul=Map.prototype={<br>        constructor:Map,<br>        ver:”1.2.3”,<br>        valueMap:{}<br>    }<br>    Map.prototype.init=function(){<br><br>    }<br>      Map.prototype.hi=function(){alert(“hello”)}<br>     Map.prototype.init.prototype=Map.prototype;<br>//Map实例是Map.init<br>    //init的原型是Map.prototype<br>    //下面调用Map()方法都是在调用Map.init.prototype=Map.prototype 也就是Map.prototype<br>    //看成Map.prototype就行了.<br>Map().hi()//hello</pre><br></blockquote><br><p>&nbsp;</p><br><blockquote><br><h3><span style="color: #333333;"><strong>分析</strong></span></h3><br><p>首先构造一个函数为 Map返回一个new xxx() 一般我们构造实例都是 var xxx=new xxx() 而这里直接在函数内部就构造好了</p><br><p>返回的是一个构造函数</p><br><p>也就是 Map.prototype.init 如果返回是他构造的话 那么原来Map.prototype上的方法和属性不是都访问不到了嘛？于是巧妙地用了这样一句话</p><br><p>Map.prototype.init.prototype=Map.prototype;</p><br><p>可以理解为init构造函数继承了Map.prototype上的方法和属性</p><br><p>接下来的就应该不用再说了吧</p><br><p>&nbsp;</p></blockquote><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p>





      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-111ver" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/20/111ver/" class="article-date">
  	<time datetime="2015-10-20T14:15:38.450Z" itemprop="datePublished">2015-10-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/20/111ver/">javascript实现各种字符串搜索算法</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p></p><p>转自<a href="http://www.gbtags.com/gb/share/4430.htm" target="_blank" rel="external">http://www.gbtags.com/gb/share/4430.htm</a></p><p></p>
<p></p><p>我觉得在前端开发中过多地考虑算法没有太多实际的意义。但这仅仅是我觉得，我并没有证据证明这一点。那为何不来尝试一下，面对一个特定的任务，我将使用不同的算法来实现，看看究竟效率相差多少。今天我想通过字符串搜索这一场景来进行测试。</p><p></p>
<p></p><p>&nbsp;</p><p></p>
<p></p><h2>测试场景</h2><p></p>
<p><ol></ol></p>
<p><li>主字符串就以ABC的一篇文章内容为例，略做修改<br></li></p>
<blockquote><p>There are some times when clicking “like” on a friend’s Facebook status doesn’t feel appropriate. A bad day. A loved one lost. A break up. It only seems natural that a “dislike” button could solve the conundrum of wanting to empathize but not seem inappropriate by clicking “like.” Mark Zuckerberg Puts the Rest of Us to Shame by Speaking Fluent Chinese. Mark Zuckerberg: Facebook Founder and Animal Butcher. Mark Zuckerberg and That Shirt. The idea has been on Mark Zuckerberg’s radar for a while, he said. In 2010, he told ABC News’ Diane Sawyer that that Facebook would “definitely think about” adding a dislike button. “People definitely seem to want it,” Zuckerberg said. Four years later — Zuckerberg says Facebook is still “thinking about” adding the oft-requested button, Zuckerberg says Facebook is still “thinking about” adding the oft-requested button. At a town hall meeting on Thursday, the CEO revealed he has some reservations about the feature. “There are two things that it can mean,” Zuckerberg said of the potential button, which could be used in a mean spirited way or to express empathy. Finding how to limit it to the latter is the challenge. Zuckerberg said he doesn’t want the button to turn into a “voting mechanism” or something that isn’t “socially valuable.” “Often people will tell us they don’t feel comfortable pressing ‘like,’” Zuckerberg said. “What’s the right way to make it so people can easier express a wide range of emotions?” One suggestion percolating online: Roll out the feature under a different name. However, an “empathy button” just may not have the same ring to it as “dislike.”</p></blockquote><br><br><li>模式字符串<br><ul><br><li>靠近起点 friend</li><br><li>靠近终点 button”</li><br><li>靠近中间 Zuckerberg says Facebook is still “thinking about” adding the oft-requested button.</li><br></ul><br></li><br><br><h3>暴力算法</h3><br><p>首先是最原始的做法，主串左侧开始，逐个对比，如果不相同，则主串起始点向后移一位，重复，直到找到。</p><br><p>第一次尝试 G C A T C G C A G A G A G T A T A C A G T A C G 1 2 3 4   G C A G A G A G   第二次尝试 G C A T C G C A G A G A G T A T A C A G T A C G   1     G C A G A G A G   第三次尝试 G C A T C G C A G A G A G T A T A C A G T A C G   1     G C A G A G A G   第四次尝试 G C A T C G C A G A G A G T A T A C A G T A C G   1     G C A G A G A G   第五次尝试 G C A T C G C A G A G A G T A T A C A G T A C G   1     G C A G A G A G   Sixth attempt G C A T C G C A G A G A G T A T A C A G T A C G   1 2 3 4 5 6 7 8     G C A G A G A G</p><br><p>以上示例（<a href="http://www.zhouhua.info/jump/0dcj" target="_blank">http://igm.univ-mlv.fr/~lecroq/string/examples/exp3.html</a>）说明了一次暴力搜索的过程。</p><br><p>我用JS模拟了这个算法：</p><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="kwd">var</span><span class="pln"> mainString</span><span class="pun">=</span><span class="str">“”</span><span class="pun">;</span></li><br><li class="L1"><span class="kwd">var</span><span class="pln"> searchString</span><span class="pun">=</span><span class="str">“”</span></li><br><li class="L2"><span class="kwd">function</span><span class="pln"> basicSearch</span><span class="pun">(</span><span class="pln">mainStr</span><span class="pun">,</span><span class="pln"> str</span><span class="pun">,</span><span class="pln"> offset</span><span class="pun">){</span></li><br><li class="L3"><span class="kwd">var</span><span class="pln"> mainLength</span><span class="pun">=</span><span class="pln">mainStr</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></li><br><li class="L4"><span class="kwd">var</span><span class="pln"> searchLength</span><span class="pun">=</span><span class="pln">str</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></li><br><li class="L5"><span class="kwd">if</span><span class="pun">(</span><span class="pln">searchLength</span><span class="pun">&gt;</span><span class="pln">mainLength</span><span class="pun">-</span><span class="pln">offset</span><span class="pun">){</span></li><br><li class="L6"><span class="kwd">return</span> <span class="pun">-</span><span class="lit">1</span><span class="pun">;</span></li><br><li class="L7"><span class="pun">}</span></li><br><li class="L8"><span class="pln"> offset</span><span class="pun">=</span><span class="pln">offset</span><span class="pun">||</span><span class="lit">0</span><span class="pun">;</span></li><br><li class="L9"><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">searchlength</span><span class="pun">&gt;</span><span class="pln">i </span><span class="pun">;</span><span class="pln">i</span><span class="pun">++){</span></li><br><li class="L0"><span class="kwd">if</span><span class="pun">(</span><span class="pln">str</span><span class="pun">.</span><span class="pln">charAt</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)!==</span><span class="pln">mainString</span><span class="pun">.</span><span class="pln">charAt</span><span class="pun">(</span><span class="pln">offset</span><span class="pun">+</span><span class="pln">i</span><span class="pun">)){</span></li><br><li class="L1"><span class="kwd">return</span><span class="pln"> basicSearch</span><span class="pun">(</span><span class="pln">mainStr</span><span class="pun">,</span><span class="pln"> str</span><span class="pun">,</span><span class="pln"> offset</span><span class="pun">+</span><span class="lit">1</span><span class="pun">)</span></li><br><li class="L2"><span class="pun">}</span></li><br><li class="L3"><span class="pun">}</span></li><br><li class="L4"><span class="kwd">return</span><span class="pln"> offset</span><span class="pun">;</span></li><br><li class="L5"><span class="pun">}</span></li><br><li class="L6"><span class="pln">basicSearch</span><span class="pun">(</span><span class="pln">mainString</span><span class="pun">,</span><span class="pln"> searchString</span><span class="pun">);</span></li><br></ol><br></div><br><div class="jspVerticalBar"></div><br></div><br><p>非递归版：</p><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="kwd">function</span><span class="pln"> basicSearchLoop</span><span class="pun">(</span><span class="pln">mainStr</span><span class="pun">,</span><span class="pln"> str</span><span class="pun">){</span></li><br><li class="L1"><span class="kwd">var</span><span class="pln"> mainLength</span><span class="pun">=</span><span class="pln">mainStr</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></li><br><li class="L2"><span class="kwd">var</span><span class="pln"> searchLength</span><span class="pun">=</span><span class="pln">str</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></li><br><li class="L3"><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> offset</span><span class="pun">=</span> <span class="lit">0</span><span class="pun">,</span><span class="pln">padding</span><span class="pun">=</span><span class="pln">mainLength</span><span class="pun">-</span><span class="pln">searchLength</span><span class="pun">;</span><span class="pln">offset</span><span class="pun">&lt;</span> <span class="pun">=</span><span class="pln">padding</span><span class="pun">;</span><span class="pln">offset</span><span class="pun">++)</span> <span class="pun">{</span></li><br><li class="L4"><span class="kwd">var</span><span class="pln"> match</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">;</span></li><br><li class="L5"><span class="kwd">for</span> <span class="pun">(</span><span class="kwd">var</span><span class="pln"> i </span><span class="pun">=</span> <span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> searchLength</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span> <span class="pun">{</span></li><br><li class="L6"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">str</span><span class="pun">.</span><span class="pln">charAt</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)</span> <span class="pun">!==</span><span class="pln"> mainString</span><span class="pun">.</span><span class="pln">charAt</span><span class="pun">(</span><span class="pln">offset </span><span class="pun">+</span><span class="pln"> i</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L7"><span class="pln"> match</span><span class="pun">=</span><span class="kwd">false</span><span class="pun">;</span></li><br><li class="L8"><span class="kwd">break</span><span class="pun">;</span></li><br><li class="L9"><span class="pun">}</span></li><br><li class="L0"><span class="pun">}</span></li><br><li class="L1"><span class="kwd">if</span><span class="pun">(</span><span class="pln">match</span><span class="pun">)</span><span class="kwd">return</span><span class="pln"> offset</span><span class="pun">;</span></li><br><li class="L2"><span class="pun">}</span></li><br><li class="L3"><span class="kwd">return</span> <span class="pun">-</span><span class="lit">1</span><span class="pun">;</span></li><br><li class="L4"><span class="pun">}</span></li><br></ol><br></div><br><div class="jspVerticalBar"></div><br></div><br><p>&nbsp;</p><br><h2>KMP算法（Knuth-Morris-Pratt算法）</h2><br><p>KMP算是字符串搜索算法里的明星。不过本文重点不是介绍算法历史，有兴趣的可以移步百度百科（<a href="http://www.zhouhua.info/jump/yqnx" target="_blank">KMP算法</a>）。这里一样先看一个例子：</p><br><p>第一次尝试 G C A T C G C A G A G A G T A T A C A G T A C G 1 2 3 4   G C A G A G A G</p><br><p>移动步数: 4 (<em>i</em>-<em>kmpNext</em>[<em>i</em>]=3- -1)</p><br><p>第二次尝试 G C A T C G C A G A G A G T A T A C A G T A C G   1     G C A G A G A G</p><br><p>移动步数: 1 (<em>i</em>-<em>kmpNext</em>[<em>i</em>]=0- -1)</p><br><p>第三次尝试 G C A T C G C A G A G A G T A T A C A G T A C G   1 2 3 4 5 6 7 8     G C A G A G A G</p><br><p>移动步数: 7 (<em>i</em>-<em>kmpNext</em>[<em>i</em>]=8-1)</p><br><p>如果每次发生不一致都要计算一次效率太低，可以考虑将计算结果缓存到一张<strong>部分匹配表</strong>中（也可以在搜索之前先生成此表）。以intristed为例：移动步数: 1 (<em>i</em>-<em>kmpNext</em>[<em>i</em>]=0- -1)</p><br><p><a href="http://www.zhouhua.info/jump/b5bz" target="_blank">原始示例出处</a>。我们看到，这里有一个 kmpNext 数组，这是什么呢？我们慢慢来理解。每一次尝试匹配时，从模式字符串的左端开始对比，如果第i个字符相同，则比较第i+1个；如果不相同，则需要把模式字符串向右移动。移动的位数是算法优劣的关键。每次移动一位是暴力算法的做法。kmp算法有自己独特的移动步数计算方法。</p><br><p>首先引入两个概念：<strong>前缀</strong>和<strong>后缀</strong>。</p><br><ul><br><li>前缀：一个字符串所有头部的集合，不包含自身；</li><br><li>后缀：一个字符串所有尾部的集合，不包含自身。</li><br></ul><br><p>我们看下面的例子（编号从1开始编）：</p><br><p>i n t r i s t i n g 1 2 3 4 5 6 7 8 9   i n t r i s t e d</p><br><p>在模式串8的位置发生了不匹配，那么要计算模式串右移的位数之前，我们先写出位置1~7处的子串intrist的前缀和后缀：</p><br><ul><br><li>前缀：i, in, int, intr, intri, intris, intrist</li><br><li>后缀：t, st, ist, rist, trist, ntrist, intrist</li><br></ul><br><p>我们再定义一个<strong>部分匹配值</strong>的概念：前缀和后缀交集中，长度最长的元素的长度。很显然，这里前缀和后缀没有交集，最长共同元素的长度也就认为是0，那么模式串向右移动（8-0=）8个字符。跟上面的算法（上面是7-(-1)）稍有不同，不过大体意思一样，计算结果也一样。</p><br><p>部分匹配表 模式字符串 i n t r i s t e d 序号 1 2 3 4 5 6 7 8 9 部分匹配值 0 0 0 0 1 0 0 0 0</p><br><p>计算右移位数就可以很容易地从表中计算出来：</p><br><blockquote><p>移动位数=已匹配的位数-已匹配部分的部分匹配值</p></blockquote><br><p>例如在第6个位置s处发现不匹配，那么需要右移5-1=4位。</p><br><p>但这样计算其实并不方便，比如已匹配位数为0的情况很难处理，所以我们可以对部分匹配值做一个修正，每个值减去1，公式也相应调整为：</p><br><blockquote><p>移动位数=不匹配字符的位置-已匹配部分的修正部分匹配值</p></blockquote><br><p>这样这个公式就与上面示例中的公式相同了。</p><br><p>我用JS模拟了这个算法：</p><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="kwd">function</span> <span class="typ">KMPSearch</span><span class="pun">(</span><span class="pln">mainLength</span><span class="pun">,</span><span class="pln">str</span><span class="pun">,</span><span class="pln">offset</span><span class="pun">,</span><span class="kwd">group</span><span class="pun">){</span></li><br><li class="L1"><span class="kwd">var</span><span class="pln"> mainLength</span><span class="pun">=</span><span class="pln">mainString</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></li><br><li class="L2"><span class="kwd">var</span><span class="pln"> searchLength</span><span class="pun">=</span><span class="pln">str</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></li><br><li class="L3"><span class="kwd">if</span><span class="pun">(</span><span class="pln">searchLength</span><span class="pun">&gt;</span><span class="pln">mainLength</span><span class="pun">-</span><span class="pln">offset</span><span class="pun">){</span></li><br><li class="L4"><span class="kwd">return</span> <span class="pun">-</span><span class="lit">1</span><span class="pun">;</span></li><br><li class="L5"><span class="pun">}</span></li><br><li class="L6"><span class="pln"> offset</span><span class="pun">=</span><span class="pln">offset</span><span class="pun">||</span><span class="lit">0</span><span class="pun">;</span></li><br><li class="L7"><span class="kwd">group</span><span class="pun">=</span><span class="kwd">group</span><span class="pun">||[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">1</span><span class="pun">];</span></li><br><li class="L8"><span class="kwd">var</span><span class="pln"> searchedString</span><span class="pun">=[];</span></li><br><li class="L9"><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">searchlength</span><span class="pun">&gt;</span><span class="pln">i </span><span class="pun">;</span><span class="pln">i</span><span class="pun">++){</span></li><br><li class="L0"><span class="kwd">var</span><span class="pln"> searchingChar</span><span class="pun">=</span><span class="pln">str</span><span class="pun">.</span><span class="pln">charAt</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span></li><br><li class="L1"><span class="kwd">if</span><span class="pun">(</span><span class="pln">searchingChar</span><span class="pun">!==</span><span class="pln">mainString</span><span class="pun">.</span><span class="pln">charAt</span><span class="pun">(</span><span class="pln">offset</span><span class="pun">+</span><span class="pln">i</span><span class="pun">)){</span></li><br><li class="L2"><span class="kwd">var</span><span class="pln"> offsetJump</span><span class="pun">;</span></li><br><li class="L3"><span class="kwd">if</span><span class="pun">(</span><span class="kwd">group</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span> <span class="pun">{</span></li><br><li class="L4"><span class="pln"> offsetJump </span><span class="pun">=</span> <span class="kwd">group</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span></li><br><li class="L5"><span class="pun">}</span><span class="kwd">else</span><span class="pun">{</span></li><br><li class="L6"><span class="pln"> offsetJump </span><span class="pun">=</span> <span class="kwd">next</span><span class="pun">(</span><span class="pln">searchedString</span><span class="pun">);</span></li><br><li class="L7"><span class="kwd">group</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]=</span><span class="pln">offsetJump</span><span class="pun">;</span></li><br><li class="L8"><span class="pun">}</span></li><br><li class="L9"><span class="kwd">return</span> <span class="typ">KPMSearch</span><span class="pun">(</span><span class="pln">mainLength</span><span class="pun">,</span><span class="pln">str</span><span class="pun">,</span><span class="pln">offset</span><span class="pun">+</span><span class="pln">offsetJump</span><span class="pun">,</span><span class="kwd">group</span><span class="pun">);</span></li><br><li class="L0"><span class="pun">}</span></li><br><li class="L1"><span class="pln"> searchedString</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">searchingChar</span><span class="pun">);</span></li><br><li class="L2"><span class="pun">}</span></li><br><li class="L3"><span class="kwd">return</span><span class="pln"> offset</span><span class="pun">;</span></li><br><li class="L4"><span class="pun">}</span></li><br><li class="L5"><span class="kwd">function</span> <span class="kwd">next</span><span class="pun">(</span><span class="pln">chars</span><span class="pun">){</span></li><br><li class="L6"><span class="kwd">var</span><span class="pln"> length</span><span class="pun">=</span><span class="pln">chars</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></li><br><li class="L7"><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i</span><span class="pun">=</span><span class="pln">length</span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&gt;</span><span class="lit">0</span><span class="pun">;</span><span class="pln">i</span><span class="pun">–){</span></li><br><li class="L8"><span class="kwd">var</span><span class="pln"> isMatch</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">;</span></li><br><li class="L9"><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> j</span><span class="pun">=</span><span class="lit">0</span> <span class="pun">;</span><span class="pln">j</span><span class="pun">&lt;</span> <span class="pun">=</span><span class="pln">i</span><span class="pun">;</span><span class="pln">j</span><span class="pun">++){</span></li><br><li class="L0"><span class="kwd">if</span><span class="pun">(</span><span class="pln">chars</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]!==</span><span class="pln">chars</span><span class="pun">[</span><span class="pln">length</span><span class="pun">-</span><span class="pln">i</span><span class="pun">+</span><span class="pln">j</span><span class="pun">]){</span></li><br><li class="L1"><span class="pln"> isMatch</span><span class="pun">=</span><span class="kwd">false</span><span class="pun">;</span></li><br><li class="L2"><span class="kwd">break</span><span class="pun">;</span></li><br><li class="L3"><span class="pun">}</span></li><br><li class="L4"><span class="pun">}</span></li><br><li class="L5"><span class="kwd">if</span><span class="pun">(</span><span class="pln">isMatch</span><span class="pun">)</span><span class="kwd">return</span><span class="pln"> length</span><span class="pun">-</span><span class="pln">i</span><span class="pun">;</span></li><br><li class="L6"><span class="pun">}</span></li><br><li class="L7"><span class="kwd">return</span><span class="pln"> length</span><span class="pun">;</span></li><br><li class="L8"><span class="pun">}</span></li><br></ol><br></div><br><div class="jspVerticalBar"></div><br></div><br><p>非递归版：</p><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="kwd">function</span> <span class="typ">KMPSearchLoop</span><span class="pun">(</span><span class="pln">mainStr</span><span class="pun">,</span><span class="pln"> str</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L1"><span class="kwd">var</span><span class="pln"> mainLength</span><span class="pun">=</span><span class="pln">mainString</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></li><br><li class="L2"><span class="kwd">var</span><span class="pln"> searchLength </span><span class="pun">=</span><span class="pln"> str</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></li><br><li class="L3"><span class="kwd">for</span> <span class="pun">(</span><span class="kwd">var</span><span class="pln"> offset </span><span class="pun">=</span> <span class="lit">0</span><span class="pun">,</span><span class="pln"> padding </span><span class="pun">=</span><span class="pln"> mainLength </span><span class="pun">-</span><span class="pln"> searchLength</span><span class="pun">,</span> <span class="kwd">group</span> <span class="pun">=</span> <span class="pun">[</span><span class="lit">1</span><span class="pun">,</span> <span class="lit">1</span><span class="pun">];</span><span class="pln"> offset </span><span class="pun">&lt;</span> <span class="pun">=</span><span class="pln"> padding</span><span class="pun">;){</span></li><br><li class="L4"><span class="kwd">var</span><span class="pln"> searchedString </span><span class="pun">=</span> <span class="pun">[];</span></li><br><li class="L5"><span class="kwd">var</span><span class="pln"> match</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">;</span></li><br><li class="L6"><span class="kwd">var</span><span class="pln"> offsetJump</span><span class="pun">;</span></li><br><li class="L7"><span class="kwd">for</span> <span class="pun">(</span><span class="kwd">var</span><span class="pln"> i </span><span class="pun">=</span> <span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> searchLength</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span> <span class="pun">{</span></li><br><li class="L8"><span class="kwd">var</span><span class="pln"> searchingChar </span><span class="pun">=</span><span class="pln"> str</span><span class="pun">.</span><span class="pln">charAt</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span></li><br><li class="L9"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">searchingChar </span><span class="pun">!==</span><span class="pln"> mainString</span><span class="pun">.</span><span class="pln">charAt</span><span class="pun">(</span><span class="pln">offset </span><span class="pun">+</span><span class="pln"> i</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L0"><span class="pln"> match</span><span class="pun">=</span><span class="kwd">false</span><span class="pun">;</span></li><br><li class="L1"><span class="kwd">if</span> <span class="pun">(</span><span class="kwd">group</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span> <span class="pun">{</span></li><br><li class="L2"><span class="pln"> offsetJump </span><span class="pun">=</span> <span class="kwd">group</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span></li><br><li class="L3"><span class="pun">}</span></li><br><li class="L4"><span class="kwd">else</span> <span class="pun">{</span></li><br><li class="L5"><span class="pln"> offsetJump </span><span class="pun">=</span> <span class="kwd">next</span><span class="pun">(</span><span class="pln">searchedString</span><span class="pun">);</span></li><br><li class="L6"><span class="kwd">group</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span> <span class="pun">=</span><span class="pln"> offsetJump</span><span class="pun">;</span></li><br><li class="L7"><span class="pun">}</span></li><br><li class="L8"><span class="kwd">break</span><span class="pun">;</span></li><br><li class="L9"><span class="pun">}</span></li><br><li class="L0"><span class="pln"> searchedString</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">searchingChar</span><span class="pun">);</span></li><br><li class="L1"><span class="pun">}</span></li><br><li class="L2"><span class="kwd">if</span><span class="pun">(</span><span class="pln">match</span><span class="pun">){</span></li><br><li class="L3"><span class="kwd">return</span><span class="pln"> offset</span><span class="pun">;</span></li><br><li class="L4"><span class="pun">}</span><span class="kwd">else</span><span class="pun">{</span></li><br><li class="L5"><span class="pln"> offset</span><span class="pun">+=</span><span class="pln">offsetJump</span><span class="pun">;</span></li><br><li class="L6"><span class="pun">}</span></li><br><li class="L7"><span class="pun">}</span></li><br><li class="L8"><span class="kwd">return</span> <span class="pun">-</span><span class="lit">1</span><span class="pun">;</span></li><br><li class="L9"><span class="pun">}</span></li><br></ol><br></div><br><div class="jspVerticalBar"></div><br></div><br><p>&nbsp;</p><br><h2>Horspool算法</h2><br><p>Horspool算法在做匹配的时候，创造性地从右向左匹配，对后来其他算法有很深的影响。还是那句话，本文会讲很多算法上的东西，但本文重点不是算法，下面还是会过一下Horspool算法的搜索过程，如果难以理解，还是参考其他更详细的资料。依然是示例（<a href="http://www.zhouhua.info/jump/eqpj" target="_blank">http://igm.univ-mlv.fr/~lecroq/string/examples/exp18.html</a>）：</p><br><p>第一次尝试 G C A T C G C A G A G A G T A T A C A G T A C G   1   G C A G A G A G</p><br><p>移动步数: 1 (Horspool[A])</p><br><p>第二次尝试 G C A T C G C A G A G A G T A T A C A G T A C G             3 2 1     G C A G A G A G</p><br><p>移动步数: 2 (Horspool[G])</p><br><p>第三次尝试 G C A T C G C A G A G A G T A T A C A G T A C G         5 4 3 2 1     G C A G A G A G</p><br><p>移动步数: 2 (Horspool[G])</p><br><p>第四次尝试 G C A T C G C A G A G A G T A T A C A G T A C G   8 7 6 5 4 3 2 1     G C A G A G A G</p><br><p>先对齐，从模式串的右侧开始匹配，如果完全匹配则结束搜索，否则查看模式串最右边对应的主串字符是什么。找出这个字符在模式串中最后出现的位置（除最末位）距离模式串最后一个字符的距离，如果没有在模式串中出现过，则认为这个距离是模式串的长度。我们可以事先把这个距离表计算出来。</p><br><p>7 6 5 4 3 2 1   G C A G A G A G</p><br><p>⇒</p><br><p>字符 G C A *（其他） 距离 2 6 1 8（模式串的长度）</p><br><p>以上面第三次尝试为例，从右向左匹配了5次后发现匹配失败了，那么这时就看序号1处主串的字符是什么。很容易得到是‘G’，查询上表，‘G’对应的距离是2，那就很简单粗暴地把模式串向右移动两位，再次进行匹配。</p><br><p>上代码：</p><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="kwd">function</span> <span class="typ">HorspoolSearchLoop</span><span class="pun">(</span><span class="pln">mainString</span><span class="pun">,</span><span class="pln"> str</span><span class="pun">){</span></li><br><li class="L1"><span class="kwd">var</span><span class="pln"> mainLength</span><span class="pun">=</span><span class="pln">mainString</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></li><br><li class="L2"><span class="kwd">var</span><span class="pln"> searchLength </span><span class="pun">=</span><span class="pln"> str</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></li><br><li class="L3"><span class="kwd">var</span><span class="pln"> table</span><span class="pun">={};</span></li><br><li class="L4"><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> index</span><span class="pun">=</span> <span class="lit">0</span><span class="pun">,</span><span class="pln">l</span><span class="pun">=</span><span class="pln">searchLength</span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">l</span><span class="pun">&gt;</span><span class="pln">index </span><span class="pun">;</span><span class="pln">index</span><span class="pun">++){</span></li><br><li class="L5"><span class="pln"> table</span><span class="pun">[</span><span class="pln">str</span><span class="pun">.</span><span class="pln">charAt</span><span class="pun">(</span><span class="pln">index</span><span class="pun">)]=</span><span class="pln">l</span><span class="pun">-</span><span class="pln">index</span><span class="pun">;</span></li><br><li class="L6"><span class="pun">}</span></li><br><li class="L7"><span class="kwd">for</span> <span class="pun">(</span><span class="kwd">var</span><span class="pln"> offset </span><span class="pun">=</span> <span class="lit">0</span><span class="pun">,</span><span class="pln"> padding </span><span class="pun">=</span><span class="pln"> mainLength </span><span class="pun">-</span><span class="pln"> searchLength</span><span class="pun">;</span><span class="pln"> offset </span><span class="pun">&lt;</span> <span class="pun">=</span><span class="pln"> padding</span><span class="pun">;){</span></li><br><li class="L8"><span class="kwd">var</span><span class="pln"> rightChar</span><span class="pun">;</span></li><br><li class="L9"><span class="kwd">var</span><span class="pln"> match</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">;</span></li><br><li class="L0"><span class="kwd">var</span><span class="pln"> offsetJump</span><span class="pun">;</span></li><br><li class="L1"><span class="kwd">for</span> <span class="pun">(</span><span class="kwd">var</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> searchLength</span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;=</span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">–)</span> <span class="pun">{</span></li><br><li class="L2"><span class="kwd">var</span><span class="pln"> searchingChar </span><span class="pun">=</span><span class="pln"> str</span><span class="pun">.</span><span class="pln">charAt</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span></li><br><li class="L3"><span class="kwd">if</span><span class="pun">(</span><span class="pln">i</span><span class="pun">===</span><span class="pln">searchLength</span><span class="pun">-</span><span class="lit">1</span><span class="pun">){</span></li><br><li class="L4"><span class="pln"> rightChar</span><span class="pun">=</span><span class="pln">mainString</span><span class="pun">.</span><span class="pln">charAt</span><span class="pun">(</span><span class="pln">offset</span><span class="pun">+</span><span class="pln">i</span><span class="pun">);</span></li><br><li class="L5"><span class="pun">}</span></li><br><li class="L6"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">searchingChar </span><span class="pun">!==</span><span class="pln"> mainString</span><span class="pun">.</span><span class="pln">charAt</span><span class="pun">(</span><span class="pln">offset </span><span class="pun">+</span><span class="pln"> i</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L7"><span class="pln"> match</span><span class="pun">=</span><span class="kwd">false</span><span class="pun">;</span></li><br><li class="L8"><span class="pln"> offsetJump </span><span class="pun">=</span><span class="pln"> table</span><span class="pun">[</span><span class="pln">rightChar</span><span class="pun">]||</span><span class="pln">searchLength</span><span class="pun">;</span></li><br><li class="L9"><span class="kwd">break</span><span class="pun">;</span></li><br><li class="L0"><span class="pun">}</span></li><br><li class="L1"><span class="pun">}</span></li><br><li class="L2"><span class="kwd">if</span><span class="pun">(</span><span class="pln">match</span><span class="pun">){</span></li><br><li class="L3"><span class="kwd">return</span><span class="pln"> offset</span><span class="pun">;</span></li><br><li class="L4"><span class="pun">}</span><span class="kwd">else</span><span class="pun">{</span></li><br><li class="L5"><span class="pln"> offset</span><span class="pun">+=</span><span class="pln">offsetJump</span><span class="pun">;</span></li><br><li class="L6"><span class="pun">}</span></li><br><li class="L7"><span class="pun">}</span></li><br><li class="L8"><span class="kwd">return</span> <span class="pun">-</span><span class="lit">1</span><span class="pun">;</span></li><br><li class="L9"><span class="pun">}</span></li><br></ol><br></div><br></div><br><p>这次只写了非递归的版本，因为递归的版本已经没有写的必要。</p><br><h2>还是来谈javascript</h2><br><p>冲着javascript性能来看这篇文章的同学一定没有兴趣看上来的算法。我一边写一边测试，终于也不愿意再深究其他的一些算法，原本还想把Boyer-Moore算法、Sunday算法也一起讨论讨论，现在看来完全没有必要。为什么？因为javascript实现这些算法的效率实在太！慢！了！</p><br><p>回到开头我们设置的测试场景，我们分别来试验一下搜索10000次，各种算法所要耗费的时间。</p><br><p>递归版（10000次·ms） 循环版（10000次·ms） 暴力算法 87, 1862, 990 35, 1349, 661 KMP算法 106, 3405, 1770 76, 2337, 1194 Horspool算法 187, 2479, 1446 javascript原生方法 9, 101, 47</p><br><p>我想从数据上看，结论是很清晰的。javascript代码的性能确实不高，相比较于循环，递归更是慢了近1倍。javascript在分配内存，数组访问，函数调用等等方面的性能与编译型语言差距很大。如果要实现一个特定的任务，我们更多地应该考虑尽可能地使用原生代码来实现，高级的算法在javascript里似乎并没有多少实用价值。</p><br><p><iframe width="300" height="150" src="http://www.gbtags.com/gb/debugwidget/7d7627df-4296-42eb-b8c5-5da7cffd0b1b.htm"></iframe></p><br><blockquote><p>移过来好多样式丢了……</p></blockquote><br><blockquote><p>blog：<a href="http://www.zhouhua.info/2014/12/16/string/" target="_blank">http://www.zhouhua.info/2014/12/16/string/</a></p></blockquote>





      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-112ver" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/20/112ver/" class="article-date">
  	<time datetime="2015-10-20T14:15:38.450Z" itemprop="datePublished">2015-10-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/20/112ver/">教你如何从bilibili下载视频并且提取视频BGM</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&nbsp;</p><br><blockquote><br><h1><span style="color: #993366;"><strong>下载bilibili视频</strong></span></h1><br><p>&nbsp;</p><br><p>The First 在bilibili找到你想要下载的视频 比如: <a href="http://www.bilibili.com/video/av2299170/" target="_blank" rel="external">http://www.bilibili.com/video/av2299170/</a></p><br><p>然后再bilibili后面加上jj 最后拼起来就是<a href="http://www.bilibilijj.com/video/av2299170/" target="_blank" rel="external">http://www.bilibilijj.com/video/av2299170/</a></p><br><p><a href="/mm/imgs/2015-10-20-05.png"><img class=" size-medium wp-image-460 alignnone" src="/mm/imgs/2015-10-20-05.png" data-original="http://www.old.com/wp-content/uploads/2015/05/1-300x66.png" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt="1" width="300" height="66"></a></p><br><p>&nbsp;</p><br><p>点击MP4进行下载</p><br><p>&nbsp;</p><br><h1><span style="color: #993366;"><strong><span style="color: #993366;">录制保存</span></strong></span></h1><br><p>有时候某些视频并不能下载 所以这里用到了Bandicam这款视频软件进行录制后保存</p><br><p>关于Bandicam下载可以去Bandicam吧进行下载</p><br><p><a href="/mm/imgs/2015-10-20-05.png"><img class=" size-medium wp-image-461 alignnone" src="/mm/imgs/2015-10-20-05.png" data-original="http://www.old.com/wp-content/uploads/2015/05/2-280x300.png" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt="2" width="280" height="300"></a> 这里只稍微说一下.一般录制出来的视频比较大.如果有需要后期开一章如何压制视频的文章吧</p><br><p>&nbsp;</p></blockquote><br><p>&nbsp;</p><br><blockquote><br><h1><span style="color: #993366;"><strong>截取视频音乐</strong></span></h1><br><p>截取视频音乐有很多种方式.如果你愿意一边看视频一边截取可以采用potplay播放器的录制功能</p><br><h4><span style="color: #333333;">使用potplay </span></h4><br><p>下载地址:<a href="http://potplayer.daum.net/?lang=zh_CN" target="_blank" rel="external">http://potplayer.daum.net/?lang=zh_CN</a></p><br><p><a href="/mm/imgs/2015-10-20-05.png"><img class=" size-medium wp-image-462 alignnone" src="/mm/imgs/2015-10-20-05.png" data-original="http://www.old.com/wp-content/uploads/2015/05/3-300x185.png" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt="3" width="300" height="185"></a></p><br><p>&nbsp;</p><br><p>打开个视频文件 按TAB键既可以看到视频的一些相关信息</p><br><p><a href="/mm/imgs/2015-10-20-05.png"><img class=" size-medium wp-image-463 alignnone" src="/mm/imgs/2015-10-20-05.png" data-original="http://www.old.com/wp-content/uploads/2015/05/4-300x219.png" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt="4" width="300" height="219"></a></p><br><p>然后开始录制 右键选择 声音-音轨-录制</p><br><p><a href="/mm/imgs/2015-10-20-05.png"><img class=" size-medium wp-image-464 alignnone" src="/mm/imgs/2015-10-20-05.png" data-original="http://www.old.com/wp-content/uploads/2015/05/5-300x276.png" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt="5" width="300" height="276"></a></p><br><p>&nbsp;</p><br><p>这里可以选择很多种格式录制音频.. 到此使用potplay录制音频就结束了</p><br><p>&nbsp;</p><br><h1><span style="color: #333333;"><strong>使用视频制作软件截取音频</strong></span></h1><br><p>..这个我就不多说了..</p><br><p>另外网上还有一大堆如何截取视频音频的教程..大家可以多去了解一下</p><br><p>&nbsp;</p><br><p>&nbsp;</p></blockquote><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p>





      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-109ver" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/20/109ver/" class="article-date">
  	<time datetime="2015-10-20T14:15:38.450Z" itemprop="datePublished">2015-10-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/20/109ver/">写个CSS3缓动页面切换效果</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&nbsp;</p><br><blockquote><p>demo:<a href="http://www.old.com/demo/CSS%E7%BC%93%E5%8A%A8/" target="_blank" rel="external">点击演示</a></p><br><p>代码下载: <a href="http://pan.baidu.com/s/1pJoQhCn" target="_blank" rel="external">http://pan.baidu.com/s/1pJoQhCn</a></p></blockquote><br><p>&nbsp;</p><br><blockquote><br><h3><span style="color: #333333;"><strong>分析</strong></span></h3><br><p>因为是用纯CSS3写的.并且代码量比较多这里只简单分析一下原理</p><br><p>首先导航用的是input的check属性来实现的.. 另外用到了CSS选择器”+”与”~”</p><br><p>动画效果利用的是transition和transiform</p><br><p>通过点击导航来更改.content的Y定位实现切换</p><br><p>标题和菜单动画则通过自定义动画来实现</p></blockquote><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p>





      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-65ver" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/20/65ver/" class="article-date">
  	<time datetime="2015-10-20T14:15:38.449Z" itemprop="datePublished">2015-10-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/20/65ver/">页面制作之CSS背景</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><code class="brush:css;toolbar:false">CSS之背景</code></p><br><p>一：background-color //背景颜色<br><br>-&lt;color&gt;<br><br>-background-color:rgba(255,255,255,0.5)<br><br>-background-color:transparent//全透明</p><br><p>二:background-image 背景图片<br><br>-&lt;bg-image&gt;[,&lt;bg-image&gt;]<em><br><br>-background-image:url(red.png),url(blue.png)//可以写多个背景,先写的在上一层<br><br>-background-color:green;//颜色始终在最后一层</em></p><br><p>三:background-repeat 图片平铺<br><br>-&lt;repeat-style&gt;=repeat-x|repeat-y|[repeat|space|round|no-repeat]{1,2}<br><br>-background-image:url(red.png),url(blue.png)<br><br>-background-repeat:repeat-x|space<br><br>-background-repeat:no-repeat repeat,repeat-x<br><br>X轴 Y轴 blueX轴</p><br><p>四:background-attachment 图片滚动<br><br>-background-image:url(red.png)<br><br>-background-attachment:local//内容跟随背景滚动</p><br><p>五:background-position 图片定位<br><br>-background-position: 10px 20px<br><br>X轴 Y轴<br><br>-background-position:50% 50% //居中<br><br>-background-position:center center //居中<br><br>-background-position:right//X轴右边 只有一个值默认为center<br><br>-background-positon:right 10px top 20px<br><br>右边距离10px 上边距离20px<br><br>-background-position:0 -100px//利用-值来偏移</p><br><p>六:linear-gradient 线性渐变<br><br>-background-image:linear-gradient(red,blue)//从上至下 red渐变为blue<br><br>-background-image:linear-gradient(to right bottom red,blue)//从左上角至右下角 红色变蓝色<br><br>-background-image:linear-gradient(45deg,red,green 20%,blue)//green在20%位置</p><br><p>七:radial-gradient 径向渐变<br><br>-background-image:radial-gradient(circle,red,blue);<br><br>-background-image:radial-gradient(100px 50px at 0 0,red,blue);<br><br>X Y 圆心定位<br><br>八:repeat--gradient 重复渐变<br><br>-background-image:repeating-linear-gradient(red,blue 20px red 40px);//重复渐变</p><br><p>九:background-origin 图片位置<br><br>-&lt;box&gt;[,&lt;box&gt;]<br><br>-background-image:url(red.png)<br><br>-background-origin:content-box|border-box..</p><br><p>十:background-clip 图片裁剪<br><br>-background-clip:paddding-box|content-box..//图片裁剪<br><br>-background-origin:content-box|….</p><br><p>十一:background-size<br><br>-background-size:20px 20px //固定大小<br><br>宽为 容器20px 高为容器20px<br><br>-background-size:cover//撑满整个容器<br><br>-background-size:contain//图片以最大的形状显示在容器,但是不超过容器</p><br><p>十二:background 缩写<br><br>-[&lt;bg-layer&gt;,]*&lt;final-bg-layer&gt;给背景加颜色必须是最后一个层<br><br>-background:url(red.png) 0 0/20px 20px no-repeat, url(blue.png) 50% 50%/contain no-repeat content-box green;<br><br>既是clip content-box 也是orgin content-box<br><br>​</p>





      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/14/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="page-number" href="/page/14/">14</a><span class="page-number current">15</span><a class="page-number" href="/page/16/">16</a><a class="page-number" href="/page/17/">17</a><span class="space">&hellip;</span><a class="page-number" href="/page/25/">25</a><a class="extend next" rel="next" href="/page/16/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2015 Soul
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>