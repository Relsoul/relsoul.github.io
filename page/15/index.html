<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Soul的随笔</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Soul的随笔">
<meta property="og:url" content="http://emufan.com/page/15/index.html">
<meta property="og:site_name" content="Soul的随笔">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Soul的随笔">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="Soul的随笔" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?aa495dca780db3bca4942d20b6eda966";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="null" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Soul</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="/#" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="/#" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="/#" title="rss">rss</a>
					        
								<a class="zhihu" target="_blank" href="/#" title="zhihu">zhihu</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/自言语/" style="font-size: 10px;">自言语</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://emufan.com/">soul随笔</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">我是谁，我从哪里来，我到哪里去？我就是我，是颜色不一样的吃货…</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Soul</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="null" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">Soul</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="/#" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="/#" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="/#" title="rss">rss</a>
			        
						<a class="zhihu" target="_blank" href="/#" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-105ver" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/21/105ver/" class="article-date">
  	<time datetime="2015-10-21T14:57:05.755Z" itemprop="datePublished">2015-10-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/21/105ver/">简化CSS布局元素宽度计算问题 ： box-sizing属性</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>本文转自:<a href="http://www.gbtags.com/gb/gbtutorials/60.htm" target="_blank" rel="external">http://www.gbtags.com/gb/gbtutorials/60.htm</a></p><br><p>由于盒模式的宽度计算过于麻烦，特别是对于复杂的布局元素中的处理，现代浏览器引入了box-sizing这个属性，使用并且设置这个属性后，我们只需要设定宽度，浏览器会帮助我们自动计算对应的内容宽度，如下：</p><br><ol class="linenums"><br><li class="L0"><span class="pln">div</span><span class="pun">{</span></li><br><li class="L1"><span class="pln"> margin</span><span class="pun">:</span> <span class="lit">20px</span> <span class="kwd">auto</span><span class="pun">;</span></li><br><li class="L2"></li><br><li class="L3"><span class="com">/<em> 为了更加简单的处理元素的宽度问题这里我们可以使用box-sizing</em>/</span></li><br><li class="L4"><span class="pln"> box</span><span class="pun">-</span><span class="pln">sizing</span><span class="pun">:</span><span class="pln"> border</span><span class="pun">-</span><span class="pln">box</span><span class="pun">;</span></li><br><li class="L5"></li><br><li class="L6"><span class="com">/<em> 为了保证更多浏览器兼容性，我们添加如下前缀</em>/</span></li><br><li class="L7"><span class="pun">-</span><span class="pln">webkit</span><span class="pun">-</span><span class="pln">box</span><span class="pun">-</span><span class="pln">sizing</span><span class="pun">:</span><span class="pln"> border</span><span class="pun">-</span><span class="pln">box</span><span class="pun">;</span></li><br><li class="L8"><span class="pun">-</span><span class="pln">moz</span><span class="pun">-</span><span class="pln">box</span><span class="pun">-</span><span class="pln">sizing</span><span class="pun">:</span><span class="pln"> border</span><span class="pun">-</span><span class="pln">box</span><span class="pun">;</span></li><br><li class="L9"><span class="pun">}</span></li><br></ol><br><p>使用以上css定义后，我们只需要指定div的宽度，所有页面的元素无论是否有边框（border），或者有内外边距(padding,margin)，都会保证宽度为我们指定的宽度。如下：</p><br><p>&nbsp;</p><br><p><code>box-sizing</code> 是个比较新的CSS属性，目前还需要使用 <code>-webkit-</code> 和 <code>-moz-</code> 这类浏览器前缀，以便确保其它版本的浏览器能够更好兼容。同时请记住box-sizing支持<a href="http://caniuse.com/#search=box-sizing" target="_blank" rel="external">IE8+</a>。</p><br><p>&nbsp;</p>





      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-106ver" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/21/106ver/" class="article-date">
  	<time datetime="2015-10-21T14:57:05.755Z" itemprop="datePublished">2015-10-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/21/106ver/">深入理解Javascript之this关键字</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>转自<a href="http://www.laruence.com/2009/09/08/1076.html" target="_blank" rel="external">http://www.laruence.com/2009/09/08/1076.html</a></p><br><h1>08 Sep 09 <a title="Permanent Link to 深入理解Javascript之this关键字" href="http://www.laruence.com/2009/09/08/1076.html" rel="external" target="_blank">深入理解Javascript之this关键字</a></h1><br><div class="copyright"><br><ul><br><li>作者: <a href="http://www.laruence.com/" target="_blank" rel="external">Laruence</a>(<a title="Twitter" href="http://www.twitter.com/laruence" target="meme"><img src="http://www.laruence.com/images/ico-twitter.png" data-original="http://www.laruence.com/images/ico-twitter.png" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt=""></a> <a title="新浪微博" href="http://t.sina.com/laruence" target="meme"><img src="http://www.laruence.com/images/ico-sina.png" data-original="http://www.laruence.com/images/ico-sina.png" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt=""></a> <a title="Google阅读器" href="http://fusion.google.com/add?feedurl=http://www.laruence.com/feed" target="meme"><img src="http://www.laruence.com/images/ico-google.png" data-original="http://www.laruence.com/images/ico-google.png" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt=""></a> <a title="邮件" href="mailto:laruence@yahoo.com.cn" target="meme"><img src="http://www.laruence.com/images/ico-mail.png" data-original="http://www.laruence.com/images/ico-mail.png" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt=""></a>)</li><br><li>本文地址: <a title="Permanet Link to 深入理解Javascript之this关键字" href="http://www.laruence.com/2009/09/08/1076.html" target="_blank" rel="external">http://www.laruence.com/2009/09/08/1076.html</a></li><br><li>转载请注明出处</li><br></ul><br></div><br><p>Javascript是一种很灵活的语言, 而This关键字又是灵活中的灵活, 但是因为它的灵活, 也注定了它的难用.</p><br><p>以前我用this的时候, 都会觉得不踏实, 老是担心它不知道怎么地就会指到另外的什么地方.</p><br><p>其实, 这都是因为, 我们对它的不了解.</p><br><p>刚好最近再给百度学院做《Javascript高级-作用域/原型链》的ppt, 而swit1983网友也刚好提这个问题, 索性就把这部分内容独立总结出来, 与大家分享.</p><br><p>首先, 我先抛出一个定论:”在Javascript中,This关键字永远都指向函数(方法)的所有者”.</p><br><h3>函数</h3><br><p>首先,让我们看看”函数”:</p><br><ol><br><li><span class="sh_keyword">function</span> <span class="sh_function">introduce</span><span class="sh_symbol">()</span> <span class="sh_cbracket">{</span></li><br><li>     <span class="sh_function">alert</span><span class="sh_symbol">(</span><span class="sh_string">“Hello, I am Laruence</span><span class="sh_specialchar">\r\n</span><span class="sh_string">“</span><span class="sh_symbol">);</span></li><br><li><span class="sh_cbracket">}</span></li><br></ol><br><p>对于,这个函数, this关键字指向谁呢?</p><br><p>如我之前的文章所述(<a href="http://www.laruence.com/2009/05/28/863.html" target="_blank">Javascript作用域</a>), 定义在全局的函数, 函数的所有者就是当前页面, 也就是window对象.</p><br><p>这也就是为什么, 我把函数用引号引起来. 因为定义在全局的函数, 其实也就是window对象的一个方法.</p><br><p>所以,我们即可用通过函数名直接调用, 也可用通过window.方法名来调用, 这个时候, 方法中的this关键字指向它的所有者:window对象.</p><br><p>如果, 我们查看window的introduce属性, 就会得到:</p><br><ol><br><li><span class="sh_keyword">var</span> name <span class="sh_symbol">=</span> <span class="sh_string">“I am Laruence”</span><span class="sh_symbol">;</span></li><br><li><span class="sh_keyword">function</span> <span class="sh_function">introduce</span><span class="sh_symbol">()</span> <span class="sh_cbracket">{</span></li><br><li>     <span class="sh_function">alert</span><span class="sh_symbol">(</span><span class="sh_keyword">this</span><span class="sh_symbol">.</span>name<span class="sh_symbol">);</span></li><br><li><span class="sh_cbracket">}</span></li><br><li><span class="sh_function">alert</span><span class="sh_symbol">(</span>window<span class="sh_symbol">.</span>introduce<span class="sh_symbol">);</span></li><br><li><span class="sh_comment">/<strong></strong></span></li><br><li><span class="sh_comment"><em> output:</em></span></li><br><li><span class="sh_comment"> function introduce() {</span></li><br><li><span class="sh_comment"><em> alert(this.name);</em></span></li><br><li><span class="sh_comment"> }</span></li><br><li><span class="sh_comment">*/</span></li><br></ol><br><p>看了上面的代码, 也许你就会想到既然, 全局函数是window对象的方法, 全局变量是window对象的属性(Javasript作用域中已有述及), 那么,在全局函数中就可用通过this关键字来访问全局变量吧?</p><br><p>答案是肯定的, 如果调用introduce函数, 你就会认识我是Laruence.</p><br><h3>事件处理函数</h3><br><p>也许, 对于this关键字的迷惑, 绝大部分原因是来自把函数(方法)用在事件处理的时候.</p><br><ol><br><li><span class="sh_keyword">&lt;input</span> <span class="sh_type">id</span><span class="sh_symbol">=</span><span class="sh_string">“name”</span> <span class="sh_type">type</span><span class="sh_symbol">=</span><span class="sh_string">“text”</span> <span class="sh_type">name</span><span class="sh_symbol">=</span><span class="sh_string">“name”</span> <span class="sh_type">value</span><span class="sh_symbol">=</span><span class="sh_string">“Laruence”</span> <span class="sh_keyword">/&gt;</span></li><br></ol><br><p>比如, 我们现在需要在点击”name”输入框的时候, 显示出name输入框的value. 那么, 可用写下如下代码:</p><br><ol><br><li><span class="sh_keyword">function</span> <span class="sh_function">showValue</span><span class="sh_symbol">()</span> <span class="sh_cbracket">{</span></li><br><li>     <span class="sh_function">alert</span><span class="sh_symbol">(</span><span class="sh_keyword">this</span><span class="sh_symbol">.</span>value<span class="sh_symbol">);</span></li><br><li><span class="sh_cbracket">}</span></li><br><li>document<span class="sh_symbol">.</span><span class="sh_function">getElementById</span><span class="sh_symbol">(</span><span class="sh_string">‘name’</span><span class="sh_symbol">).</span>onclick <span class="sh_symbol">=</span> showValue<span class="sh_symbol">;</span></li><br></ol><br><p>上面的代码, 运行正常, 但是why? 不是说函数的this指针永远指向函数所有者么? 不是说全局变量的所有者是window对象么?</p><br><p>呵呵, 如果你能想到这个问题, 那说明你在认真的看我的文章, 否则,,我建议你从头看起, 否则看完了,你还是迷糊~</p><br><p>恩, 对, 对于上面的代码, showValue是定义在了全局对象, 那么看来问题只能发生在onclick事件绑定的时候了.</p><br><p>我们知道, 在Js中一切都是对象, 函数和方法也都是对象的属性, 只不过函数有可执行的内部属性. 所以, 对于上面的代码, 在对onclick绑定处理器的时候, 其实是对id为name的输入框Dom对象的onclick属性赋值.</p><br><p>也就是说, 我们把函数showValue Copy 给了name输入框对象的onclick属性. 如果我们查看此时的onclick:</p><br><ol><br><li><span class="sh_keyword">function</span> <span class="sh_function">showValue</span><span class="sh_symbol">()</span> <span class="sh_cbracket">{</span></li><br><li>     <span class="sh_function">alert</span><span class="sh_symbol">(</span><span class="sh_keyword">this</span><span class="sh_symbol">.</span>value<span class="sh_symbol">);</span></li><br><li><span class="sh_cbracket">}</span></li><br><li>document<span class="sh_symbol">.</span><span class="sh_function">getElementById</span><span class="sh_symbol">(</span><span class="sh_string">‘name’</span><span class="sh_symbol">).</span>onclick <span class="sh_symbol">=</span> showValue<span class="sh_symbol">;</span></li><br><li><span class="sh_function">alert</span><span class="sh_symbol">(</span>document<span class="sh_symbol">.</span><span class="sh_function">getElementById</span><span class="sh_symbol">(</span><span class="sh_string">‘name’</span><span class="sh_symbol">).</span>onclick<span class="sh_symbol">);</span></li><br><li><span class="sh_comment">/</span></li><br><li><span class="sh_comment"><em> output</em></span></li><br><li><span class="sh_comment"> function showValue() {</span></li><br><li><span class="sh_comment"><em> alert(this.value);</em></span></li><br><li><span class="sh_comment"> }</span></li><br><li><span class="sh_comment"><em>/</em></span></li><br></ol><br><p>所以, 当事件触发的时候, 就会去调用name输入框的onclick方法, 这个时候,this关键字自然就指向的是name输入框了.</p><br><p>但是, 迷惑的事情就来了, 比如下面这种写法:</p><br><ol><br><li><span class="sh_keyword">function</span> <span class="sh_function">showValue</span><span class="sh_symbol">()</span> <span class="sh_cbracket">{</span></li><br><li>     <span class="sh_function">alert</span><span class="sh_symbol">(</span><span class="sh_keyword">this</span><span class="sh_symbol">.</span>value<span class="sh_symbol">);</span></li><br><li><span class="sh_cbracket">}</span></li><br><li><span class="sh_symbol">&lt;</span>input id<span class="sh_symbol">=</span><span class="sh_string">“name”</span> type<span class="sh_symbol">=</span><span class="sh_string">“text”</span> name<span class="sh_symbol">=</span><span class="sh_string">“name”</span> value<span class="sh_symbol">=</span><span class="sh_string">“Laruence”</span> onclick<span class="sh_symbol">=</span><span class="sh_string">“showValue()”</span><span class="sh_symbol">/&gt;</span></li><br></ol><br><p>就无法正常运行, 这又是为什么呢?</p><br><p>恩, 因为这个时候, 并不是赋值, 而是引用.</p><br><p>如果我们注意俩种onclick的写法, 你会发现, 对于之前的方法, 我们使用的是:</p><br><ol><br><li>dom<span class="sh_symbol">.</span>onclick <span class="sh_symbol">=</span> showvalue<span class="sh_symbol">;</span> <span class="sh_comment">//没有调用符</span></li><br></ol><br><p>而对于刚才的方法:</p><br><ol><br><li>onclick <span class="sh_symbol">=</span> <span class="sh_string">“showvalue()”</span> <span class="sh_comment">//有调用符</span></li><br></ol><br><p>这个也能侧面的反映出俩者的区别:对于前者,是赋值, 而对于后者是引用. 如果我们这个时候查看输入框的onclick属性,我们得到:</p><br><ol><br><li><span class="sh_function">alert</span><span class="sh_symbol">(</span>dom<span class="sh_symbol">.</span>onclick<span class="sh_symbol">);</span></li><br><li><span class="sh_comment">/**</span></li><br><li><span class="sh_comment"> output:</span></li><br><li><span class="sh_comment"><em> function onclick() {</em></span></li><br><li><span class="sh_comment"> showValue();</span></li><br><li><span class="sh_comment"><em> }</em></span></li><br><li><span class="sh_comment">/</span></li><br></ol><br><p>看到区别了么? 也就懂得为什么了吧?</p><br><p>讲到这里, 有一个很有趣的例子 ,大家可以在IE下试试:</p><br><ol><br><li><span class="sh_symbol">&lt;</span>img src<span class="sh_symbol">=</span><span class="sh_string">“xxx”</span> onerror<span class="sh_symbol">=</span><span class="sh_string">“alert(1);} function hi() { alert(2); “</span> <span class="sh_symbol">/&gt;</span></li><br></ol><br><h3>改变this的指向</h3><br><p>那, 既然我们已经知道为什么了, 那怎么才能让this指向我们想要指的地方呢?</p><br><p>对于上面的事件处理函数来说, 我们可以有如下几种写法:</p><br><ol><br><li>dom<span class="sh_symbol">.</span>onclick <span class="sh_symbol">=</span> <span class="sh_function">showValue</span><span class="sh_symbol">();</span></li><br><li>dom<span class="sh_symbol">.</span>onclick <span class="sh_symbol">=</span> <span class="sh_keyword">function</span><span class="sh_symbol">()</span> <span class="sh_cbracket">{</span> <span class="sh_function">alert</span><span class="sh_symbol">(</span><span class="sh_keyword">this</span><span class="sh_symbol">.</span>value<span class="sh_symbol">)</span> <span class="sh_symbol">;</span><span class="sh_cbracket">}</span></li><br><li><span class="sh_symbol">&lt;</span>input onclick<span class="sh_symbol">=</span><span class="sh_string">“alert(this.value);”</span> <span class="sh_regexp">/&gt; /</span><span class="sh_symbol">/</span>想想刚才我们的引用<span class="sh_symbol">,</span>是如何把这句嵌入的<span class="sh_symbol">.</span></li><br><li>dom<span class="sh_symbol">.</span><span class="sh_function">addEventListener</span><span class="sh_symbol">(</span>dom<span class="sh_symbol">,</span> showValue<span class="sh_symbol">,</span> <span class="sh_keyword">false</span><span class="sh_symbol">);</span> <span class="sh_comment">//ff only</span></li><br></ol><br><p>而对于不是事件处理函数的场合, 我们可以使用apply, 或者call, 来改变this关键字的指向.</p><br><p>比如:</p><br><ol><br><li><span class="sh_keyword">var</span> laruence <span class="sh_symbol">=</span> <span class="sh_cbracket">{</span></li><br><li>     name <span class="sh_symbol">:</span> <span class="sh_string">‘laruence’</span><span class="sh_symbol">,</span></li><br><li>     age <span class="sh_symbol">:</span> <span class="sh_number">26</span><span class="sh_symbol">,</span></li><br><li>     position <span class="sh_symbol">:</span> <span class="sh_string">‘Senior PHP Engineer’</span><span class="sh_symbol">,</span></li><br><li>     company <span class="sh_symbol">:</span> <span class="sh_string">‘Baidu.inc’</span></li><br><li><span class="sh_cbracket">}</span><span class="sh_symbol">;</span></li><br><li></li><br><li><span class="sh_keyword">function</span> <span class="sh_function">introduce</span><span class="sh_symbol">()</span> <span class="sh_cbracket">{</span></li><br><li>     <span class="sh_function">alert</span><span class="sh_symbol">(</span><span class="sh_keyword">this</span><span class="sh_symbol">.</span>name<span class="sh_symbol">);</span></li><br><li><span class="sh_cbracket">}</span></li><br><li></li><br><li>introduce<span class="sh_symbol">.</span><span class="sh_function">call</span><span class="sh_symbol">(</span>laruence<span class="sh_symbol">);</span></li><br></ol><br><p>&nbsp;</p><br><p>&nbsp;</p>





      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-107ver" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/21/107ver/" class="article-date">
  	<time datetime="2015-10-21T14:57:05.755Z" itemprop="datePublished">2015-10-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/21/107ver/">干货！一步步实现自己的表单验证器</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p></p><p>转自<a href="http://www.gbtags.com/gb/share/5017.htm" target="_blank" rel="external">http://www.gbtags.com/gb/share/5017.htm</a></p><p></p>
<p></p><p>表单验证的需求简直太常见了。“<strong>所有用户的输入都是不可信的</strong>”这个思想指导我们在设计表单的时候，一定要进行用户输入的验证。对于用户体验而言，越早的反馈则越佳，所以表单验证的工作应该尽可能地在前端就进行（当然，前端对于后端而言也是输入端，所以后端仍然需要进行检验）。简单的表单验证完全可以给input绑定几个change事件来进行。但表单一复杂，或者相似验证规则一多，这种编码的方式就很难管理事件了。这时候，我们通常需要使用一些库来帮助我们处理表单验证的工作。前端表单验证的库太多了，随便一搜：<a href="http://www.zhouhua.info/jump/z000" target="_blank">表单验证-百度搜索</a>。</p><p></p>
<p></p><p>那……为什么还要自己实现一个呢？因为去年工作中遇到了比较复杂的验证逻辑，选一个别人的库一是要学习api，二是维护起来困难，要符合自己的页面风格也不是那么轻松；再加上表单验证器并不复杂，于是就打算自己写一个。所以这个表单验证器并不算那么地通用，不过我觉得传播思路和方法更重要，要想修修改改变成一个通用的库也很容易，只是没那么重要罢了（其实是懒……）。</p><p></p>
<p></p><h2>依赖</h2><p></p>
<p></p><p>jquery + bootstrap。jquery看来是缺不了，bootstrap没那么重要，对代码稍做修改就可以取消依赖。</p><p></p>
<p></p><h2>能做什么</h2><p></p>
<p></p><p>我期望这个表单验证器直接在html代码中指定好需要采用什么样的规则，不需要用javascript进行多余的配置；允许暂时跳过验证；允许扩展验证规则；提供验证难过、验证失败、警告三种验证结果；允许手动触发验证等等。</p><p></p>
<p></p><p>一个典型的bootstrap风格的表单项应该长这个样子：</p><p></p>
<p><div class="jspContainer"></div></p>
<p><div class="jspPane"></div></p>
<p><ol class="linenums"></ol></p>
<p><li class="L0"><span class="tag">&lt;div</span> <span class="atn">class</span><span class="pun">=</span><span class="atv">“form-group”</span><span class="tag">&gt;</span></li></p>
<p><li class="L1"><span class="tag">&lt;label</span> <span class="atn">class</span><span class="pun">=</span><span class="atv">“col-xs-2 control-label”</span><span class="tag">&gt;</span><span class="pln">手机号码</span></li></p>
<p><li class="L2"><span class="tag">&lt;span</span> <span class="atn">class</span><span class="pun">=</span><span class="atv">“request”</span><span class="tag">&gt;</span><span class="pln">*</span><span class="tag">&lt;/span&gt;</span><span class="pln">：</span><span class="tag">&lt;/label&gt;</span></li></p>
<p><li class="L3"><span class="tag">&lt;div</span> <span class="atn">class</span><span class="pun">=</span><span class="atv">“col-xs-6”</span><span class="tag">&gt;</span></li></p>
<p><li class="L4"><span class="tag">&lt;input</span> <span class="atn">class</span><span class="pun">=</span><span class="atv">“form-control”</span> <span class="atn">name</span><span class="pun">=</span><span class="atv">“mobile”</span> <span class="atn">type</span><span class="pun">=</span><span class="atv">“text”</span> <span class="atn">data-validate-disable</span><span class="pun">=</span><span class="atv">“true”</span> <span class="atn">data-validate</span><span class="pun">=</span><span class="atv">“request:notrim mobile”</span> <span class="tag">/&gt;</span></li></p>
<p><li class="L5"><span class="tag">&lt;p</span> <span class="atn">class</span><span class="pun">=</span><span class="atv">“text-info”</span><span class="tag">&gt;</span><span class="pln">请输入真实手机号码。</span><span class="tag">&lt;/p&gt;</span></li></p>
<p><li class="L6"><span class="tag">&lt;/div&gt;</span></li></p>
<p><li class="L7"><span class="tag">&lt;div</span> <span class="atn">class</span><span class="pun">=</span><span class="atv">“help-block col-xs-4”</span><span class="tag">&gt;</span><span class="pln">&amp;nbsp;</span><span class="tag">&lt;/div&gt;</span></li></p>
<p><li class="L8"><span class="tag">&lt;/div&gt;</span></li><br><br></p>
<p><div class="jspVerticalBar"></div></p>
<p><div class="jspHorizontalBar"></div><br></p>
<p></p><p>&nbsp;</p><p></p>
<p></p><p>重点看第5行，对于一个普通的input组件，我加了两个属性， data-validate-disable 有值表示表单验证时，会跳过这个input组件； data-validate 则存放如果要验证的话，将采用什么样的验证规则。这个例子中表示要验证这个input组件是否为空、是否为手机号码这两个规则。注意，在request 的后面我还加了一点内容，这是我想传递给验证规则的参数，比如这里我期望告诉验证器，如果input值只有空格，也认为是有值的。相似的，我们可以定义一个规则 min 来处理最少几个字符，并在html中把这个设定值传递进来，就像这样： data-validate=”min:10” 。我也期望一个验证规则允许多个参数传递，参数与参数之间用逗号隔开。</p><p></p>
<p></p><p>看起来很有意思，那就开始动手吧。</p><p></p>
<p></p><h2>先写个jquery插件吧</h2><p></p>
<p><div class="jspContainer"></div></p>
<p><div class="jspPane"></div></p>
<p><ol class="linenums"></ol></p>
<p><li class="L0"><span class="pun">(</span><span class="kwd">function</span> <span class="pun">(</span><span class="pln">$</span><span class="pun">)</span> <span class="pun">{</span></li></p>
<p><li class="L1"><span class="pln"> $</span><span class="pun">.</span><span class="pln">fn</span><span class="pun">.</span><span class="pln">validation </span><span class="pun">=</span> <span class="kwd">function</span> <span class="pun">()</span> <span class="pun">{</span></li></p>
<p><li class="L2"><span class="kwd">return</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">each</span><span class="pun">(</span><span class="kwd">function</span> <span class="pun">()</span> <span class="pun">{</span></li></p>
<p><li class="L3"><span class="kwd">var</span><span class="pln"> $this </span><span class="pun">=</span><span class="pln"> $</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></li></p>
<p><li class="L4"><span class="kwd">if</span> <span class="pun">(!</span><span class="pln">$this</span><span class="pun">.</span><span class="kwd">is</span><span class="pun">(</span><span class="str">‘:input’</span><span class="pun">))</span> <span class="pun">{</span></li></p>
<p><li class="L5"><span class="pln"> $this </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="str">‘:input’</span><span class="pun">);</span></li></p>
<p><li class="L6"><span class="pun">}</span></li></p>
<p><li class="L7"><span class="pln"> $this</span><span class="pun">.</span><span class="pln">off</span><span class="pun">(</span><span class="str">‘blur.zh select.zh focus.zh’</span><span class="pun">)</span></li></p>
<p><li class="L8"><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">‘blur.zh select.zh’</span><span class="pun">,</span><span class="pln"> validate</span><span class="pun">)</span></li></p>
<p><li class="L9"><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">‘focus.zh’</span><span class="pun">,</span><span class="pln"> clear</span><span class="pun">);</span></li></p>
<p><li class="L0"><span class="pun">});</span></li></p>
<p><li class="L1"><span class="pun">};</span></li></p>
<p><li class="L2"><span class="pun">}(</span><span class="pln">jQuery</span><span class="pun">));</span></li><br><br></p>
<p><div class="jspVerticalBar"></div><br></p>
<p></p><p>给jquery对象添加一个 validation 方法，用法很简单： $(Selector).validation() 。支持链式调用。<em>Selector</em>比较自由，如果是 :input 元素，则直接给这些元素初始化验证器；否则找出它们所有的 :input 子元素，给这些子元素初始化验证器。什么意思呢？就以上面的html片断为例，你可以任性地使用如下任意一种方式初始化验证器：</p><p></p>
<p><ul></ul></p>
<p><li>$(‘[name=mobile]’).validation(); // 选择:input</li></p>
<p><li>$(‘.form-group’).validation(); // 选择普通节点，对所有:input子元素生效</li></p>
<p><li>$(‘body’).validation(); // 对页面中所有的:input元素生效</li><br></p>
<p></p><p>再说说所谓的初始化，其实就是绑定事件。那么要绑定什么事件呢？主观上，对于一个输入框，当我们输入好了，焦点离开时，应该就进行输入内容的验证，并给出验证结果。如果验证失败，会有提示信息，但这些提示信息应该在重新获得焦点时清除，否则当用户在修正输入的时候还一直提示上次的错误信息，会让用户无所适从。那么针对以上的情况，我们需要在失去焦点（<em>blur</em>）和获得焦点（<em>focus</em>）时分别绑定验证的方法（<em>validate</em>）和清除错误信息的方法（<em>clear</em>）。另外针对checkbox、radiobox、select等控件，最好也给select事件绑定验证方法。</p><p></p>
<blockquote><p>为什么不使用更通用change事件来绑定验证方法呢？原因有二：</p><br><ol><br><li>我觉得有些场景需要用javascript载入默认值或历史输入。这些内容应该延后验证（不是不验证），不然刚打开页面就是表单验证错误让人很难受。所以change事件不合适。</li><br><li>由于获得焦点会清空错误消息，如果没有修改内容，直接失去焦点，这时不会触发change事件，导致不会再验证，表现为错误信息丢失。</li><br></ol><br></blockquote><br><p>那下面就来具体看看<em>validate</em>和<em>clear</em>两个方法。</p><br><h2>清除错误消息及验证状态设置</h2><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="kwd">function</span><span class="pln"> clear</span><span class="pun">()</span> <span class="pun">{</span></li><br><li class="L1"><span class="kwd">var</span><span class="pln"> $this </span><span class="pun">=</span><span class="pln"> $</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></li><br><li class="L2"><span class="kwd">var</span><span class="pln"> $parent </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">.</span><span class="pln">closest</span><span class="pun">(</span><span class="str">‘.form-group’</span><span class="pun">);</span></li><br><li class="L3"><span class="kwd">if</span> <span class="pun">(!</span><span class="pln">$parent</span><span class="pun">.</span><span class="pln">attr</span><span class="pun">(</span><span class="str">‘data-for’</span><span class="pun">)</span> <span class="pun">||</span></li><br><li class="L4"><span class="pln"> $parent</span><span class="pun">.</span><span class="pln">attr</span><span class="pun">(</span><span class="str">‘data-for’</span><span class="pun">)</span> <span class="pun">===</span><span class="pln"> $this</span><span class="pun">.</span><span class="pln">prop</span><span class="pun">(</span><span class="str">‘name’</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L5"><span class="pln"> $parent</span><span class="pun">.</span><span class="pln">attr</span><span class="pun">(</span><span class="str">‘data-for’</span><span class="pun">,</span> <span class="kwd">null</span><span class="pun">).</span><span class="pln">removeClass</span><span class="pun">(</span><span class="str">‘has-error waiting has-warning’</span><span class="pun">)</span></li><br><li class="L6"><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="str">‘.help-block’</span><span class="pun">).</span><span class="pln">text</span><span class="pun">(</span><span class="str">‘’</span><span class="pun">);</span></li><br><li class="L7"><span class="pun">}</span></li><br><li class="L8"><span class="pun">}</span></li><br><li class="L9"></li><br><li class="L0"><span class="kwd">function</span><span class="pln"> successHandler</span><span class="pun">()</span> <span class="pun">{</span></li><br><li class="L1"><span class="kwd">var</span><span class="pln"> $parent </span><span class="pun">=</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">closest</span><span class="pun">(</span><span class="str">‘.form-group’</span><span class="pun">);</span></li><br><li class="L2"><span class="kwd">if</span> <span class="pun">(!</span><span class="pln">$parent</span><span class="pun">.</span><span class="kwd">is</span><span class="pun">(</span><span class="str">‘.has-warning’</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L3"><span class="pln"> clear</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></li><br><li class="L4"><span class="pun">}</span></li><br><li class="L5"><span class="pun">}</span></li><br><li class="L6"></li><br><li class="L7"><span class="kwd">function</span><span class="pln"> failHandler</span><span class="pun">(</span><span class="pln">msg</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L8"><span class="kwd">var</span><span class="pln"> $parent </span><span class="pun">=</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">closest</span><span class="pun">(</span><span class="str">‘.form-group’</span><span class="pun">);</span></li><br><li class="L9"><span class="pln"> $parent</span><span class="pun">.</span><span class="pln">removeClass</span><span class="pun">(</span><span class="str">‘has-warning waiting’</span><span class="pun">).</span><span class="pln">addClass</span><span class="pun">(</span><span class="str">‘has-error’</span><span class="pun">).</span></li><br><li class="L0"><span class="pln"> attr</span><span class="pun">(</span><span class="str">‘data-for’</span><span class="pun">,</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">prop</span><span class="pun">(</span><span class="str">‘name’</span><span class="pun">)).</span><span class="pln">find</span><span class="pun">(</span><span class="str">‘.help-block’</span><span class="pun">).</span><span class="pln">text</span><span class="pun">(</span><span class="pln">msg</span><span class="pun">);</span></li><br><li class="L1"><span class="pun">}</span></li><br><li class="L2"></li><br><li class="L3"><span class="kwd">function</span><span class="pln"> warningHandler</span><span class="pun">(</span><span class="pln">msg</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L4"><span class="kwd">var</span><span class="pln"> $parent </span><span class="pun">=</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">closest</span><span class="pun">(</span><span class="str">‘.form-group’</span><span class="pun">);</span></li><br><li class="L5"><span class="pln"> $parent</span><span class="pun">.</span><span class="pln">removeClass</span><span class="pun">(</span><span class="str">‘waiting’</span><span class="pun">).</span><span class="pln">addClass</span><span class="pun">(</span><span class="str">‘has-warning’</span><span class="pun">).</span></li><br><li class="L6"><span class="pln"> attr</span><span class="pun">(</span><span class="str">‘data-for’</span><span class="pun">,</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">prop</span><span class="pun">(</span><span class="str">‘name’</span><span class="pun">)).</span><span class="pln">find</span><span class="pun">(</span><span class="str">‘.help-block’</span><span class="pun">).</span><span class="pln">text</span><span class="pun">(</span><span class="pln">msg</span><span class="pun">);</span></li><br><li class="L7"><span class="pun">}</span></li><br></ol><br></div><br><div class="jspVerticalBar"></div><br></div><br><p>&nbsp;</p><br><h2> 这一段一起说，因为这部分内容是dom操作相关的，与bootstrap强相关，如果你不用bootstrap，那就尽情地替换掉吧（估计改几个类名就行了）。这几个函数的用途从名字上就可以看出。clear上面已经提到过，清空验证信息；另外三个分别处理验证通过、验证失败和警告时的信息展示。简单是简单，但这里有两个问题需要额外考虑一下。</h2><br><p>第一个是验证信息优先级的问题：</p><br><p>一个输入项可能同时有多个验证规则要匹配，可能有些验证规则通过，有些失败，有些警告。在具体处理时，我觉得比较合理的流程是：如果出现验证失败，则立刻停止后续验证，直接提示错误信息；如果警告，则提示警告信息，并继续后续规则验证；如果验证成功，理论上不需要做任何处理，直接进行下一步验证，但谨慎起见，还是做一下清空错误信息的工作，但要注意不可以清空掉警告信息（错误信息不用管，因为一产生错误信息，验证也就停止了，不会再触发验证成功了）。</p><br><p>另一个问题是同一个表单单元中有多个输入控件的问题，就像这样：</p><br><p><img src="http://zhouhua.qiniudn.com//wp-content/uploads/2015/04/QQ20150415121912.png" data-original="http://zhouhua.qiniudn.com//wp-content/uploads/2015/04/QQ20150415121912.png" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt="QQ20150415121912" width="586" height="96"></p><br><p>几个控件共用了一个错误信息展示文本，我觉得如果某一个控件输入内容有误，必须再次修改这个控件内容才能清空错误信息，修改别的控件时，这个错误信息应该保留。所以在清除错误信息时，我们额外需要知道这个错误信息是由哪个控件引起的。在上面的示例中，我们在处理验证错误和警告时，把引起问题的控件的<em>name</em>记录到表单单元的<em>data-for</em>属性中了。到需要清空的时候再比对一下<em>data-for</em>和当前控件的<em>name</em>是不是一致，不一致就不清空错误信息。</p><br><h2>处理验证流程</h2><br><p>我们给输入控件的<em>blur</em>和<em>select</em>事件绑定了<em>validate</em>方法，那么这个validate方法如何实现呢？</p><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="kwd">function</span><span class="pln"> validate</span><span class="pun">()</span> <span class="pun">{</span></li><br><li class="L1"><span class="kwd">var</span><span class="pln"> $this </span><span class="pun">=</span><span class="pln"> $</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></li><br><li class="L2"><span class="kwd">var</span><span class="pln"> success </span><span class="pun">=</span> <span class="kwd">new</span><span class="pln"> $</span><span class="pun">.</span><span class="typ">Callbacks</span><span class="pun">();</span></li><br><li class="L3"><span class="kwd">var</span><span class="pln"> fail </span><span class="pun">=</span> <span class="kwd">new</span><span class="pln"> $</span><span class="pun">.</span><span class="typ">Callbacks</span><span class="pun">();</span></li><br><li class="L4"><span class="kwd">var</span><span class="pln"> warning </span><span class="pun">=</span> <span class="kwd">new</span><span class="pln"> $</span><span class="pun">.</span><span class="typ">Callbacks</span><span class="pun">();</span></li><br><li class="L5"><span class="kwd">var</span><span class="pln"> $parent </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">.</span><span class="pln">closest</span><span class="pun">(</span><span class="str">‘.form-group’</span><span class="pun">);</span></li><br><li class="L6"><span class="pln"> success</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="kwd">function</span> <span class="pun">(</span><span class="pln">value</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L7"><span class="pln"> successHandler</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">);</span></li><br><li class="L8"><span class="pun">});</span></li><br><li class="L9"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="kwd">function</span> <span class="pun">(</span><span class="pln">value</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L0"><span class="pln"> failHandler</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">);</span></li><br><li class="L1"><span class="pun">});</span></li><br><li class="L2"><span class="pln"> warning</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="kwd">function</span> <span class="pun">(</span><span class="pln">value</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L3"><span class="pln"> warningHandler</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">);</span></li><br><li class="L4"><span class="pun">});</span></li><br><li class="L5"><span class="pln"> clear</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">);</span></li><br><li class="L6"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">$this</span><span class="pun">.</span><span class="kwd">is</span><span class="pun">(</span><span class="str">‘:disabled’</span><span class="pun">)</span> <span class="pun">||</span><span class="pln"> $this</span><span class="pun">.</span><span class="kwd">is</span><span class="pun">(</span><span class="str">‘[data-validate-disable]’</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L7"><span class="kwd">return</span><span class="pun">;</span></li><br><li class="L8"><span class="pun">}</span></li><br><li class="L9"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">$this</span><span class="pun">.</span><span class="pln">attr</span><span class="pun">(</span><span class="str">‘data-validate’</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L0"><span class="kwd">var</span><span class="pln"> conditions </span><span class="pun">=</span> <span class="pun">(</span><span class="pln">$this</span><span class="pun">.</span><span class="pln">attr</span><span class="pun">(</span><span class="str">‘data-validate’</span><span class="pun">)</span> <span class="pun">||</span> <span class="str">‘’</span><span class="pun">).</span><span class="pln">split</span><span class="pun">(</span><span class="str">/\s+/</span><span class="pln">g</span><span class="pun">);</span></li><br><li class="L1"><span class="kwd">for</span> <span class="pun">(</span><span class="kwd">var</span><span class="pln"> i </span><span class="kwd">in</span></li><br><li class="L2"><span class="pln"> conditions</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L3"><span class="kwd">var</span><span class="pln"> condition </span><span class="pun">=</span><span class="pln"> conditions</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span></li><br><li class="L4"><span class="pln"> $parent</span><span class="pun">.</span><span class="pln">addClass</span><span class="pun">(</span><span class="str">‘waiting’</span><span class="pun">);</span></li><br><li class="L5"><span class="kwd">if</span> <span class="pun">(!</span><span class="pln">pickStrategy</span><span class="pun">(</span><span class="pln">condition</span><span class="pun">.</span><span class="pln">split</span><span class="pun">(</span><span class="str">/[:,]/</span><span class="pln">g</span><span class="pun">),</span><span class="pln"> $this</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">,</span><span class="pln"> warning</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L6"><span class="kwd">break</span><span class="pun">;</span></li><br><li class="L7"><span class="pun">}</span></li><br><li class="L8"><span class="pun">}</span></li><br><li class="L9"><span class="pun">}</span></li><br><li class="L0"><span class="pun">}</span></li><br></ol><br></div><br><div class="jspVerticalBar"></div><br></div><br><p>&nbsp;</p><br><p>先看这段代码的前一部分，我定义了三个$.Callbacks对象，分别用以处理不同验证结果的响应。从效果上，不用$.Callbacks对象，直接传递函数引用也是可行的，我是想把dom操作和验证逻辑分离开，用类似事件触发的异步形式来处理验证逻辑。</p><br><p>再看第17行，它规定了两种情形不执行验证，一种是控件被禁用，另一种是控件中存在<em>data-validate-disable</em>属性。这个不用多解释了。</p><br><p>重点看20~30行，这段是关键。第21行中，我们把<em>data-validate</em>中的内容按空白（空格、tab、换行）切割到一个数组<em>conditions</em>中，<em>conditions</em>中的每一项都是一条需要验证的规则。那么很自然地，遍历这个数组。再看第26行，引入了一个新的方法<em>pickStrategy</em>，很明显它是对这条规则进行验证。先别管它的实现，看看它接收的参数。还记得前面我们说要允许用 rule:param1,param2 的形式给验证规则传入参数吗？<em>pickStrategy</em>拿到的第一个参数就是 [rule, param1, param2] ，通过condition.spit(/[:,]/g) 解析出。第二个参数是当前处理的控件的jquery对象，后面三个分别是验证成功、失败、警告三种情形的回调对象。如果验证失败，<em>pickStrategy</em>应该返回 false ，同时中止验证，否则验证下一条规则。</p><br><h2>策略模式</h2><br><p>下面就要来说<em>pickStrategy</em>方法了，不过先要补充一点背景知识——策略模式。策略模式是一种设计模式。</p><br><p>设计模式是搞软件工程的人常常挂在嘴边的词汇，表示对设计的复用。当然前端开发在工程化的进程上每家公司情况各异，我估计绝大多数公司的前端开发并不考虑工程上的问题，只考虑完成需求。因而对于没有OO编程开发背景的前端开发而言，设计模式可能是陌生的，甚至程序设计（别紧张，没有在说程序编写）本身就是陌生的。由于工程化的忽略和javascript语言本身的优点（很多模式没必要实现）和缺点（很多模式无法实现），前端开发中很少提设计模式。那么前端开发者怎么理解设计模式呢？设计模式就是一系统问题（场景）的通用解决思路。比如有人觉得jquery的链式调用很好用，能很大程度降低工作量，于是在别的地方也用函数 return this; 的方式构造支持链式调用的函数，这就可以认为是一个模式（谈不上设计模式）。</p><br><p>那策略模式是为了解决什么问题，或应对什么场景的呢？如果干一件事、完成一个任务可以有不同的策略，不同的算法来完成，这些策略、算法应该具有相同的输入和输出，但可以使用不同的资源（即不care中间实现差异）。具体要采用什么策略和方法则在程序运行时依据条件选择。举个例子？</p><br><p><img src="http://zhouhua.qiniudn.com//wp-content/uploads/2015/04/QQ20150415155218.png" data-original="http://zhouhua.qiniudn.com//wp-content/uploads/2015/04/QQ20150415155218.png" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt="QQ20150415155218" width="470" height="403"></p><br><p>压缩文件，你可以选择不同的算法，但它们拥有相同的输入和输出。</p><br><p>那么我们做表单验证跟策略模式有什么关系呢？我们完全可以把每个验证规则看作是一个策略，我们支持的所有的策略放在一起，取个高大上的名字叫“策略池”。当我们想验证一个规则的时候，只需要去策略池中取出这个策略跑一下，不需要在一个很大的函数里面跑一堆if…else，或者switch…case。另外如果有新的规则加进来，只要把它塞到策略池中，无需更改已有的代码，<strong>实现验证规则和验证流程解耦</strong>。</p><br><p>先实现一个策略池吧：</p><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">strategy </span><span class="pun">=</span> <span class="pun">{};</span></li><br></ol><br></div><br></div><br><p>&nbsp;</p><br><p>太棒了，一句代码就完事了，爱死javascript了！</p><br><p>再回到<em>pickStrategy</em>方法，看看怎么从这个策略池中拿到我们需要的验证规则：</p><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="kwd">function</span><span class="pln"> pickStrategy</span><span class="pun">(</span><span class="pln">tokens</span><span class="pun">,</span><span class="pln"> scope</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">,</span><span class="pln"> warning</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L1"><span class="kwd">var</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> tokens</span><span class="pun">.</span><span class="pln">shift</span><span class="pun">();</span></li><br><li class="L2"><span class="kwd">var</span><span class="pln"> strategy </span><span class="pun">=</span><span class="pln"> $</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">strategy</span><span class="pun">[</span><span class="pln">name</span><span class="pun">];</span></li><br><li class="L3"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">strategy</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L4"><span class="kwd">return</span><span class="pln"> strategy</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="pln">scope</span><span class="pun">,</span><span class="pln"> tokens</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">,</span><span class="pln"> warning</span><span class="pun">);</span></li><br><li class="L5"><span class="pun">}</span></li><br><li class="L6"><span class="kwd">else</span> <span class="pun">{</span></li><br><li class="L7"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L8"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L9"><span class="pun">}</span></li><br><li class="L0"><span class="pun">}</span></li><br></ol><br></div><br><div class="jspVerticalBar"></div><br></div><br><p>&nbsp;</p><br><p>先说这个<em>token</em>，还记得它是什么吗？如果要验证的规则是“min:5”，那么<em>token</em>就是 [‘min’,’5’] 这个数组。第2行取出这个数组的第一项 ‘min’ ，再从策略池中取出这个验证规则。如果没有这个规则，则跳过这次验证，认为此次通过；如果有这个规则，则执行这个规则（见第5行），需要注意一下第5行的<em>token</em>已经发生变化了，除去规则名称，只剩下参数了，延续前面的例子，这里<em>token</em>应该是 [‘5’] 。</p><br><p>现在我们的策略池是空的，那可不行，先试着写一个验证“min”规则的方法吧：</p><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">strategy</span><span class="pun">.</span><span class="pln">min </span><span class="pun">=</span> <span class="kwd">function</span> <span class="pun">(</span><span class="pln">condition</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L1"><span class="kwd">if</span> <span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">()</span> <span class="pun">===</span> <span class="str">‘’</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L2"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L3"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L4"><span class="pun">}</span></li><br><li class="L5"><span class="kwd">var</span><span class="pln"> length </span><span class="pun">=</span> <span class="pun">+(</span><span class="pln">condition </span><span class="pun">&amp;&amp;</span><span class="pln"> condition</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]);</span></li><br><li class="L6"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">length</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L7"><span class="kwd">if</span> <span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">().</span><span class="pln">length </span><span class="pun">&gt;=</span><span class="pln"> length</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L8"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L9"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L0"><span class="pun">}</span></li><br><li class="L1"><span class="kwd">else</span> <span class="pun">{</span></li><br><li class="L2"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘请至少输入’</span> <span class="pun">+</span><span class="pln"> length </span><span class="pun">+</span> <span class="str">‘个字！’</span><span class="pun">);</span></li><br><li class="L3"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L4"><span class="pun">}</span></li><br><li class="L5"><span class="pun">}</span></li><br><li class="L6"><span class="kwd">else</span> <span class="pun">{</span></li><br><li class="L7"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L8"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L9"><span class="pun">}</span></li><br><li class="L0"><span class="pun">}</span></li><br></ol><br></div><br><div class="jspVerticalBar"></div><br></div><br><p>&nbsp;</p><br><p>这个方法内，<em>this</em>指向当前验证的控件的jquery对象，第1个参数是额外带给验证规则的参数；第2个参数是验证成功的回调，使用时需要配合 return true; （见9、10行）；第3个参数是验证失败的回调，使用是需要配合 return false; （见13、14行）；第4个参数是警告的回调，需要配合return true; ，这个验证中没用到。</p><br><p>起始的几个验证方法也可以直接写在策略池中，我写了几个，供大家参考：</p><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constants </span><span class="pun">=</span> <span class="pun">{</span></li><br><li class="L1"><span class="str">‘request’</span><span class="pun">:</span> <span class="str">/./</span><span class="pun">,</span></li><br><li class="L2"><span class="str">‘trimLeft’</span><span class="pun">:</span> <span class="str">/^\s+/</span><span class="pun">,</span></li><br><li class="L3"><span class="str">‘trimRight’</span><span class="pun">:</span> <span class="str">/\s+$/</span><span class="pun">,</span></li><br><li class="L4"><span class="str">‘trim’</span><span class="pun">:</span> <span class="str">/(^\s+)|(\s+$)/</span><span class="pln">g</span><span class="pun">,</span></li><br><li class="L5"><span class="str">‘number’</span><span class="pun">:</span> <span class="str">/^-?\d+(,\d{3,4})<em>(.\d+)?$/</em></span><span class="pun">,</span></li><br><li class="L6"><span class="str">‘purenumber’</span><span class="pun">:</span> <span class="str">/^\d+$/</span><span class="pun">,</span></li><br><li class="L7"><span class="str">‘shenfenzheng’</span><span class="pun">:</span> <span class="str">/^\d{17}[\dx]$/</span><span class="pln">i</span><span class="pun">,</span></li><br><li class="L8"><span class="str">‘taibaozheng’</span><span class="pun">:</span> <span class="str">/^\d{8}(\d{2})?$/</span><span class="pun">,</span></li><br><li class="L9"><span class="str">‘zhizhao’</span><span class="pun">:</span> <span class="str">/^\d{15}$/</span><span class="pun">,</span></li><br><li class="L0"><span class="str">‘mobile’</span><span class="pun">:</span> <span class="str">/^1[345789]\d{9}$/</span><span class="pun">,</span></li><br><li class="L1"><span class="str">‘telephone’</span><span class="pun">:</span> <span class="str">/^\d{7,8}([ +-]\d+)?$/</span><span class="pun">,</span></li><br><li class="L2"><span class="str">‘email’</span><span class="pun">:</span> <span class="str">/^[a-z0-9.-<em>+]+@[a-z0-9-</em>]+(.[a-z0-9-<em>]+)+$/</em></span><span class="pln">i</span><span class="pun">,</span></li><br><li class="L3"><span class="str">‘url’</span><span class="pun">:</span> <span class="str">/^(https?:\/\/)?(([\d]{1,3}.){3}[\d]{1,3}|([\d\w!~\‘()-]+.)<em>([\d\w][\d\w-]{0,61})?[\d\w].[\w]{2,6})(:[\d]{1,4})?((\/?)|(\/[\d\w_!~</em>\‘().;?:@&amp;=+$,%#-]+)+\/?)$/</span></li><br><li class="L4"><span class="pun">};</span></li><br><li class="L5"><span class="pln"> </span></li><br><li class="L6"><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">strategy </span><span class="pun">=</span> <span class="pun">{</span></li><br><li class="L7"><span class="str">‘request’</span><span class="pun">:</span> <span class="kwd">function</span> <span class="pun">(</span><span class="pln">condition</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L8"><span class="kwd">if</span> <span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">is</span><span class="pun">(</span><span class="str">“[type=checkbox]”</span><span class="pun">)</span> <span class="pun">||</span> <span class="kwd">this</span><span class="pun">.</span><span class="kwd">is</span><span class="pun">(</span><span class="str">“[type=radio]”</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L9"><span class="kwd">var</span><span class="pln"> name </span><span class="pun">=</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">attr</span><span class="pun">(</span><span class="str">“name”</span><span class="pun">);</span></li><br><li class="L0"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">name</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L1"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">$</span><span class="pun">(</span><span class="str">“[name=”</span> <span class="pun">+</span><span class="pln"> name </span><span class="pun">+</span> <span class="str">“]:checked”</span><span class="pun">).</span><span class="pln">length</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L2"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L3"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L4"><span class="pun">}</span></li><br><li class="L5"><span class="kwd">else</span> <span class="pun">{</span></li><br><li class="L6"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘不能为空！’</span><span class="pun">);</span></li><br><li class="L7"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L8"><span class="pun">}</span></li><br><li class="L9"><span class="pun">}</span></li><br><li class="L0"><span class="kwd">else</span> <span class="pun">{</span></li><br><li class="L1"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L2"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L3"><span class="pun">}</span></li><br><li class="L4"><span class="pun">}</span></li><br><li class="L5"><span class="kwd">else</span> <span class="pun">{</span></li><br><li class="L6"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">condition </span><span class="pun">&amp;&amp;</span><span class="pln"> condition</span><span class="pun">[</span><span class="lit">0</span><span class="pun">])</span> <span class="pun">{</span></li><br><li class="L7"><span class="kwd">switch</span> <span class="pun">(</span><span class="pln">condition</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">toLowerCase</span><span class="pun">())</span> <span class="pun">{</span></li><br><li class="L8"><span class="kwd">case</span> <span class="str">‘notrim’</span><span class="pun">:</span></li><br><li class="L9"><span class="kwd">break</span><span class="pun">;</span></li><br><li class="L0"><span class="kwd">case</span> <span class="str">‘trimleft’</span><span class="pun">:</span></li><br><li class="L1"><span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">().</span><span class="pln">replace</span><span class="pun">(</span><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="pln">trimLeft</span><span class="pun">,</span> <span class="str">‘’</span><span class="pun">));</span></li><br><li class="L2"><span class="kwd">break</span><span class="pun">;</span></li><br><li class="L3"><span class="kwd">case</span> <span class="str">‘trimright’</span><span class="pun">:</span></li><br><li class="L4"><span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">().</span><span class="pln">replace</span><span class="pun">(</span><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="pln">trimRight</span><span class="pun">,</span> <span class="str">‘’</span><span class="pun">));</span></li><br><li class="L5"><span class="kwd">break</span><span class="pun">;</span></li><br><li class="L6"><span class="kwd">default</span><span class="pun">:</span></li><br><li class="L7"><span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">().</span><span class="pln">replace</span><span class="pun">(</span><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="pln">trim</span><span class="pun">,</span> <span class="str">‘’</span><span class="pun">));</span></li><br><li class="L8"><span class="kwd">break</span><span class="pun">;</span></li><br><li class="L9"><span class="pun">}</span></li><br><li class="L0"><span class="pun">}</span></li><br><li class="L1"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="pln">request</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">()))</span> <span class="pun">{</span></li><br><li class="L2"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L3"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L4"><span class="pun">}</span></li><br><li class="L5"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘不能为空！’</span><span class="pun">);</span></li><br><li class="L6"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L7"><span class="pun">}</span></li><br><li class="L8"><span class="pun">},</span></li><br><li class="L9"><span class="str">‘min’</span><span class="pun">:</span> <span class="kwd">function</span> <span class="pun">(</span><span class="pln">condition</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L0"><span class="kwd">if</span> <span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">()</span> <span class="pun">===</span> <span class="str">‘’</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L1"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L2"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L3"><span class="pun">}</span></li><br><li class="L4"><span class="kwd">var</span><span class="pln"> length </span><span class="pun">=</span> <span class="pun">+(</span><span class="pln">condition </span><span class="pun">&amp;&amp;</span><span class="pln"> condition</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]);</span></li><br><li class="L5"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">length</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L6"><span class="kwd">if</span> <span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">().</span><span class="pln">length </span><span class="pun">&gt;=</span><span class="pln"> length</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L7"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L8"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L9"><span class="pun">}</span></li><br><li class="L0"><span class="kwd">else</span> <span class="pun">{</span></li><br><li class="L1"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘请至少输入’</span> <span class="pun">+</span><span class="pln"> length </span><span class="pun">+</span> <span class="str">‘个字！’</span><span class="pun">);</span></li><br><li class="L2"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L3"><span class="pun">}</span></li><br><li class="L4"><span class="pun">}</span></li><br><li class="L5"><span class="kwd">else</span> <span class="pun">{</span></li><br><li class="L6"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L7"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L8"><span class="pun">}</span></li><br><li class="L9"><span class="pun">},</span></li><br><li class="L0"><span class="str">‘max’</span><span class="pun">:</span> <span class="kwd">function</span> <span class="pun">(</span><span class="pln">condition</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L1"><span class="kwd">var</span><span class="pln"> length </span><span class="pun">=</span> <span class="pun">+(</span><span class="pln">condition </span><span class="pun">&amp;&amp;</span><span class="pln"> condition</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]);</span></li><br><li class="L2"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">length</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L3"><span class="kwd">if</span> <span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">().</span><span class="pln">length </span><span class="pun">&lt;=</span><span class="pln"> length</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L4"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L5"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L6"><span class="pun">}</span></li><br><li class="L7"><span class="kwd">else</span> <span class="pun">{</span></li><br><li class="L8"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘不能超过’</span> <span class="pun">+</span><span class="pln"> length </span><span class="pun">+</span> <span class="str">‘个字！’</span><span class="pun">);</span></li><br><li class="L9"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L0"><span class="pun">}</span></li><br><li class="L1"><span class="pun">}</span></li><br><li class="L2"><span class="kwd">else</span> <span class="pun">{</span></li><br><li class="L3"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L4"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L5"><span class="pun">}</span></li><br><li class="L6"><span class="pun">},</span></li><br><li class="L7"><span class="str">‘number’</span><span class="pun">:</span> <span class="kwd">function</span> <span class="pun">(</span><span class="pln">condition</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L8"><span class="kwd">var</span><span class="pln"> value </span><span class="pun">=</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">();</span></li><br><li class="L9"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">value </span><span class="pun">===</span> <span class="str">‘’</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L0"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L1"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L2"><span class="pun">}</span></li><br><li class="L3"><span class="pln"> condition </span><span class="pun">=</span><span class="pln"> condition </span><span class="pun">||</span> <span class="pun">[];</span></li><br><li class="L4"><span class="kwd">if</span> <span class="pun">(!</span><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="pln">number</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">value</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L5"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘请输入数字！’</span><span class="pun">);</span></li><br><li class="L6"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L7"><span class="pun">}</span></li><br><li class="L8"><span class="kwd">for</span> <span class="pun">(</span><span class="kwd">var</span><span class="pln"> i </span><span class="kwd">in</span></li><br><li class="L9"><span class="pln"> condition</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L0"><span class="kwd">var</span><span class="pln"> c </span><span class="pun">=</span><span class="pln"> condition</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">toLowerCase</span><span class="pun">();</span></li><br><li class="L1"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">c </span><span class="pun">===</span> <span class="str">‘pure’</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L2"><span class="kwd">if</span> <span class="pun">(!</span><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="pln">purenumber</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">value</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L3"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘请输入0~9组成的数字！’</span><span class="pun">);</span></li><br><li class="L4"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L5"><span class="pun">}</span></li><br><li class="L6"><span class="pun">}</span></li><br><li class="L7"><span class="kwd">else</span> <span class="kwd">if</span> <span class="pun">(</span><span class="str">/^\d+[~-]\d+$/</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">c</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L8"><span class="kwd">var</span><span class="pln"> match </span><span class="pun">=</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">match</span><span class="pun">(</span><span class="str">/\d+/</span><span class="pln">g</span><span class="pun">);</span></li><br><li class="L9"><span class="kwd">var</span><span class="pln"> length </span><span class="pun">=</span><span class="pln"> value</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></li><br><li class="L0"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">length </span><span class="pun">&lt;</span> <span class="pun">+</span><span class="pln">match</span><span class="pun">[</span><span class="lit">0</span><span class="pun">])</span> <span class="pun">{</span></li><br><li class="L1"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘请至少输入’</span> <span class="pun">+</span><span class="pln"> match</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span> <span class="pun">+</span> <span class="str">‘位数字！’</span><span class="pun">);</span></li><br><li class="L2"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L3"><span class="pun">}</span></li><br><li class="L4"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">length </span><span class="pun">&gt;</span> <span class="pun">+</span><span class="pln">match</span><span class="pun">[</span><span class="lit">1</span><span class="pun">])</span> <span class="pun">{</span></li><br><li class="L5"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘最多只能输入’</span> <span class="pun">+</span><span class="pln"> match</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span> <span class="pun">+</span> <span class="str">‘位数字！’</span><span class="pun">);</span></li><br><li class="L6"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L7"><span class="pun">}</span></li><br><li class="L8"><span class="pun">}</span></li><br><li class="L9"><span class="kwd">else</span> <span class="kwd">if</span> <span class="pun">(</span><span class="str">/^\d+$/</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">c</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L0"><span class="kwd">if</span> <span class="pun">(+</span><span class="pln">c </span><span class="pun">!==</span><span class="pln"> value</span><span class="pun">.</span><span class="pln">length</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L1"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘请输入’</span> <span class="pun">+</span><span class="pln"> c </span><span class="pun">+</span> <span class="str">‘位数字！’</span><span class="pun">);</span></li><br><li class="L2"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L3"><span class="pun">}</span></li><br><li class="L4"><span class="pun">}</span></li><br><li class="L5"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L6"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L7"><span class="pun">}</span></li><br><li class="L8"><span class="pun">},</span></li><br><li class="L9"><span class="str">‘mobile’</span><span class="pun">:</span> <span class="kwd">function</span> <span class="pun">(</span><span class="pln">condition</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L0"><span class="kwd">var</span><span class="pln"> value </span><span class="pun">=</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">();</span></li><br><li class="L1"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">value </span><span class="pun">===</span> <span class="str">‘’</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L2"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L3"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L4"><span class="pun">}</span></li><br><li class="L5"><span class="kwd">if</span> <span class="pun">(!</span><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="pln">mobile</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">value</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L6"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘手机号码输入有误，请检查后重新输入！’</span><span class="pun">);</span></li><br><li class="L7"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L8"><span class="pun">}</span></li><br><li class="L9"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L0"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L1"><span class="pun">},</span></li><br><li class="L2"><span class="str">‘url’</span><span class="pun">:</span> <span class="kwd">function</span> <span class="pun">(</span><span class="pln">condition</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L3"><span class="kwd">var</span><span class="pln"> value </span><span class="pun">=</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">();</span></li><br><li class="L4"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">value </span><span class="pun">===</span> <span class="str">‘’</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L5"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L6"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L7"><span class="pun">}</span></li><br><li class="L8"><span class="kwd">if</span> <span class="pun">(!</span><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="pln">url</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">value</span><span class="pun">.</span><span class="pln">toLowerCase</span><span class="pun">()))</span> <span class="pun">{</span></li><br><li class="L9"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘请输入正确的网址！如<a href="http://www.baidu.com" target="_blank" rel="external">http://www.baidu.com</a>‘</span><span class="pun">);</span></li><br><li class="L0"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L1"><span class="pun">}</span></li><br><li class="L2"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L3"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L4"><span class="pun">},</span></li><br><li class="L5"><span class="str">‘email’</span><span class="pun">:</span> <span class="kwd">function</span> <span class="pun">(</span><span class="pln">condition</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L6"><span class="kwd">var</span><span class="pln"> value </span><span class="pun">=</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">();</span></li><br><li class="L7"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">value </span><span class="pun">===</span> <span class="str">‘’</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L8"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L9"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L0"><span class="pun">}</span></li><br><li class="L1"><span class="kwd">if</span> <span class="pun">(!</span><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="pln">email</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">value</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L2"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘电子邮箱格式错误，请检查后重新输入！’</span><span class="pun">);</span></li><br><li class="L3"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L4"><span class="pun">}</span></li><br><li class="L5"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L6"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L7"><span class="pun">},</span></li><br><li class="L8"><span class="str">‘telephone’</span><span class="pun">:</span> <span class="kwd">function</span> <span class="pun">(</span><span class="pln">condition</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L9"><span class="kwd">var</span><span class="pln"> value </span><span class="pun">=</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">();</span></li><br><li class="L0"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">value </span><span class="pun">===</span> <span class="str">‘’</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L1"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L2"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L3"><span class="pun">}</span></li><br><li class="L4"><span class="kwd">if</span> <span class="pun">(!</span><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="pln">telephone</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">value</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L5"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘电话号码输入有误，请检查后重新输入！！’</span><span class="pun">);</span></li><br><li class="L6"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L7"><span class="pun">}</span></li><br><li class="L8"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L9"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L0"><span class="pun">},</span></li><br><li class="L1"><span class="str">‘shenfenzheng’</span><span class="pun">:</span> <span class="kwd">function</span> <span class="pun">(</span><span class="pln">condition</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L2"><span class="kwd">var</span><span class="pln"> value </span><span class="pun">=</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">();</span></li><br><li class="L3"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">value </span><span class="pun">===</span> <span class="str">‘’</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L4"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L5"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L6"><span class="pun">}</span></li><br><li class="L7"><span class="pln"> value </span><span class="pun">=</span><span class="pln"> value</span><span class="pun">.</span><span class="pln">toLowerCase</span><span class="pun">();</span></li><br><li class="L8"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="pln">shenfenzheng</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">value</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L9"><span class="kwd">var</span><span class="pln"> numbers </span><span class="pun">=</span><span class="pln"> value</span><span class="pun">.</span><span class="pln">toLowerCase</span><span class="pun">().</span><span class="pln">split</span><span class="pun">(</span><span class="str">‘’</span><span class="pun">);</span></li><br><li class="L0"><span class="com">// 验证地区</span></li><br><li class="L1"><span class="kwd">var</span><span class="pln"> aCity </span><span class="pun">=</span> <span class="pun">{</span></li><br><li class="L2"><span class="lit">11</span><span class="pun">:</span> <span class="str">‘北京’</span><span class="pun">,</span></li><br><li class="L3"><span class="lit">12</span><span class="pun">:</span> <span class="str">‘天津’</span><span class="pun">,</span></li><br><li class="L4"><span class="lit">13</span><span class="pun">:</span> <span class="str">‘河北’</span><span class="pun">,</span></li><br><li class="L5"><span class="lit">14</span><span class="pun">:</span> <span class="str">‘山西’</span><span class="pun">,</span></li><br><li class="L6"><span class="lit">15</span><span class="pun">:</span> <span class="str">‘内蒙古’</span><span class="pun">,</span></li><br><li class="L7"><span class="lit">21</span><span class="pun">:</span> <span class="str">‘辽宁’</span><span class="pun">,</span></li><br><li class="L8"><span class="lit">22</span><span class="pun">:</span> <span class="str">‘吉林’</span><span class="pun">,</span></li><br><li class="L9"><span class="lit">23</span><span class="pun">:</span> <span class="str">‘黑龙江’</span><span class="pun">,</span></li><br><li class="L0"><span class="lit">31</span><span class="pun">:</span> <span class="str">‘上海’</span><span class="pun">,</span></li><br><li class="L1"><span class="lit">32</span><span class="pun">:</span> <span class="str">‘江苏’</span><span class="pun">,</span></li><br><li class="L2"><span class="lit">33</span><span class="pun">:</span> <span class="str">‘浙江’</span><span class="pun">,</span></li><br><li class="L3"><span class="lit">34</span><span class="pun">:</span> <span class="str">‘安徽’</span><span class="pun">,</span></li><br><li class="L4"><span class="lit">35</span><span class="pun">:</span> <span class="str">‘福建’</span><span class="pun">,</span></li><br><li class="L5"><span class="lit">36</span><span class="pun">:</span> <span class="str">‘江西’</span><span class="pun">,</span></li><br><li class="L6"><span class="lit">37</span><span class="pun">:</span> <span class="str">‘山东’</span><span class="pun">,</span></li><br><li class="L7"><span class="lit">41</span><span class="pun">:</span> <span class="str">‘河南’</span><span class="pun">,</span></li><br><li class="L8"><span class="lit">42</span><span class="pun">:</span> <span class="str">‘湖北’</span><span class="pun">,</span></li><br><li class="L9"><span class="lit">43</span><span class="pun">:</span> <span class="str">‘湖南’</span><span class="pun">,</span></li><br><li class="L0"><span class="lit">44</span><span class="pun">:</span> <span class="str">‘广东’</span><span class="pun">,</span></li><br><li class="L1"><span class="lit">45</span><span class="pun">:</span> <span class="str">‘广西’</span><span class="pun">,</span></li><br><li class="L2"><span class="lit">46</span><span class="pun">:</span> <span class="str">‘海南’</span><span class="pun">,</span></li><br><li class="L3"><span class="lit">50</span><span class="pun">:</span> <span class="str">‘重庆’</span><span class="pun">,</span></li><br><li class="L4"><span class="lit">51</span><span class="pun">:</span> <span class="str">‘四川’</span><span class="pun">,</span></li><br><li class="L5"><span class="lit">52</span><span class="pun">:</span> <span class="str">‘贵州’</span><span class="pun">,</span></li><br><li class="L6"><span class="lit">53</span><span class="pun">:</span> <span class="str">‘云南’</span><span class="pun">,</span></li><br><li class="L7"><span class="lit">54</span><span class="pun">:</span> <span class="str">‘西藏’</span><span class="pun">,</span></li><br><li class="L8"><span class="lit">61</span><span class="pun">:</span> <span class="str">‘陕西’</span><span class="pun">,</span></li><br><li class="L9"><span class="lit">62</span><span class="pun">:</span> <span class="str">‘甘肃’</span><span class="pun">,</span></li><br><li class="L0"><span class="lit">63</span><span class="pun">:</span> <span class="str">‘青海’</span><span class="pun">,</span></li><br><li class="L1"><span class="lit">64</span><span class="pun">:</span> <span class="str">‘宁夏’</span><span class="pun">,</span></li><br><li class="L2"><span class="lit">65</span><span class="pun">:</span> <span class="str">‘新疆’</span><span class="pun">,</span></li><br><li class="L3"><span class="lit">71</span><span class="pun">:</span> <span class="str">‘台湾’</span><span class="pun">,</span></li><br><li class="L4"><span class="lit">81</span><span class="pun">:</span> <span class="str">‘香港’</span><span class="pun">,</span></li><br><li class="L5"><span class="lit">82</span><span class="pun">:</span> <span class="str">‘澳门’</span><span class="pun">,</span></li><br><li class="L6"><span class="lit">91</span><span class="pun">:</span> <span class="str">‘国外’</span></li><br><li class="L7"><span class="pun">};</span></li><br><li class="L8"><span class="kwd">if</span> <span class="pun">(!</span><span class="pln">aCity</span><span class="pun">[</span><span class="pln">numbers</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span> <span class="pun">+</span><span class="pln"> numbers</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]])</span> <span class="pun">{</span></li><br><li class="L9"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘身份证格式有误，请检查后重新输入！’</span><span class="pun">);</span></li><br><li class="L0"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L1"><span class="pun">}</span></li><br><li class="L2"><span class="kwd">var</span><span class="pln"> wi </span><span class="pun">=</span> <span class="pun">[</span><span class="lit">7</span><span class="pun">,</span> <span class="lit">9</span><span class="pun">,</span> <span class="lit">10</span><span class="pun">,</span> <span class="lit">5</span><span class="pun">,</span> <span class="lit">8</span><span class="pun">,</span> <span class="lit">4</span><span class="pun">,</span> <span class="lit">2</span><span class="pun">,</span> <span class="lit">1</span><span class="pun">,</span> <span class="lit">6</span><span class="pun">,</span> <span class="lit">3</span><span class="pun">,</span> <span class="lit">7</span><span class="pun">,</span> <span class="lit">9</span><span class="pun">,</span> <span class="lit">10</span><span class="pun">,</span> <span class="lit">5</span><span class="pun">,</span> <span class="lit">8</span><span class="pun">,</span> <span class="lit">4</span><span class="pun">,</span> <span class="lit">2</span><span class="pun">];</span></li><br><li class="L3"><span class="kwd">var</span><span class="pln"> check </span><span class="pun">=</span> <span class="pun">[</span><span class="str">‘1’</span><span class="pun">,</span> <span class="str">‘0’</span><span class="pun">,</span> <span class="str">‘x’</span><span class="pun">,</span> <span class="str">‘9’</span><span class="pun">,</span> <span class="str">‘8’</span><span class="pun">,</span> <span class="str">‘7’</span><span class="pun">,</span> <span class="str">‘6’</span><span class="pun">,</span> <span class="str">‘5’</span><span class="pun">,</span> <span class="str">‘4’</span><span class="pun">,</span> <span class="str">‘3’</span><span class="pun">,</span> <span class="str">‘2’</span><span class="pun">];</span></li><br><li class="L4"><span class="kwd">var</span><span class="pln"> _sum </span><span class="pun">=</span> <span class="lit">0</span><span class="pun">;</span></li><br><li class="L5"><span class="kwd">for</span> <span class="pun">(</span><span class="kwd">var</span><span class="pln"> i </span><span class="pun">=</span> <span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span> <span class="lit">17</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span> <span class="pun">{</span></li><br><li class="L6"><span class="pln"> _sum </span><span class="pun">+=</span> <span class="pun">+</span><span class="pln">numbers</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span> <span class="pun"><em></em></span> <span class="pun">+</span><span class="pln">wi</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span></li><br><li class="L7"><span class="pun">}</span></li><br><li class="L8"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">numbers</span><span class="pun">[</span><span class="lit">17</span><span class="pun">]</span> <span class="pun">!=</span><span class="pln"> check</span><span class="pun">[</span><span class="pln">_sum </span><span class="pun">%</span> <span class="lit">11</span><span class="pun">])</span> <span class="pun">{</span></li><br><li class="L9"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘身份证格式有误，请检查后重新输入！’</span><span class="pun">);</span></li><br><li class="L0"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L1"><span class="pun">}</span></li><br><li class="L2"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L3"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L4"><span class="pun">}</span></li><br><li class="L5"><span class="kwd">else</span> <span class="pun">{</span></li><br><li class="L6"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘请输入18位身份证！’</span><span class="pun">);</span></li><br><li class="L7"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L8"><span class="pun">}</span></li><br><li class="L9"><span class="pun">},</span></li><br><li class="L0"><span class="str">‘taibaozheng’</span><span class="pun">:</span> <span class="kwd">function</span> <span class="pun">(</span><span class="pln">condition</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L1"><span class="kwd">var</span><span class="pln"> value </span><span class="pun">=</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">();</span></li><br><li class="L2"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">value </span><span class="pun">===</span> <span class="str">‘’</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L3"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L4"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L5"><span class="pun">}</span></li><br><li class="L6"><span class="kwd">if</span> <span class="pun">(!</span><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="pln">taibaozheng</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">value</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L7"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘台胞证格式有误，请检查后重新输入！’</span><span class="pun">);</span></li><br><li class="L8"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L9"><span class="pun">}</span></li><br><li class="L0"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L1"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L2"><span class="pun">},</span></li><br><li class="L3"><span class="str">‘zhizhao’</span><span class="pun">:</span> <span class="kwd">function</span> <span class="pun">(</span><span class="pln">condition</span><span class="pun">,</span><span class="pln"> success</span><span class="pun">,</span><span class="pln"> fail</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L4"><span class="kwd">var</span><span class="pln"> value </span><span class="pun">=</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">val</span><span class="pun">();</span></li><br><li class="L5"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">value </span><span class="pun">===</span> <span class="str">‘’</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L6"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L7"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L8"><span class="pun">}</span></li><br><li class="L9"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constants</span><span class="pun">.</span><span class="pln">zhizhao</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">value</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L0"><span class="kwd">var</span><span class="pln"> p </span><span class="pun">=</span> <span class="lit">10</span><span class="pun">;</span></li><br><li class="L1"><span class="kwd">var</span><span class="pln"> s</span><span class="pun">;</span></li><br><li class="L2"><span class="kwd">var</span><span class="pln"> a</span><span class="pun">;</span></li><br><li class="L3"><span class="kwd">var</span><span class="pln"> numbers </span><span class="pun">=</span><span class="pln"> value</span><span class="pun">.</span><span class="pln">split</span><span class="pun">(</span><span class="str">‘’</span><span class="pun">);</span></li><br><li class="L4"><span class="kwd">for</span> <span class="pun">(</span><span class="kwd">var</span><span class="pln"> i </span><span class="pun">=</span> <span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span> <span class="lit">15</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span> <span class="pun">{</span></li><br><li class="L5"><span class="pln"> a </span><span class="pun">=</span> <span class="pun">+</span><span class="pln">numbers</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span></li><br><li class="L6"><span class="pln"> s </span><span class="pun">=</span> <span class="pun">(</span><span class="pln">p </span><span class="pun">%</span> <span class="lit">11</span><span class="pun">)</span> <span class="pun">+</span><span class="pln"> a</span><span class="pun">;</span></li><br><li class="L7"><span class="pln"> p </span><span class="pun">=</span> <span class="pun">(</span><span class="pln">s </span><span class="pun">%</span> <span class="lit">10</span><span class="pun">)</span> <span class="pun"></span> <span class="lit">2</span><span class="pun">;</span></li><br><li class="L8"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">p </span><span class="pun">===</span> <span class="lit">0</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L9"><span class="pln"> p </span><span class="pun">=</span> <span class="lit">20</span><span class="pun">;</span></li><br><li class="L0"><span class="pun">}</span></li><br><li class="L1"><span class="pun">}</span></li><br><li class="L2"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">s </span><span class="pun">%</span> <span class="lit">10</span> <span class="pun">!==</span> <span class="lit">1</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L3"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘工商营业执照输入有误，请检查后重新输入！’</span><span class="pun">);</span></li><br><li class="L4"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L5"><span class="pun">}</span></li><br><li class="L6"><span class="pln"> success</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L7"><span class="kwd">return</span> <span class="kwd">true</span><span class="pun">;</span></li><br><li class="L8"><span class="pun">}</span></li><br><li class="L9"><span class="kwd">else</span> <span class="pun">{</span></li><br><li class="L0"><span class="pln"> fail</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘请输入15位工商营业执照！’</span><span class="pun">);</span></li><br><li class="L1"><span class="kwd">return</span> <span class="kwd">false</span><span class="pun">;</span></li><br><li class="L2"><span class="pun">}</span></li><br><li class="L3"><span class="pun">}</span></li><br><li class="L4"><span class="pun">};</span></li><br></ol><br></div><br><div class="jspVerticalBar"></div><br><div class="jspHorizontalBar"></div><br></div><br><p>&nbsp;</p><br><p>&nbsp;</p><br><h2>添加验证规则</h2><br><p>说好的支持自定义验证规则呢？放心，不会少的，而且超简单：</p><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="pln">$</span><span class="pun">.</span><span class="pln">validation </span><span class="pun">=</span> <span class="kwd">function</span> <span class="pun">(</span><span class="pln">condition</span><span class="pun">,</span><span class="pln"> process</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L1"><span class="pln"> $</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">strategy</span><span class="pun">[</span><span class="pln">condition</span><span class="pun">]</span> <span class="pun">=</span><span class="pln"> process</span><span class="pun">;</span></li><br><li class="L2"><span class="pun">};</span></li><br></ol><br></div><br></div><br><p>&nbsp;</p><br><p>加个静态方法搞定。</p><br><h2>手动发起验证</h2><br><p>有些场景下需要手动check一下表单内容才放心吧：</p><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="pln">$</span><span class="pun">.</span><span class="pln">fn</span><span class="pun">.</span><span class="kwd">exec</span> <span class="pun">=</span> <span class="kwd">function</span> <span class="pun">()</span> <span class="pun">{</span></li><br><li class="L1"><span class="kwd">return</span> <span class="kwd">this</span><span class="pun">.</span><span class="pln">each</span><span class="pun">(</span><span class="kwd">function</span> <span class="pun">()</span> <span class="pun">{</span></li><br><li class="L2"><span class="kwd">var</span><span class="pln"> $this </span><span class="pun">=</span><span class="pln"> $</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></li><br><li class="L3"><span class="kwd">if</span> <span class="pun">(!</span><span class="pln">$this</span><span class="pun">.</span><span class="kwd">is</span><span class="pun">(</span><span class="str">‘:input’</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L4"><span class="pln"> $this </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="str">‘:input’</span><span class="pun">);</span></li><br><li class="L5"><span class="pun">}</span></li><br><li class="L6"><span class="pln"> $this</span><span class="pun">.</span><span class="pln">blur</span><span class="pun">();</span></li><br><li class="L7"><span class="pun">});</span></li><br><li class="L8"><span class="pun">};</span></li><br></ol><br></div><br></div><br><p>&nbsp;</p><br><p>原理很简单，对:input子元素触发一次blur事件。</p><br><h2>还有一些是我没有做的</h2><br><p>都不是很复杂，因为我的业务场景不关注这些，所以就懒过去了。</p><br><ol><br><li>没做通用的ajax验证<br><br>现在对于ajax的验证，可以这样做：<p></p><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="pln">$</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">(</span><span class="str">‘ajax_xx’</span><span class="pun">,</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">c</span><span class="pun">,</span><span class="pln"> s</span><span class="pun">,</span><span class="pln"> f</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L1"><span class="pln"> $</span><span class="pun">.</span><span class="pln">post</span><span class="pun">(</span><span class="str">‘some_url’</span><span class="pun">,</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">data</span><span class="pun">){</span></li><br><li class="L2"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">data</span><span class="pun">.</span><span class="pln">success</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L3"><span class="pln"> s</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">();</span></li><br><li class="L4"><span class="pun">}</span><span class="kwd">else</span><span class="pun">{</span></li><br><li class="L5"><span class="pln"> f</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">‘xxxxxxxx’</span><span class="pun">);</span></li><br><li class="L6"><span class="pun">}</span></li><br><li class="L7"><span class="pun">});</span></li><br><li class="L8"><span class="pun">});</span></li><br></ol><br></div><br></div><br><p>&nbsp;</p><br><p>表单提交前，除了检查有没有.has-error的元素找到填写出错项，还要检查有没有.wait元素，如果有的话都不能立刻提交。<br><br>如果要有一个通用的ajax验证机制，可以自行扩展<em>$.validation</em>方法</p></li><br><li>没做验证失败时表单提交阻断<br><br>正如上一条中说的，表单提交前，需要检查.has-error和.wait元素，可以自行扩展<em>$.fn.validation</em>方法，添加form的submit事件绑定。</li><br><li>没有为handle验证状态的dom操作提供接口<br><br>不想做，bootstrap挺好的。</li><br><li>没有测试用例<br><br>不打算给这些代码添加逻辑了，不想写测试用例。</li><br></ol><br><h2>下载</h2><br><p><a href="http://zhouhua.qiniudn.com//wp-content/uploads/2015/04/validation.js" target="_blank">validation.js</a></p><br><blockquote><p>博客地址：<a href="http://www.zhouhua.info/2015/04/15/validation/" target="_blank">http://www.zhouhua.info/2015/04/15/validation/</a></p></blockquote>





      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-100ver" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/21/100ver/" class="article-date">
  	<time datetime="2015-10-21T14:57:05.755Z" itemprop="datePublished">2015-10-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/21/100ver/">分享一些不错的Javascript工具和类库</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>转自:<a href="http://www.gbtags.com/gb/share/5196.htm" target="_blank" rel="external">http://www.gbtags.com/gb/share/5196.htm</a></p><br><h2>使用reveal.js创建漂亮的演讲稿</h2><br><p>这个使用简单的框架可以帮助大家快速的创建基于JS和HTML5的演讲稿，我们需要自己定义每一个单独的页面生成完整的演讲稿，这个框架同时提供了一些幻灯页的UI和过渡效果</p><br><p><strong>相关资源</strong>:</p><br><p><a href="http://lab.hakim.se/reveal-js" target="_blank">http://lab.hakim.se/reveal-js</a></p><br><p><a href="https://github.com/hakimel/reveal.js/" target="_blank">https://github.com/hakimel/reveal.js/</a></p><br><p><a href="http://mrbool.com/how-to-create-presentations-in-the-browser-with-reveal-js/27264" target="_blank">http://mrbool.com/how-to-create-presentations-in-the-browser-with-reveal-js/27264</a></p><br><h2>ASCIIFlow</h2><br><p>这是个超棒的绘图工具，使用连续的ASCII码来生成各种图形，相信运用你的大脑可以完成各种奇思妙想<del></del></p><br><p><strong>相关资源</strong>:</p><br><p><a href="http://asciiflow.com/#Draw" target="_blank">http://asciiflow.com/#Draw</a></p><br><p><strong>Google Web Designer</strong></p><br><p>想开发应用支持很多不同的设备吗？这是个桌面程序，但是关键点是它可以帮助你生成HTML5页面，并且可以快速支持运行在不同设备上</p><br><p><strong>相关资源</strong>:</p><br><p><a href="http://www.google.com/webdesigner/" target="_blank">http://www.google.com/webdesigner/</a></p><br><p><strong>文档</strong>:</p><br><p><a href="https://support.google.com/webdesigner/#topic=3249465" target="_blank">https://support.google.com/webdesigner/#topic=3249465</a></p><br><p><strong>HTML5 jQuery Paint Plugin</strong></p><br><p>整合一个简单的绘图软件到网站里吗？ 没问题，这个jQuery插件就可以实现</p><br><p><strong>相关资源</strong>:</p><br><p><a href="http://www.websanova.com/blog/jquery/html5-jquery-paint-plugin" target="_blank">www.websanova.com/blog/jquery/html5-jquery-paint-plugin</a></p><br><p><strong>Trees in JavaScript (jQuery)</strong></p><br><p>另外一个生成Javascript树状图形的js插件 - js Tree，这个插件拥有很多特性，比如，拖拽，键盘导航，行内管理等</p><br><p>使用例子:</p><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="com">// create new jsTree</span></li><br><li class="L1"><span class="pln">$</span><span class="pun">(</span><span class="kwd">function</span> <span class="pun">()</span> <span class="pun">{</span><span class="pln"> $</span><span class="pun">(</span><span class="str">‘#jstree_demo_div’</span><span class="pun">).</span><span class="pln">jstree</span><span class="pun">();</span> <span class="pun">});</span></li><br><li class="L2"></li><br><li class="L3"><span class="com">// listener</span></li><br><li class="L4"><span class="pln">$</span><span class="pun">(</span><span class="str">‘#jstree_demo_div’</span><span class="pun">).</span><span class="pln">on</span><span class="pun">(</span><span class="str">“changed.jstree”</span><span class="pun">,</span> <span class="kwd">function</span> <span class="pun">(</span><span class="pln">e</span><span class="pun">,</span><span class="pln"> data</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L5"><span class="pln"> console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">data</span><span class="pun">.</span><span class="pln">selected</span><span class="pun">);</span></li><br><li class="L6"><span class="pun">});</span></li><br></ol><br></div><br><div class="jspVerticalBar"></div><br></div><br><p><strong>相关资源</strong>:</p><br><p><a href="http://www.jstree.com/" target="_blank">http://www.jstree.com/</a></p><br><p><a href="http://www.abeautifulsite.net/jquery-file-tree/" target="_blank">http://www.abeautifulsite.net/jquery-file-tree/</a></p><br><p>以上就是今天推荐的一些js类库和工具，希望大家能够喜欢，如果有你自己发现的新JS工具和类库，请一定和我们分享`~~</p>





      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-108ver" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/21/108ver/" class="article-date">
  	<time datetime="2015-10-21T14:57:05.755Z" itemprop="datePublished">2015-10-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/21/108ver/">谈谈正则表达式中的“.”</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p></p><p>转自<a href="http://www.gbtags.com/gb/share/5191.htm" target="_blank" rel="external">http://www.gbtags.com/gb/share/5191.htm</a></p><p></p>
<p></p><p>好久没更新内容了，今天分享一个小的知识点，一个正则表达式方面的很容易被人忽视的坑。</p><p></p>
<p></p><p>我们知道，正则表达式中，可以用 . 表示任意单个字符，但在underscore和jquery的源代码中，我们可以看到，这些著名类库的代码中，经常并不是用 . 来表示任意字符，而是使用 [\w\W] 或者[\s\S] 。乍一看，好像表达的含义是一样的，可是为什么放着简单的方法不用，而去多绕个圈子？今天就简单说说这个问题。</p><p></p>
<p></p><p>首先我们必须要正确理解 . 的含义。其实说它表示任意单个字符，可能会让人产生误解，必须要强调一下，这个“任意单个字符”不包括控制换行的字符，也就是不包含 \n \r \u2028 或\u2029 这几个字符。而 \W 和 \s 中是能够包含这些字符的。那个这两种写法的差异也就很清晰了，就是能否匹配到几个换行控制符的差异。</p><p></p>
<p></p><p>那么在什么时候我们需要考虑这几个换行控制符呢？当要处理的字符串可能包含换行时。这样的情景太多了，处理html字符串、处理template、nodejs读取文本等等。</p><p></p>
<p></p><p>提及多行文本的场景，我们很容易想到正则表达式的 m 模式（多行模式）。那么多行模式对我们今天讨论的问题有影响吗？我不是很确定。为什么不确定呢？有些人信誓旦旦地声称单行模式下 . 的含义与多行模式下不同，单选模式下等同于 [\w\W] 或者 [\s\S] ，而多行模式下会排除换行控制符。但据我试验，以及参考MDN的说法，这是不对的。的确有很多语言的正则表达式会有上述特性，但在javascript中我没有看到，不知道会不会有浏览器方面的差异。那么多行模式对于javascript而言影响的是什么呢？我认为仅仅是改变了 ^ 和 $ 标识的含义：单行模式下，分别表示整个字符串的开始的结尾；多行模式下表示每一行的开始和结尾。而不管多行模式还是单行模式，我认为 . 都是不包含换行控制字符的，等价于 [^\n\r\u2028\u2029] 。</p><p></p>
<p></p><p>再多延伸一点点，对于<strong>现代浏览器</strong>，可以直接用 [^] 来匹配任意字符的。</p><p></p>
<p></p><p>例子程序不想写了，有兴趣的可以自己试验一下，分别用 /.<em>/g 、 /^.</em>$/g 、 /.<em>/gm 、/^.</em>$/gm 来匹配一下 “abc\nedf” ，其中道理不言自明。</p><p></p>
<blockquote><p>博客地址：<a href="http://www.zhouhua.info/2015/05/07/dot/" target="_blank">http://www.zhouhua.info/2015/05/07/dot/</a></p></blockquote>





      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-109ver" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/21/109ver/" class="article-date">
  	<time datetime="2015-10-21T14:57:05.755Z" itemprop="datePublished">2015-10-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/21/109ver/">写个CSS3缓动页面切换效果</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&nbsp;</p><br><blockquote><p>demo:<a href="http://www.old.com/demo/CSS%E7%BC%93%E5%8A%A8/" target="_blank" rel="external">点击演示</a></p><br><p>代码下载: <a href="http://pan.baidu.com/s/1pJoQhCn" target="_blank" rel="external">http://pan.baidu.com/s/1pJoQhCn</a></p></blockquote><br><p>&nbsp;</p><br><blockquote><br><h3><span style="color: #333333;"><strong>分析</strong></span></h3><br><p>因为是用纯CSS3写的.并且代码量比较多这里只简单分析一下原理</p><br><p>首先导航用的是input的check属性来实现的.. 另外用到了CSS选择器”+”与”~”</p><br><p>动画效果利用的是transition和transiform</p><br><p>通过点击导航来更改.content的Y定位实现切换</p><br><p>标题和菜单动画则通过自定义动画来实现</p></blockquote><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p>





      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-110ver" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/21/110ver/" class="article-date">
  	<time datetime="2015-10-21T14:57:05.755Z" itemprop="datePublished">2015-10-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/21/110ver/">JavaScript另一种创建实例的方式:返回原型方法</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&nbsp;</p><br><p>最近在看jquery源码分析..初看了一下发现果然是大神级别的框架,尔等渣渣完全看不懂.</p><br><p>不过根据视频结合来看还是能够学到一点什么的.</p><br><p>至少学到了今天的主题”JavaScript另一种创建实例的方式:返回原型方法”</p><br><p>&nbsp;</p><br><blockquote><br><h2><span style="color: #333333;"><strong>代码</strong></span></h2><br><pre class="lang:default decode:true">function Map(){<br>        return new Map.prototype.init()<br>    }<br><br>    var soul=Map.prototype={<br>        constructor:Map,<br>        ver:”1.2.3”,<br>        valueMap:{}<br>    }<br>    Map.prototype.init=function(){<br><br>    }<br>      Map.prototype.hi=function(){alert(“hello”)}<br>     Map.prototype.init.prototype=Map.prototype;<br>//Map实例是Map.init<br>    //init的原型是Map.prototype<br>    //下面调用Map()方法都是在调用Map.init.prototype=Map.prototype 也就是Map.prototype<br>    //看成Map.prototype就行了.<br>Map().hi()//hello</pre><br></blockquote><br><p>&nbsp;</p><br><blockquote><br><h3><span style="color: #333333;"><strong>分析</strong></span></h3><br><p>首先构造一个函数为 Map返回一个new xxx() 一般我们构造实例都是 var xxx=new xxx() 而这里直接在函数内部就构造好了</p><br><p>返回的是一个构造函数</p><br><p>也就是 Map.prototype.init 如果返回是他构造的话 那么原来Map.prototype上的方法和属性不是都访问不到了嘛？于是巧妙地用了这样一句话</p><br><p>Map.prototype.init.prototype=Map.prototype;</p><br><p>可以理解为init构造函数继承了Map.prototype上的方法和属性</p><br><p>接下来的就应该不用再说了吧</p><br><p>&nbsp;</p></blockquote><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p>





      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-111ver" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/21/111ver/" class="article-date">
  	<time datetime="2015-10-21T14:57:05.755Z" itemprop="datePublished">2015-10-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/21/111ver/">javascript实现各种字符串搜索算法</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p></p><p>转自<a href="http://www.gbtags.com/gb/share/4430.htm" target="_blank" rel="external">http://www.gbtags.com/gb/share/4430.htm</a></p><p></p>
<p></p><p>我觉得在前端开发中过多地考虑算法没有太多实际的意义。但这仅仅是我觉得，我并没有证据证明这一点。那为何不来尝试一下，面对一个特定的任务，我将使用不同的算法来实现，看看究竟效率相差多少。今天我想通过字符串搜索这一场景来进行测试。</p><p></p>
<p></p><p>&nbsp;</p><p></p>
<p></p><h2>测试场景</h2><p></p>
<p><ol></ol></p>
<p><li>主字符串就以ABC的一篇文章内容为例，略做修改<br></li></p>
<blockquote><p>There are some times when clicking “like” on a friend’s Facebook status doesn’t feel appropriate. A bad day. A loved one lost. A break up. It only seems natural that a “dislike” button could solve the conundrum of wanting to empathize but not seem inappropriate by clicking “like.” Mark Zuckerberg Puts the Rest of Us to Shame by Speaking Fluent Chinese. Mark Zuckerberg: Facebook Founder and Animal Butcher. Mark Zuckerberg and That Shirt. The idea has been on Mark Zuckerberg’s radar for a while, he said. In 2010, he told ABC News’ Diane Sawyer that that Facebook would “definitely think about” adding a dislike button. “People definitely seem to want it,” Zuckerberg said. Four years later — Zuckerberg says Facebook is still “thinking about” adding the oft-requested button, Zuckerberg says Facebook is still “thinking about” adding the oft-requested button. At a town hall meeting on Thursday, the CEO revealed he has some reservations about the feature. “There are two things that it can mean,” Zuckerberg said of the potential button, which could be used in a mean spirited way or to express empathy. Finding how to limit it to the latter is the challenge. Zuckerberg said he doesn’t want the button to turn into a “voting mechanism” or something that isn’t “socially valuable.” “Often people will tell us they don’t feel comfortable pressing ‘like,’” Zuckerberg said. “What’s the right way to make it so people can easier express a wide range of emotions?” One suggestion percolating online: Roll out the feature under a different name. However, an “empathy button” just may not have the same ring to it as “dislike.”</p></blockquote><br><br><li>模式字符串<br><ul><br><li>靠近起点 friend</li><br><li>靠近终点 button”</li><br><li>靠近中间 Zuckerberg says Facebook is still “thinking about” adding the oft-requested button.</li><br></ul><br></li><br><br><h3>暴力算法</h3><br><p>首先是最原始的做法，主串左侧开始，逐个对比，如果不相同，则主串起始点向后移一位，重复，直到找到。</p><br><p>第一次尝试 G C A T C G C A G A G A G T A T A C A G T A C G 1 2 3 4   G C A G A G A G   第二次尝试 G C A T C G C A G A G A G T A T A C A G T A C G   1     G C A G A G A G   第三次尝试 G C A T C G C A G A G A G T A T A C A G T A C G   1     G C A G A G A G   第四次尝试 G C A T C G C A G A G A G T A T A C A G T A C G   1     G C A G A G A G   第五次尝试 G C A T C G C A G A G A G T A T A C A G T A C G   1     G C A G A G A G   Sixth attempt G C A T C G C A G A G A G T A T A C A G T A C G   1 2 3 4 5 6 7 8     G C A G A G A G</p><br><p>以上示例（<a href="http://www.zhouhua.info/jump/0dcj" target="_blank">http://igm.univ-mlv.fr/~lecroq/string/examples/exp3.html</a>）说明了一次暴力搜索的过程。</p><br><p>我用JS模拟了这个算法：</p><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="kwd">var</span><span class="pln"> mainString</span><span class="pun">=</span><span class="str">“”</span><span class="pun">;</span></li><br><li class="L1"><span class="kwd">var</span><span class="pln"> searchString</span><span class="pun">=</span><span class="str">“”</span></li><br><li class="L2"><span class="kwd">function</span><span class="pln"> basicSearch</span><span class="pun">(</span><span class="pln">mainStr</span><span class="pun">,</span><span class="pln"> str</span><span class="pun">,</span><span class="pln"> offset</span><span class="pun">){</span></li><br><li class="L3"><span class="kwd">var</span><span class="pln"> mainLength</span><span class="pun">=</span><span class="pln">mainStr</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></li><br><li class="L4"><span class="kwd">var</span><span class="pln"> searchLength</span><span class="pun">=</span><span class="pln">str</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></li><br><li class="L5"><span class="kwd">if</span><span class="pun">(</span><span class="pln">searchLength</span><span class="pun">&gt;</span><span class="pln">mainLength</span><span class="pun">-</span><span class="pln">offset</span><span class="pun">){</span></li><br><li class="L6"><span class="kwd">return</span> <span class="pun">-</span><span class="lit">1</span><span class="pun">;</span></li><br><li class="L7"><span class="pun">}</span></li><br><li class="L8"><span class="pln"> offset</span><span class="pun">=</span><span class="pln">offset</span><span class="pun">||</span><span class="lit">0</span><span class="pun">;</span></li><br><li class="L9"><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">searchlength</span><span class="pun">&gt;</span><span class="pln">i </span><span class="pun">;</span><span class="pln">i</span><span class="pun">++){</span></li><br><li class="L0"><span class="kwd">if</span><span class="pun">(</span><span class="pln">str</span><span class="pun">.</span><span class="pln">charAt</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)!==</span><span class="pln">mainString</span><span class="pun">.</span><span class="pln">charAt</span><span class="pun">(</span><span class="pln">offset</span><span class="pun">+</span><span class="pln">i</span><span class="pun">)){</span></li><br><li class="L1"><span class="kwd">return</span><span class="pln"> basicSearch</span><span class="pun">(</span><span class="pln">mainStr</span><span class="pun">,</span><span class="pln"> str</span><span class="pun">,</span><span class="pln"> offset</span><span class="pun">+</span><span class="lit">1</span><span class="pun">)</span></li><br><li class="L2"><span class="pun">}</span></li><br><li class="L3"><span class="pun">}</span></li><br><li class="L4"><span class="kwd">return</span><span class="pln"> offset</span><span class="pun">;</span></li><br><li class="L5"><span class="pun">}</span></li><br><li class="L6"><span class="pln">basicSearch</span><span class="pun">(</span><span class="pln">mainString</span><span class="pun">,</span><span class="pln"> searchString</span><span class="pun">);</span></li><br></ol><br></div><br><div class="jspVerticalBar"></div><br></div><br><p>非递归版：</p><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="kwd">function</span><span class="pln"> basicSearchLoop</span><span class="pun">(</span><span class="pln">mainStr</span><span class="pun">,</span><span class="pln"> str</span><span class="pun">){</span></li><br><li class="L1"><span class="kwd">var</span><span class="pln"> mainLength</span><span class="pun">=</span><span class="pln">mainStr</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></li><br><li class="L2"><span class="kwd">var</span><span class="pln"> searchLength</span><span class="pun">=</span><span class="pln">str</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></li><br><li class="L3"><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> offset</span><span class="pun">=</span> <span class="lit">0</span><span class="pun">,</span><span class="pln">padding</span><span class="pun">=</span><span class="pln">mainLength</span><span class="pun">-</span><span class="pln">searchLength</span><span class="pun">;</span><span class="pln">offset</span><span class="pun">&lt;</span> <span class="pun">=</span><span class="pln">padding</span><span class="pun">;</span><span class="pln">offset</span><span class="pun">++)</span> <span class="pun">{</span></li><br><li class="L4"><span class="kwd">var</span><span class="pln"> match</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">;</span></li><br><li class="L5"><span class="kwd">for</span> <span class="pun">(</span><span class="kwd">var</span><span class="pln"> i </span><span class="pun">=</span> <span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> searchLength</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span> <span class="pun">{</span></li><br><li class="L6"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">str</span><span class="pun">.</span><span class="pln">charAt</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)</span> <span class="pun">!==</span><span class="pln"> mainString</span><span class="pun">.</span><span class="pln">charAt</span><span class="pun">(</span><span class="pln">offset </span><span class="pun">+</span><span class="pln"> i</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L7"><span class="pln"> match</span><span class="pun">=</span><span class="kwd">false</span><span class="pun">;</span></li><br><li class="L8"><span class="kwd">break</span><span class="pun">;</span></li><br><li class="L9"><span class="pun">}</span></li><br><li class="L0"><span class="pun">}</span></li><br><li class="L1"><span class="kwd">if</span><span class="pun">(</span><span class="pln">match</span><span class="pun">)</span><span class="kwd">return</span><span class="pln"> offset</span><span class="pun">;</span></li><br><li class="L2"><span class="pun">}</span></li><br><li class="L3"><span class="kwd">return</span> <span class="pun">-</span><span class="lit">1</span><span class="pun">;</span></li><br><li class="L4"><span class="pun">}</span></li><br></ol><br></div><br><div class="jspVerticalBar"></div><br></div><br><p>&nbsp;</p><br><h2>KMP算法（Knuth-Morris-Pratt算法）</h2><br><p>KMP算是字符串搜索算法里的明星。不过本文重点不是介绍算法历史，有兴趣的可以移步百度百科（<a href="http://www.zhouhua.info/jump/yqnx" target="_blank">KMP算法</a>）。这里一样先看一个例子：</p><br><p>第一次尝试 G C A T C G C A G A G A G T A T A C A G T A C G 1 2 3 4   G C A G A G A G</p><br><p>移动步数: 4 (<em>i</em>-<em>kmpNext</em>[<em>i</em>]=3- -1)</p><br><p>第二次尝试 G C A T C G C A G A G A G T A T A C A G T A C G   1     G C A G A G A G</p><br><p>移动步数: 1 (<em>i</em>-<em>kmpNext</em>[<em>i</em>]=0- -1)</p><br><p>第三次尝试 G C A T C G C A G A G A G T A T A C A G T A C G   1 2 3 4 5 6 7 8     G C A G A G A G</p><br><p>移动步数: 7 (<em>i</em>-<em>kmpNext</em>[<em>i</em>]=8-1)</p><br><p>如果每次发生不一致都要计算一次效率太低，可以考虑将计算结果缓存到一张<strong>部分匹配表</strong>中（也可以在搜索之前先生成此表）。以intristed为例：移动步数: 1 (<em>i</em>-<em>kmpNext</em>[<em>i</em>]=0- -1)</p><br><p><a href="http://www.zhouhua.info/jump/b5bz" target="_blank">原始示例出处</a>。我们看到，这里有一个 kmpNext 数组，这是什么呢？我们慢慢来理解。每一次尝试匹配时，从模式字符串的左端开始对比，如果第i个字符相同，则比较第i+1个；如果不相同，则需要把模式字符串向右移动。移动的位数是算法优劣的关键。每次移动一位是暴力算法的做法。kmp算法有自己独特的移动步数计算方法。</p><br><p>首先引入两个概念：<strong>前缀</strong>和<strong>后缀</strong>。</p><br><ul><br><li>前缀：一个字符串所有头部的集合，不包含自身；</li><br><li>后缀：一个字符串所有尾部的集合，不包含自身。</li><br></ul><br><p>我们看下面的例子（编号从1开始编）：</p><br><p>i n t r i s t i n g 1 2 3 4 5 6 7 8 9   i n t r i s t e d</p><br><p>在模式串8的位置发生了不匹配，那么要计算模式串右移的位数之前，我们先写出位置1~7处的子串intrist的前缀和后缀：</p><br><ul><br><li>前缀：i, in, int, intr, intri, intris, intrist</li><br><li>后缀：t, st, ist, rist, trist, ntrist, intrist</li><br></ul><br><p>我们再定义一个<strong>部分匹配值</strong>的概念：前缀和后缀交集中，长度最长的元素的长度。很显然，这里前缀和后缀没有交集，最长共同元素的长度也就认为是0，那么模式串向右移动（8-0=）8个字符。跟上面的算法（上面是7-(-1)）稍有不同，不过大体意思一样，计算结果也一样。</p><br><p>部分匹配表 模式字符串 i n t r i s t e d 序号 1 2 3 4 5 6 7 8 9 部分匹配值 0 0 0 0 1 0 0 0 0</p><br><p>计算右移位数就可以很容易地从表中计算出来：</p><br><blockquote><p>移动位数=已匹配的位数-已匹配部分的部分匹配值</p></blockquote><br><p>例如在第6个位置s处发现不匹配，那么需要右移5-1=4位。</p><br><p>但这样计算其实并不方便，比如已匹配位数为0的情况很难处理，所以我们可以对部分匹配值做一个修正，每个值减去1，公式也相应调整为：</p><br><blockquote><p>移动位数=不匹配字符的位置-已匹配部分的修正部分匹配值</p></blockquote><br><p>这样这个公式就与上面示例中的公式相同了。</p><br><p>我用JS模拟了这个算法：</p><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="kwd">function</span> <span class="typ">KMPSearch</span><span class="pun">(</span><span class="pln">mainLength</span><span class="pun">,</span><span class="pln">str</span><span class="pun">,</span><span class="pln">offset</span><span class="pun">,</span><span class="kwd">group</span><span class="pun">){</span></li><br><li class="L1"><span class="kwd">var</span><span class="pln"> mainLength</span><span class="pun">=</span><span class="pln">mainString</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></li><br><li class="L2"><span class="kwd">var</span><span class="pln"> searchLength</span><span class="pun">=</span><span class="pln">str</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></li><br><li class="L3"><span class="kwd">if</span><span class="pun">(</span><span class="pln">searchLength</span><span class="pun">&gt;</span><span class="pln">mainLength</span><span class="pun">-</span><span class="pln">offset</span><span class="pun">){</span></li><br><li class="L4"><span class="kwd">return</span> <span class="pun">-</span><span class="lit">1</span><span class="pun">;</span></li><br><li class="L5"><span class="pun">}</span></li><br><li class="L6"><span class="pln"> offset</span><span class="pun">=</span><span class="pln">offset</span><span class="pun">||</span><span class="lit">0</span><span class="pun">;</span></li><br><li class="L7"><span class="kwd">group</span><span class="pun">=</span><span class="kwd">group</span><span class="pun">||[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">1</span><span class="pun">];</span></li><br><li class="L8"><span class="kwd">var</span><span class="pln"> searchedString</span><span class="pun">=[];</span></li><br><li class="L9"><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">searchlength</span><span class="pun">&gt;</span><span class="pln">i </span><span class="pun">;</span><span class="pln">i</span><span class="pun">++){</span></li><br><li class="L0"><span class="kwd">var</span><span class="pln"> searchingChar</span><span class="pun">=</span><span class="pln">str</span><span class="pun">.</span><span class="pln">charAt</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span></li><br><li class="L1"><span class="kwd">if</span><span class="pun">(</span><span class="pln">searchingChar</span><span class="pun">!==</span><span class="pln">mainString</span><span class="pun">.</span><span class="pln">charAt</span><span class="pun">(</span><span class="pln">offset</span><span class="pun">+</span><span class="pln">i</span><span class="pun">)){</span></li><br><li class="L2"><span class="kwd">var</span><span class="pln"> offsetJump</span><span class="pun">;</span></li><br><li class="L3"><span class="kwd">if</span><span class="pun">(</span><span class="kwd">group</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span> <span class="pun">{</span></li><br><li class="L4"><span class="pln"> offsetJump </span><span class="pun">=</span> <span class="kwd">group</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span></li><br><li class="L5"><span class="pun">}</span><span class="kwd">else</span><span class="pun">{</span></li><br><li class="L6"><span class="pln"> offsetJump </span><span class="pun">=</span> <span class="kwd">next</span><span class="pun">(</span><span class="pln">searchedString</span><span class="pun">);</span></li><br><li class="L7"><span class="kwd">group</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]=</span><span class="pln">offsetJump</span><span class="pun">;</span></li><br><li class="L8"><span class="pun">}</span></li><br><li class="L9"><span class="kwd">return</span> <span class="typ">KPMSearch</span><span class="pun">(</span><span class="pln">mainLength</span><span class="pun">,</span><span class="pln">str</span><span class="pun">,</span><span class="pln">offset</span><span class="pun">+</span><span class="pln">offsetJump</span><span class="pun">,</span><span class="kwd">group</span><span class="pun">);</span></li><br><li class="L0"><span class="pun">}</span></li><br><li class="L1"><span class="pln"> searchedString</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">searchingChar</span><span class="pun">);</span></li><br><li class="L2"><span class="pun">}</span></li><br><li class="L3"><span class="kwd">return</span><span class="pln"> offset</span><span class="pun">;</span></li><br><li class="L4"><span class="pun">}</span></li><br><li class="L5"><span class="kwd">function</span> <span class="kwd">next</span><span class="pun">(</span><span class="pln">chars</span><span class="pun">){</span></li><br><li class="L6"><span class="kwd">var</span><span class="pln"> length</span><span class="pun">=</span><span class="pln">chars</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></li><br><li class="L7"><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i</span><span class="pun">=</span><span class="pln">length</span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&gt;</span><span class="lit">0</span><span class="pun">;</span><span class="pln">i</span><span class="pun">–){</span></li><br><li class="L8"><span class="kwd">var</span><span class="pln"> isMatch</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">;</span></li><br><li class="L9"><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> j</span><span class="pun">=</span><span class="lit">0</span> <span class="pun">;</span><span class="pln">j</span><span class="pun">&lt;</span> <span class="pun">=</span><span class="pln">i</span><span class="pun">;</span><span class="pln">j</span><span class="pun">++){</span></li><br><li class="L0"><span class="kwd">if</span><span class="pun">(</span><span class="pln">chars</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]!==</span><span class="pln">chars</span><span class="pun">[</span><span class="pln">length</span><span class="pun">-</span><span class="pln">i</span><span class="pun">+</span><span class="pln">j</span><span class="pun">]){</span></li><br><li class="L1"><span class="pln"> isMatch</span><span class="pun">=</span><span class="kwd">false</span><span class="pun">;</span></li><br><li class="L2"><span class="kwd">break</span><span class="pun">;</span></li><br><li class="L3"><span class="pun">}</span></li><br><li class="L4"><span class="pun">}</span></li><br><li class="L5"><span class="kwd">if</span><span class="pun">(</span><span class="pln">isMatch</span><span class="pun">)</span><span class="kwd">return</span><span class="pln"> length</span><span class="pun">-</span><span class="pln">i</span><span class="pun">;</span></li><br><li class="L6"><span class="pun">}</span></li><br><li class="L7"><span class="kwd">return</span><span class="pln"> length</span><span class="pun">;</span></li><br><li class="L8"><span class="pun">}</span></li><br></ol><br></div><br><div class="jspVerticalBar"></div><br></div><br><p>非递归版：</p><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="kwd">function</span> <span class="typ">KMPSearchLoop</span><span class="pun">(</span><span class="pln">mainStr</span><span class="pun">,</span><span class="pln"> str</span><span class="pun">)</span> <span class="pun">{</span></li><br><li class="L1"><span class="kwd">var</span><span class="pln"> mainLength</span><span class="pun">=</span><span class="pln">mainString</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></li><br><li class="L2"><span class="kwd">var</span><span class="pln"> searchLength </span><span class="pun">=</span><span class="pln"> str</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></li><br><li class="L3"><span class="kwd">for</span> <span class="pun">(</span><span class="kwd">var</span><span class="pln"> offset </span><span class="pun">=</span> <span class="lit">0</span><span class="pun">,</span><span class="pln"> padding </span><span class="pun">=</span><span class="pln"> mainLength </span><span class="pun">-</span><span class="pln"> searchLength</span><span class="pun">,</span> <span class="kwd">group</span> <span class="pun">=</span> <span class="pun">[</span><span class="lit">1</span><span class="pun">,</span> <span class="lit">1</span><span class="pun">];</span><span class="pln"> offset </span><span class="pun">&lt;</span> <span class="pun">=</span><span class="pln"> padding</span><span class="pun">;){</span></li><br><li class="L4"><span class="kwd">var</span><span class="pln"> searchedString </span><span class="pun">=</span> <span class="pun">[];</span></li><br><li class="L5"><span class="kwd">var</span><span class="pln"> match</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">;</span></li><br><li class="L6"><span class="kwd">var</span><span class="pln"> offsetJump</span><span class="pun">;</span></li><br><li class="L7"><span class="kwd">for</span> <span class="pun">(</span><span class="kwd">var</span><span class="pln"> i </span><span class="pun">=</span> <span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> searchLength</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span> <span class="pun">{</span></li><br><li class="L8"><span class="kwd">var</span><span class="pln"> searchingChar </span><span class="pun">=</span><span class="pln"> str</span><span class="pun">.</span><span class="pln">charAt</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span></li><br><li class="L9"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">searchingChar </span><span class="pun">!==</span><span class="pln"> mainString</span><span class="pun">.</span><span class="pln">charAt</span><span class="pun">(</span><span class="pln">offset </span><span class="pun">+</span><span class="pln"> i</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L0"><span class="pln"> match</span><span class="pun">=</span><span class="kwd">false</span><span class="pun">;</span></li><br><li class="L1"><span class="kwd">if</span> <span class="pun">(</span><span class="kwd">group</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span> <span class="pun">{</span></li><br><li class="L2"><span class="pln"> offsetJump </span><span class="pun">=</span> <span class="kwd">group</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span></li><br><li class="L3"><span class="pun">}</span></li><br><li class="L4"><span class="kwd">else</span> <span class="pun">{</span></li><br><li class="L5"><span class="pln"> offsetJump </span><span class="pun">=</span> <span class="kwd">next</span><span class="pun">(</span><span class="pln">searchedString</span><span class="pun">);</span></li><br><li class="L6"><span class="kwd">group</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span> <span class="pun">=</span><span class="pln"> offsetJump</span><span class="pun">;</span></li><br><li class="L7"><span class="pun">}</span></li><br><li class="L8"><span class="kwd">break</span><span class="pun">;</span></li><br><li class="L9"><span class="pun">}</span></li><br><li class="L0"><span class="pln"> searchedString</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">searchingChar</span><span class="pun">);</span></li><br><li class="L1"><span class="pun">}</span></li><br><li class="L2"><span class="kwd">if</span><span class="pun">(</span><span class="pln">match</span><span class="pun">){</span></li><br><li class="L3"><span class="kwd">return</span><span class="pln"> offset</span><span class="pun">;</span></li><br><li class="L4"><span class="pun">}</span><span class="kwd">else</span><span class="pun">{</span></li><br><li class="L5"><span class="pln"> offset</span><span class="pun">+=</span><span class="pln">offsetJump</span><span class="pun">;</span></li><br><li class="L6"><span class="pun">}</span></li><br><li class="L7"><span class="pun">}</span></li><br><li class="L8"><span class="kwd">return</span> <span class="pun">-</span><span class="lit">1</span><span class="pun">;</span></li><br><li class="L9"><span class="pun">}</span></li><br></ol><br></div><br><div class="jspVerticalBar"></div><br></div><br><p>&nbsp;</p><br><h2>Horspool算法</h2><br><p>Horspool算法在做匹配的时候，创造性地从右向左匹配，对后来其他算法有很深的影响。还是那句话，本文会讲很多算法上的东西，但本文重点不是算法，下面还是会过一下Horspool算法的搜索过程，如果难以理解，还是参考其他更详细的资料。依然是示例（<a href="http://www.zhouhua.info/jump/eqpj" target="_blank">http://igm.univ-mlv.fr/~lecroq/string/examples/exp18.html</a>）：</p><br><p>第一次尝试 G C A T C G C A G A G A G T A T A C A G T A C G   1   G C A G A G A G</p><br><p>移动步数: 1 (Horspool[A])</p><br><p>第二次尝试 G C A T C G C A G A G A G T A T A C A G T A C G             3 2 1     G C A G A G A G</p><br><p>移动步数: 2 (Horspool[G])</p><br><p>第三次尝试 G C A T C G C A G A G A G T A T A C A G T A C G         5 4 3 2 1     G C A G A G A G</p><br><p>移动步数: 2 (Horspool[G])</p><br><p>第四次尝试 G C A T C G C A G A G A G T A T A C A G T A C G   8 7 6 5 4 3 2 1     G C A G A G A G</p><br><p>先对齐，从模式串的右侧开始匹配，如果完全匹配则结束搜索，否则查看模式串最右边对应的主串字符是什么。找出这个字符在模式串中最后出现的位置（除最末位）距离模式串最后一个字符的距离，如果没有在模式串中出现过，则认为这个距离是模式串的长度。我们可以事先把这个距离表计算出来。</p><br><p>7 6 5 4 3 2 1   G C A G A G A G</p><br><p>⇒</p><br><p>字符 G C A *（其他） 距离 2 6 1 8（模式串的长度）</p><br><p>以上面第三次尝试为例，从右向左匹配了5次后发现匹配失败了，那么这时就看序号1处主串的字符是什么。很容易得到是‘G’，查询上表，‘G’对应的距离是2，那就很简单粗暴地把模式串向右移动两位，再次进行匹配。</p><br><p>上代码：</p><br><div class="jspContainer"><br><div class="jspPane"><br><ol class="linenums"><br><li class="L0"><span class="kwd">function</span> <span class="typ">HorspoolSearchLoop</span><span class="pun">(</span><span class="pln">mainString</span><span class="pun">,</span><span class="pln"> str</span><span class="pun">){</span></li><br><li class="L1"><span class="kwd">var</span><span class="pln"> mainLength</span><span class="pun">=</span><span class="pln">mainString</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></li><br><li class="L2"><span class="kwd">var</span><span class="pln"> searchLength </span><span class="pun">=</span><span class="pln"> str</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></li><br><li class="L3"><span class="kwd">var</span><span class="pln"> table</span><span class="pun">={};</span></li><br><li class="L4"><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> index</span><span class="pun">=</span> <span class="lit">0</span><span class="pun">,</span><span class="pln">l</span><span class="pun">=</span><span class="pln">searchLength</span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">l</span><span class="pun">&gt;</span><span class="pln">index </span><span class="pun">;</span><span class="pln">index</span><span class="pun">++){</span></li><br><li class="L5"><span class="pln"> table</span><span class="pun">[</span><span class="pln">str</span><span class="pun">.</span><span class="pln">charAt</span><span class="pun">(</span><span class="pln">index</span><span class="pun">)]=</span><span class="pln">l</span><span class="pun">-</span><span class="pln">index</span><span class="pun">;</span></li><br><li class="L6"><span class="pun">}</span></li><br><li class="L7"><span class="kwd">for</span> <span class="pun">(</span><span class="kwd">var</span><span class="pln"> offset </span><span class="pun">=</span> <span class="lit">0</span><span class="pun">,</span><span class="pln"> padding </span><span class="pun">=</span><span class="pln"> mainLength </span><span class="pun">-</span><span class="pln"> searchLength</span><span class="pun">;</span><span class="pln"> offset </span><span class="pun">&lt;</span> <span class="pun">=</span><span class="pln"> padding</span><span class="pun">;){</span></li><br><li class="L8"><span class="kwd">var</span><span class="pln"> rightChar</span><span class="pun">;</span></li><br><li class="L9"><span class="kwd">var</span><span class="pln"> match</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">;</span></li><br><li class="L0"><span class="kwd">var</span><span class="pln"> offsetJump</span><span class="pun">;</span></li><br><li class="L1"><span class="kwd">for</span> <span class="pun">(</span><span class="kwd">var</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> searchLength</span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;=</span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">–)</span> <span class="pun">{</span></li><br><li class="L2"><span class="kwd">var</span><span class="pln"> searchingChar </span><span class="pun">=</span><span class="pln"> str</span><span class="pun">.</span><span class="pln">charAt</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span></li><br><li class="L3"><span class="kwd">if</span><span class="pun">(</span><span class="pln">i</span><span class="pun">===</span><span class="pln">searchLength</span><span class="pun">-</span><span class="lit">1</span><span class="pun">){</span></li><br><li class="L4"><span class="pln"> rightChar</span><span class="pun">=</span><span class="pln">mainString</span><span class="pun">.</span><span class="pln">charAt</span><span class="pun">(</span><span class="pln">offset</span><span class="pun">+</span><span class="pln">i</span><span class="pun">);</span></li><br><li class="L5"><span class="pun">}</span></li><br><li class="L6"><span class="kwd">if</span> <span class="pun">(</span><span class="pln">searchingChar </span><span class="pun">!==</span><span class="pln"> mainString</span><span class="pun">.</span><span class="pln">charAt</span><span class="pun">(</span><span class="pln">offset </span><span class="pun">+</span><span class="pln"> i</span><span class="pun">))</span> <span class="pun">{</span></li><br><li class="L7"><span class="pln"> match</span><span class="pun">=</span><span class="kwd">false</span><span class="pun">;</span></li><br><li class="L8"><span class="pln"> offsetJump </span><span class="pun">=</span><span class="pln"> table</span><span class="pun">[</span><span class="pln">rightChar</span><span class="pun">]||</span><span class="pln">searchLength</span><span class="pun">;</span></li><br><li class="L9"><span class="kwd">break</span><span class="pun">;</span></li><br><li class="L0"><span class="pun">}</span></li><br><li class="L1"><span class="pun">}</span></li><br><li class="L2"><span class="kwd">if</span><span class="pun">(</span><span class="pln">match</span><span class="pun">){</span></li><br><li class="L3"><span class="kwd">return</span><span class="pln"> offset</span><span class="pun">;</span></li><br><li class="L4"><span class="pun">}</span><span class="kwd">else</span><span class="pun">{</span></li><br><li class="L5"><span class="pln"> offset</span><span class="pun">+=</span><span class="pln">offsetJump</span><span class="pun">;</span></li><br><li class="L6"><span class="pun">}</span></li><br><li class="L7"><span class="pun">}</span></li><br><li class="L8"><span class="kwd">return</span> <span class="pun">-</span><span class="lit">1</span><span class="pun">;</span></li><br><li class="L9"><span class="pun">}</span></li><br></ol><br></div><br></div><br><p>这次只写了非递归的版本，因为递归的版本已经没有写的必要。</p><br><h2>还是来谈javascript</h2><br><p>冲着javascript性能来看这篇文章的同学一定没有兴趣看上来的算法。我一边写一边测试，终于也不愿意再深究其他的一些算法，原本还想把Boyer-Moore算法、Sunday算法也一起讨论讨论，现在看来完全没有必要。为什么？因为javascript实现这些算法的效率实在太！慢！了！</p><br><p>回到开头我们设置的测试场景，我们分别来试验一下搜索10000次，各种算法所要耗费的时间。</p><br><p>递归版（10000次·ms） 循环版（10000次·ms） 暴力算法 87, 1862, 990 35, 1349, 661 KMP算法 106, 3405, 1770 76, 2337, 1194 Horspool算法 187, 2479, 1446 javascript原生方法 9, 101, 47</p><br><p>我想从数据上看，结论是很清晰的。javascript代码的性能确实不高，相比较于循环，递归更是慢了近1倍。javascript在分配内存，数组访问，函数调用等等方面的性能与编译型语言差距很大。如果要实现一个特定的任务，我们更多地应该考虑尽可能地使用原生代码来实现，高级的算法在javascript里似乎并没有多少实用价值。</p><br><p><iframe width="300" height="150" src="http://www.gbtags.com/gb/debugwidget/7d7627df-4296-42eb-b8c5-5da7cffd0b1b.htm"></iframe></p><br><blockquote><p>移过来好多样式丢了……</p></blockquote><br><blockquote><p>blog：<a href="http://www.zhouhua.info/2014/12/16/string/" target="_blank">http://www.zhouhua.info/2014/12/16/string/</a></p></blockquote>





      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-112ver" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/21/112ver/" class="article-date">
  	<time datetime="2015-10-21T14:57:05.755Z" itemprop="datePublished">2015-10-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/21/112ver/">教你如何从bilibili下载视频并且提取视频BGM</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&nbsp;</p><br><blockquote><br><h1><span style="color: #993366;"><strong>下载bilibili视频</strong></span></h1><br><p>&nbsp;</p><br><p>The First 在bilibili找到你想要下载的视频 比如: <a href="http://www.bilibili.com/video/av2299170/" target="_blank" rel="external">http://www.bilibili.com/video/av2299170/</a></p><br><p>然后再bilibili后面加上jj 最后拼起来就是<a href="http://www.bilibilijj.com/video/av2299170/" target="_blank" rel="external">http://www.bilibilijj.com/video/av2299170/</a></p><br><p><a href="http://7xi9fb.com1.z0.glb.clouddn.com/mm/imgs/2015-10-21-05.png" target="_blank" rel="external"><img class=" size-medium wp-image-460 alignnone" src="http://7xi9fb.com1.z0.glb.clouddn.com/mm/imgs/2015-10-21-05.png" data-original="http://www.old.com/wp-content/uploads/2015/05/1-300x66.png" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt="1" width="300" height="66"></a></p><br><p>&nbsp;</p><br><p>点击MP4进行下载</p><br><p>&nbsp;</p><br><h1><span style="color: #993366;"><strong><span style="color: #993366;">录制保存</span></strong></span></h1><br><p>有时候某些视频并不能下载 所以这里用到了Bandicam这款视频软件进行录制后保存</p><br><p>关于Bandicam下载可以去Bandicam吧进行下载</p><br><p><a href="http://7xi9fb.com1.z0.glb.clouddn.com/mm/imgs/2015-10-21-05.png" target="_blank" rel="external"><img class=" size-medium wp-image-461 alignnone" src="http://7xi9fb.com1.z0.glb.clouddn.com/mm/imgs/2015-10-21-05.png" data-original="http://www.old.com/wp-content/uploads/2015/05/2-280x300.png" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt="2" width="280" height="300"></a> 这里只稍微说一下.一般录制出来的视频比较大.如果有需要后期开一章如何压制视频的文章吧</p><br><p>&nbsp;</p></blockquote><br><p>&nbsp;</p><br><blockquote><br><h1><span style="color: #993366;"><strong>截取视频音乐</strong></span></h1><br><p>截取视频音乐有很多种方式.如果你愿意一边看视频一边截取可以采用potplay播放器的录制功能</p><br><h4><span style="color: #333333;">使用potplay </span></h4><br><p>下载地址:<a href="http://potplayer.daum.net/?lang=zh_CN" target="_blank" rel="external">http://potplayer.daum.net/?lang=zh_CN</a></p><br><p><a href="http://7xi9fb.com1.z0.glb.clouddn.com/mm/imgs/2015-10-21-05.png" target="_blank" rel="external"><img class=" size-medium wp-image-462 alignnone" src="http://7xi9fb.com1.z0.glb.clouddn.com/mm/imgs/2015-10-21-05.png" data-original="http://www.old.com/wp-content/uploads/2015/05/3-300x185.png" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt="3" width="300" height="185"></a></p><br><p>&nbsp;</p><br><p>打开个视频文件 按TAB键既可以看到视频的一些相关信息</p><br><p><a href="http://7xi9fb.com1.z0.glb.clouddn.com/mm/imgs/2015-10-21-05.png" target="_blank" rel="external"><img class=" size-medium wp-image-463 alignnone" src="http://7xi9fb.com1.z0.glb.clouddn.com/mm/imgs/2015-10-21-05.png" data-original="http://www.old.com/wp-content/uploads/2015/05/4-300x219.png" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt="4" width="300" height="219"></a></p><br><p>然后开始录制 右键选择 声音-音轨-录制</p><br><p><a href="http://7xi9fb.com1.z0.glb.clouddn.com/mm/imgs/2015-10-21-05.png" target="_blank" rel="external"><img class=" size-medium wp-image-464 alignnone" src="http://7xi9fb.com1.z0.glb.clouddn.com/mm/imgs/2015-10-21-05.png" data-original="http://www.old.com/wp-content/uploads/2015/05/5-300x276.png" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt="5" width="300" height="276"></a></p><br><p>&nbsp;</p><br><p>这里可以选择很多种格式录制音频.. 到此使用potplay录制音频就结束了</p><br><p>&nbsp;</p><br><h1><span style="color: #333333;"><strong>使用视频制作软件截取音频</strong></span></h1><br><p>..这个我就不多说了..</p><br><p>另外网上还有一大堆如何截取视频音频的教程..大家可以多去了解一下</p><br><p>&nbsp;</p><br><p>&nbsp;</p></blockquote><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p>





      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-113ver" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/21/113ver/" class="article-date">
  	<time datetime="2015-10-21T14:57:05.755Z" itemprop="datePublished">2015-10-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/21/113ver/">CSS 预处理语言LESS简单实用教程与笔记</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><blockquote></blockquote></p>
<p></p><h1><span style="color: #333333; font-family: arial, helvetica, sans-serif;"><strong>前言</strong></span></h1><p></p>
<p>CSS 预处理语言有两种 一种是今天的LESS 还有一种是SASS…至于学哪种..看个人喜好咯.其实都差不多</p><br><p>&nbsp;</p><br><h1><span style="color: #333333;"><strong>何为CSS预处理语言？</strong></span></h1><br><p>首先我们知道CSS是没有变量这一说的,也没有运算,逻辑判断…. 于是某个想要偷懒的程序猿开发出了一门预处理语言,满足了世界上一大批想偷懒的程序猿,这是一件普大喜奔的事</p><br><p>&nbsp;</p><br><h1><span style="color: #333333;"><strong>它能干什么？</strong></span></h1><br><p><del>不管它能不能干什么.反正不能干你就是了.</del></p><br><p>我们可以定义多个变量方便后面重复编写的时候调用,我们也可以编写一个class方便后续文本继承这个class</p><br><p>&nbsp;</p><br><blockquote><br><h1><span style="color: #333333;"><strong>下载与编译</strong></span></h1><br><p>&nbsp;</p><br><h3 style="text-align: center;"><strong>编译</strong></h3><br><p>编译的方式有很多种,nodejs可以编译,客户端(浏览器)也可以编译,这里我推荐使用咋们自己人开发的一款编译工具叫koala</p><br><p>官方网址为:<a href="http://koala-app.com/" target="_blank" rel="external">http://koala-app.com/</a></p><br><p>下载 安装就不多说了.</p><br><p>首先新建一个文件夹 less(名字自己取)然后新建一个文件名为.less的文件 比如test.less</p><br><p>然后打开这款软件,把文件夹拖入或者添加到这里</p><br><p><a href="http://7xi9fb.com1.z0.glb.clouddn.com/mm/imgs/2015-10-21-11.png" target="_blank" rel="external"><img class=" size-medium wp-image-471 alignnone" src="http://7xi9fb.com1.z0.glb.clouddn.com/mm/imgs/2015-10-21-11.png" data-original="http://www.old.com/wp-content/uploads/2015/05/11-300x185.png" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt="1" width="300" height="185"></a></p><br><p>&nbsp;</p><br><p>添加 文件夹后会出现</p><br><p>这时候要做的是 设置文件输出路径</p><br><p><a href="http://7xi9fb.com1.z0.glb.clouddn.com/mm/imgs/2015-10-21-21.png" target="_blank" rel="external"><img class=" size-medium wp-image-472 alignnone" src="http://7xi9fb.com1.z0.glb.clouddn.com/mm/imgs/2015-10-21-21.png" data-original="http://www.old.com/wp-content/uploads/2015/05/21-300x187.png" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt="2" width="300" height="187"></a></p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>1:选择你要编译的less文件</p><br><p>2:选择输出方式</p><br><p>3:点击立即编译</p><br><p>4:HTML导出编译的css</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p><a href="http://7xi9fb.com1.z0.glb.clouddn.com/mm/imgs/2015-10-21-31.png" target="_blank" rel="external"><img class="  alignnone wp-image-473 " src="http://7xi9fb.com1.z0.glb.clouddn.com/mm/imgs/2015-10-21-31.png" data-original="http://www.old.com/wp-content/uploads/2015/05/31.png" onerror="this.onerror=null;this.src='http://www.old.com/wp-content/themes/BYMT/images/images_error.jpg'" alt="3" width="572" height="354"></a></p><br><p>&nbsp;</p><br><p>OK这时候你就编译了一个less了</p><br><p>&nbsp;</p><br><h1><span style="color: #333333;"><strong>小贴士</strong></span></h1><br><p>只要不关闭Koala这个软件 那么less与css都是动态即时编译 也就是说直接在less文件里面写完后保存并不需要再次执行编译.</p><br><p>&nbsp;</p><br><p>&nbsp;</p></blockquote><br><p>&nbsp;</p><br><p>&nbsp;</p><br><blockquote><br><h1 style="text-align: center;"> <strong><span style="color: #333333;">LESS简单教程</span></strong></h1><br><h3><span style="color: #993366;"><strong>变量</strong></span></h3><br><pre class="lang:default decode:true ">@a:#eee;<br>@testW:300px;<br></pre><br><p>用@开头来定义一个变量</p><br><h3><span style="color: #993366;"><strong>使用变量</strong></span></h3><br><pre class="lang:default decode:true">body{<br>    background: @a;<br>}</pre><br><p>&nbsp;</p><br><h3><span style="color: #993366;"><strong>继承/混合</strong></span></h3><br><pre class="lang:default decode:true ">.box{<br>    width: @testW;<br>    height:@testW;<br>    background: red;<br>    .border;<br>}<br><br>//混合<br>.border{<br>    border:5px solid pink;<br>}</pre><br><p>首先我们定义了一个class 然后再.box里引用了这个类 .border这样就实现了继承 具体的可以看看编译后的CSS哦</p><br><p>&nbsp;</p><br><h3><span style="color: #993366;"><strong>混合传参</strong></span></h3><br><pre class="lang:default decode:true ">.border_02(@border_w){<br>    border: solid yellow @border_w;<br>}<br>.test_hunhe{<br>    .border_02(30px);<br>}</pre><br><p>.border_o2中声明了一个不带默认值的参数,在.test_hunhe调用的时候需要传递具体的参数</p><br><p>&nbsp;</p><br><h3><span style="color: #993366;"><strong>混合传参-给定默认值</strong></span></h3><br><pre class="lang:default decode:true ">.border_03(@border_w:10px){<br>    border:solid blue @border_w;<br>}<br>.test_hunhe03{<br>    .border_03();<br>}<br></pre><br><p>.test<em>hunhe03调用的时候不带参值.默认就是10px</em></p><br><p>&nbsp;</p><br><h3><span style="color: #993366;"><strong>标记锚点</strong></span></h3><br><pre class="lang:default decode:true">.Col(red,@a:red){<br>    color:@a;<br><br>}<br><br>.Col(blue,@a:blue){<br>    color:@a<br>}<br>//默认设置..PS:需要把参数全部传递进去<br>.Col(@,@a:null){<br>        background: #147845;<br>}<br>.test_04{<br> .Col(blue);<br>}</pre><br><p>最后生成的test_04为 background: #147845; color:blue</p><br><p>&nbsp;</p><br><h3><span style="color: #993366;">嵌套</span></h3><br><pre class="lang:default decode:true">.magic{<br>    //magic下的li<br>    li{<br>        //li下的a<br>        a{<br>            .Col(blue);<br>            //&amp;代表上一级选择器的元素<br>            &amp;:hover{<br>                .Col(red)<br>            }<br>        }<br>    }<br>}<br><br></pre><br><p>&nbsp;</p><br><h3><span style="color: #993366;"><strong>&amp;选择符</strong></span></h3><br><pre class="lang:default decode:true">a{<br>            .Col(blue);<br>            //&amp;代表上一级选择器的元素<br>            &amp;:hover{<br>                .Col(red)<br>            }</pre><br><p>&nbsp;</p><br><h3><span style="color: #993366;"><strong> 运算</strong></span></h3><br><pre class="lang:default decode:true ">.sum{<br><br>    //<br>    .box();<br>    //继承box的样式<br>    //同时在后面又定义了个Width覆盖了box的width<br>    //运算记得用空格隔开..<br>    width:@testW - 100px;<br><br>}</pre><br><p>&nbsp;</p><br><h3><span style="color: #993366;"><strong>避免编译</strong></span></h3><br><pre class="lang:default decode:true ">//避免编译<br><br>.test_03{<br>    //用~””来避免编译<br>    width:~”cacl(300px-30px)”;<br><br>}<br><br>//! important<br>//css中用来定义层级<br>.test_improtant{<br> .box()!important;<br>}<br></pre><br><p>&nbsp;</p></blockquote><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p>





      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/14/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="page-number" href="/page/14/">14</a><span class="page-number current">15</span><a class="page-number" href="/page/16/">16</a><a class="page-number" href="/page/17/">17</a><span class="space">&hellip;</span><a class="page-number" href="/page/25/">25</a><a class="extend next" rel="next" href="/page/16/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2015 Soul
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>